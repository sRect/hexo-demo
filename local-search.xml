<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2022/04/04/hello-world/"/>
    <url>/2022/04/04/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo server<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo generate<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Taroä¸å¾®ä¿¡å°ç¨‹åºåŸç”Ÿç»„ä»¶ä¹‹é—´çš„äº‹ä»¶é€šä¿¡</title>
    <link href="/2022/04/04/taro-wemark/"/>
    <url>/2022/04/04/taro-wemark/</url>
    
    <content type="html"><![CDATA[<ul><li><p><a href="https://github.com/sRect/wechat-blog">å°ç¨‹åºåšå®¢ github ä»“åº“</a></p></li><li><p><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F://sRect%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/sRect%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Z1MPSUtT7bnfPFd">æœ¬å°ç¨‹åºé“¾æ¥</a></p></li></ul><h2 id="1-éœ€æ±‚èƒŒæ™¯"><a href="#1-éœ€æ±‚èƒŒæ™¯" class="headerlink" title="1. éœ€æ±‚èƒŒæ™¯"></a>1. éœ€æ±‚èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨åšä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºç‰ˆçš„ç®€æ˜“åšå®¢ï¼ŒåŸæœ¬æ˜¯å‡†å¤‡è‡ªå·±è§£æ<code>markdown</code>å¹¶æ¸²æŸ“ï¼Œæœ€åè¿˜æ˜¯ä½¿ç”¨äº†<a href="https://github.com/TooBug/wemark"><code>wemark</code></a>ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥æ¸²æŸ“ï¼Œå› ä¸ºè‡ªå·±è§£ææ¸²æŸ“çš„å¾ˆéš¾çœ‹ã€‚</p><p>å› ä¸ºå°ç¨‹åºå†…æ‰“å¼€ç¬¬ä¸‰æ–¹é“¾æ¥ï¼Œéœ€è¦åœ¨é¡¹ç›®é…ç½®é‡Œè®¾ç½®åŸŸåæ‰èƒ½æ‰“å¼€ï¼Œå¯¹äºç¬¬ä¸‰æ–¹ç½‘ç«™é“¾æ¥å¾ˆæ— å¥ˆï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥è¿›è¡Œå¤åˆ¶ï¼Œç„¶åå¯ä»¥è‡ªè¡Œé€šè¿‡æµè§ˆå™¨æ‰“å¼€ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Detail</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mdStr = <span class="hljs-string">`...`</span>;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;md&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;markdown-body&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">wemark</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wemark&quot;</span> <span class="hljs-attr">md</span>=<span class="hljs-string">&#123;mdStr&#125;</span> <span class="hljs-attr">link</span> <span class="hljs-attr">highlight</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wemark&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure><p><img src="/assets/img/taro-wemark/link.png"></p><p>å¦‚ä¸Šå›¾æ˜¾ç¤ºï¼Œå°±æ˜¯æƒ³åœ¨ç‚¹å‡»çš„æ—¶å€™ï¼Œæ‹¿åˆ°é“¾æ¥é‡Œçš„ urlã€‚</p><p>å…¶å®ç†Ÿæ‚‰å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„éœ€æ±‚ï¼Œä½†æˆ‘ç­‰å½©ç¬”ä¸ç†Ÿæ‚‰ã€‚ğŸ˜„</p><p>åŸæœ¬è¿˜æƒ³æ‹¿åˆ° domï¼Œç„¶åè‡ªå·±ç»‘å®šäº‹ä»¶ï¼Œæœ€åå‘ç°è¿™æ ·é”™çš„ç¦»è°±ã€‚</p><h2 id="2-å½©ç¬”çš„é”™è¯¯ä¹‹è·¯"><a href="#2-å½©ç¬”çš„é”™è¯¯ä¹‹è·¯" class="headerlink" title="2. å½©ç¬”çš„é”™è¯¯ä¹‹è·¯"></a>2. å½©ç¬”çš„é”™è¯¯ä¹‹è·¯</h2><blockquote><p><strong>æ³¨æ„</strong>ï¼š ä»¥ä¸‹å‡ ç§æ–¹å¼éƒ½æ²¡æˆåŠŸ</p></blockquote><h3 id="2-1-ä½¿ç”¨createSelectorQueryapi"><a href="#2-1-ä½¿ç”¨createSelectorQueryapi" class="headerlink" title="2.1 ä½¿ç”¨createSelectorQueryapi"></a>2.1 ä½¿ç”¨<code>createSelectorQuery</code>api</h3><blockquote><p>æ‰“å°å‡ºæ¥ï¼Œéƒ½æ²¡æœ‰æƒ³è¦çš„ç»“æœï¼Œæ²¡æ³•ç»§ç»­ä¸‹å»</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span>, &#123; useReady &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tarojs/taro&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Detail</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">useReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">createSelectorQuery</span>()<br>      .<span class="hljs-title function_">select</span>(<span class="hljs-string">&quot;#md&quot;</span>)<br>      .<span class="hljs-title function_">node</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;==&gt;&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);<br>      &#125;)<br>      .<span class="hljs-title function_">exec</span>();<br>  &#125;);<br>&#125;;<br></code></pre></div></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title function_">useReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> query = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">createSelectorQuery</span>().<span class="hljs-title function_">in</span>(<span class="hljs-variable language_">this</span>);<br><br>  query<br>    .<span class="hljs-title function_">select</span>(<span class="hljs-string">&quot;#md&quot;</span>)<br>    .<span class="hljs-title function_">node</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">node</span>);<br>    &#125;)<br>    .<span class="hljs-title function_">exec</span>();<br>&#125;);<br></code></pre></div></td></tr></table></figure><h3 id="2-2-ä½¿ç”¨getCurrentInstanceapi"><a href="#2-2-ä½¿ç”¨getCurrentInstanceapi" class="headerlink" title="2.2 ä½¿ç”¨getCurrentInstanceapi"></a>2.2 ä½¿ç”¨<code>getCurrentInstance</code>api</h3><blockquote><p>æ‰“å°å‡ºæ¥ï¼Œä¹Ÿæ²¡æœ‰æƒ³è¦çš„ï¼Œæ— æ³•ç»§ç»­ä¸‹å»</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; getCurrentInstance &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tarojs/taro&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123; page &#125; = <span class="hljs-title function_">getCurrentInstance</span>();<br><span class="hljs-keyword">const</span> md = page.<span class="hljs-title function_">selectComponent</span>(<span class="hljs-string">&quot;#md&quot;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(md);<br></code></pre></div></td></tr></table></figure><h3 id="2-3-ç›´æ¥åœ¨æœ€å¤–é¢ç»‘å®šäº‹ä»¶"><a href="#2-3-ç›´æ¥åœ¨æœ€å¤–é¢ç»‘å®šäº‹ä»¶" class="headerlink" title="2.3 ç›´æ¥åœ¨æœ€å¤–é¢ç»‘å®šäº‹ä»¶"></a>2.3 ç›´æ¥åœ¨æœ€å¤–é¢ç»‘å®šäº‹ä»¶</h3><blockquote><p>æ‰“å°å‡ºæ¥ï¼Œæ— æ³•åŒºåˆ†æ˜¯å¦ç‚¹å‡»åœ¨é“¾æ¥ä¸Šï¼Œä¹Ÿæ— æ³•ç»§ç»­ä¸‹å»</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Detail</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mdStr = <span class="hljs-string">`...`</span>;<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;md&quot;</span>);<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">event</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event);<br>    &#125;<br>    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;tap&quot;</span>, handleClick);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&quot;tap&quot;</span>, handleClick);<br>    &#125;;<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;md&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;markdown-body&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">wemark</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wemark&quot;</span> <span class="hljs-attr">md</span>=<span class="hljs-string">&#123;mdStr&#125;</span> <span class="hljs-attr">link</span> <span class="hljs-attr">highlight</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wemark&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure><h2 id="3-è§£å†³"><a href="#3-è§£å†³" class="headerlink" title="3. è§£å†³"></a>3. è§£å†³</h2><blockquote><p>è¿˜æ˜¯å¾—åˆ°<code>wemark</code>ç»„ä»¶é‡Œå»ä¿®æ”¹</p></blockquote><ul><li><code>wemark/wemark.js</code>æ·»åŠ å¦‚ä¸‹ä»£ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Component</span>(&#123;<br>  <span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-attr">onTap</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;onTap==&gt;&quot;</span>, e);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">&quot;myevent&quot;</span>, e);<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><ul><li><code>wemark/wemark.wxml</code>ä¸­æ·»åŠ <code>data-url</code>å’Œæ·»åŠ äº‹ä»¶ç»‘å®š</li></ul><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">navigator</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;wemark_inline_link&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;&#123;&#123;renderInline.data.href&#125;&#125;&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">wx:if</span>=<span class="hljs-string">&quot;&#123;&#123;renderInline.type === &#x27;link&#x27;&#125;&#125;&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">data-url</span>=<span class="hljs-string">&quot;&#123;&#123;renderInline.data.href&#125;&#125;&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">bindtap</span>=<span class="hljs-string">&quot;onTap&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  &#123;&#123;renderInline.content&#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>å›åˆ°è‡ªå·±ä»£ç ä¸­ä¿®æ”¹</li></ul><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Detail</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mdStr = <span class="hljs-string">`...`</span>;<br><br>  <span class="hljs-comment">// é“¾æ¥å¤åˆ¶</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onMyEvent</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br><br>    <span class="hljs-keyword">const</span> str = e?.<span class="hljs-property">detail</span>?.<span class="hljs-property">currentTarget</span>?.<span class="hljs-property">dataset</span>?.<span class="hljs-property">url</span>;<br><br>    <span class="hljs-keyword">if</span> (!str) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">setClipboardData</span>(&#123;<br>      <span class="hljs-attr">data</span>: str,<br>      <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showToast</span>(&#123;<br>          <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;é“¾æ¥å¤åˆ¶æˆåŠŸ&quot;</span>,<br>          <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;success&quot;</span>,<br>        &#125;);<br>      &#125;,<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;md&quot;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;markdown-body&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">wemark</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wemark&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">md</span>=<span class="hljs-string">&#123;mdStr&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">link</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">highlight</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wemark&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onMyevent</span>=<span class="hljs-string">&#123;onMyevent&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure><p><img src="/assets/img/taro-wemark/dataset.png"></p><ul><li>è‡³æ­¤ï¼Œè§£å†³äº†è¿™ä¸ªå°éœ€æ±‚</li></ul><h2 id="4-å‚è€ƒé“¾æ¥"><a href="#4-å‚è€ƒé“¾æ¥" class="headerlink" title="4. å‚è€ƒé“¾æ¥"></a>4. å‚è€ƒé“¾æ¥</h2><ol><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html">ç»„ä»¶é—´é€šä¿¡ä¸äº‹ä»¶</a></p></li><li><p><a href="https://taro-docs.jd.com/taro/docs/taro-in-miniapp/#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B8%8E%E4%BA%8B%E4%BB%B6">åŸç”Ÿé¡¹ç›®ä½¿ç”¨ Taro</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>taro</category>
      
    </categories>
    
    
    <tags>
      
      <tag>taro</tag>
      
      <tag>wemark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3åˆ†é’Ÿä½¿ç”¨Hexoæ­å»ºè‡ªå·±çš„åšå®¢</title>
    <link href="/2022/03/24/hexo-blog/"/>
    <url>/2022/03/24/hexo-blog/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="https://github.com/sRect/sRect.github.io">æœ¬æ–‡ github ä»“åº“</a></li><li><a href="https://gitee.com/srect/hexo-blog">æœ¬æ–‡ gitee ä»“åº“</a></li><li><a href="https://srect.github.io/">åšå®¢é¢„è§ˆ</a></li></ul><h2 id="1-Hexo-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Hexo-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Hexo æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. Hexo æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚å¯ä»¥ä½¿ç”¨ Markdown å†™æ–‡ç« ï¼Œæ–¹ä¾¿é«˜æ•ˆï¼Œæ— éœ€åå°æœåŠ¡ï¼Œé™æ€èµ„æºå³å¯å±•ç¤ºã€‚æ­é… github pages æˆ–è€…ä¸ªäººäº‘æœåŠ¡å™¨éƒ½å¯ä»¥éƒ¨ç½²ã€‚</p><h2 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install -g hexo-cli<br></code></pre></div></td></tr></table></figure><h2 id="3-åˆå§‹åŒ–"><a href="#3-åˆå§‹åŒ–" class="headerlink" title="3. åˆå§‹åŒ–"></a>3. åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo init &lt;project-name&gt;<br><span class="hljs-built_in">cd</span> &lt;project-name&gt;<br>npm install<br></code></pre></div></td></tr></table></figure><h2 id="4-ä¸»è¦-api"><a href="#4-ä¸»è¦-api" class="headerlink" title="4. ä¸»è¦ api"></a>4. ä¸»è¦ api</h2><ol><li>åˆ›å»ºæ–°æ–‡ç« </li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo new &lt;title&gt;<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨<code>source/_posts/</code>ä¸‹æ–°å»º</li></ul><p>ä¾‹å¦‚åˆ›å»º foo é¡µï¼Œåœ¨<code>source/_posts/</code>ç›®å½•ä¸‹å°±ä¼šå¤šå‡ºä¸€ä¸ª<code>foo.md</code>æ–‡ä»¶ï¼Œå°±åœ¨é‚£é‡Œé¢å†™æ–‡ç« </p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo new foo<br></code></pre></div></td></tr></table></figure><ul><li>åœ¨<code>source</code>ä¸‹æ–°å»ºå…¶å®ƒçš„ç›®å½•</li></ul><p>ä¾‹å¦‚åœ¨<code>source/about/</code>ä¸‹åˆ›å»º<code>bar.md</code>æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo new page --path about/bar <span class="hljs-string">&quot;bar&quot;</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>ç”Ÿæˆé™æ€æ–‡ä»¶</li></ol><p>é¡¹ç›®æ ¹ç›®å½•ä¼šå¤šå‡ºä¸€ä¸ª<code>public</code>æ–‡ä»¶å¤¹ï¼Œå°±æ˜¯ç¼–è¯‘è¿‡åçš„<code>html</code>é™æ€æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo generate<br></code></pre></div></td></tr></table></figure><ol start="3"><li>æ¸…é™¤ç¼“å­˜</li></ol><p>æŠŠä¸Šé¢ç”Ÿæˆçš„<code>public</code>æ–‡ä»¶å¤¹åˆ æ‰</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo clean<br></code></pre></div></td></tr></table></figure><ol start="4"><li>å¯åŠ¨æœåŠ¡</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>http://localhost:4000</code>è®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">hexo server<br></code></pre></div></td></tr></table></figure><h2 id="5-å®‰è£…å¿ƒä»ªçš„ä¸»é¢˜"><a href="#5-å®‰è£…å¿ƒä»ªçš„ä¸»é¢˜" class="headerlink" title="5. å®‰è£…å¿ƒä»ªçš„ä¸»é¢˜"></a>5. å®‰è£…å¿ƒä»ªçš„ä¸»é¢˜</h2><ol><li><a href="https://hexo.io/themes/">hexo themes</a></li></ol><p>è¿™ä¹ˆå¤šä¸»é¢˜ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ </p><ol start="2"><li>æœ¬æ–‡é€‰æ‹©çš„ä¸»é¢˜<a href="https://github.com/fluid-dev/hexo-theme-fluid"><code>hexo-theme-fluid</code></a></li></ol><ul><li>ä¸»é¢˜å®‰è£…</li></ul><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install --save hexo-theme-fluid<br></code></pre></div></td></tr></table></figure><p>ç„¶ååœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º _config.fluid.ymlï¼Œå°†ä¸»é¢˜çš„ _config.yml å†…å®¹å¤åˆ¶è¿›å»</p><ul><li>é…ç½®ä¸»é¢˜</li></ul><p>ä¿®æ”¹ Hexo åšå®¢ç›®å½•ä¸­çš„ _config.yml:</p><figure class="highlight avrasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs avrasm"><span class="hljs-symbol">theme:</span> fluid  <span class="hljs-meta"># æŒ‡å®šä¸»é¢˜</span><br><br><span class="hljs-symbol">language:</span> <span class="hljs-built_in">zh</span>-CN  <span class="hljs-meta"># æŒ‡å®šè¯­è¨€ï¼Œä¼šå½±å“ä¸»é¢˜æ˜¾ç¤ºçš„è¯­è¨€ï¼ŒæŒ‰éœ€ä¿®æ”¹</span><br></code></pre></div></td></tr></table></figure><h2 id="6-éƒ¨ç½²"><a href="#6-éƒ¨ç½²" class="headerlink" title="6. éƒ¨ç½²"></a>6. éƒ¨ç½²</h2><h3 id="6-1-github-pages-éƒ¨ç½²"><a href="#6-1-github-pages-éƒ¨ç½²" class="headerlink" title="6.1 github pages éƒ¨ç½²"></a>6.1 github pages éƒ¨ç½²</h3><ol><li><p>åœ¨ä½ çš„ github ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º<code>&lt;ä½ çš„githubç”¨æˆ·å&gt;.github.io</code>çš„ä»“åº“</p></li><li><p>æœ¬åœ°ç”Ÿæˆ ssh å¯†é’¥å¯¹</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">ssh-keygen -t rsa -C <span class="hljs-string">&quot;ç”¨æˆ·å@example.com &quot;</span><br></code></pre></div></td></tr></table></figure><ol start="3"><li><p>åœ¨ä»“åº“<code>Settings &gt; Deploy Keys</code>ä¸­æ·»åŠ å…¬é’¥å†…å®¹ï¼Œå¹¶å‹¾é€‰è®¿é—®æƒé™ï¼Œæœ€åç¡®å®š</p></li><li><p>åœ¨ä»“åº“<code>Settings &gt; Secrets</code>ä¸­æ·»åŠ ç§é’¥ï¼Œkey ä¸º<code>DEPLOY_KEY</code>ï¼Œå†…å®¹ä¸ºç§é’¥å†…å®¹</p></li><li><p>é¡¹ç›®<code>_config.yml</code>é…ç½®æ–‡ä»¶å’Œä¸»é¢˜é…ç½®æ–‡ä»¶é…ç½®<code>deploy</code>å­—æ®µ</p></li></ol><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">&lt;ä½ çš„githubä»“åº“</span> <span class="hljs-string">SSHä¸‹è½½é“¾æ¥&gt;</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">gh-pages</span><br></code></pre></div></td></tr></table></figure><ol start="6"><li><code>.github/workflows/deploy.yml</code></li></ol><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">Github</span> <span class="hljs-string">Pages</span> <span class="hljs-string">Deploy</span><br><br><span class="hljs-comment"># https://github.com/marketplace/actions/hexo-action?version=v1.0.4</span><br><br><span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]<br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">A</span> <span class="hljs-string">job</span> <span class="hljs-string">to</span> <span class="hljs-string">deploy</span> <span class="hljs-string">blog.</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v1</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">submodules:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Checkout private submodules(themes or something else).</span><br><br>      <span class="hljs-comment"># Caching dependencies to speed up workflows. (GitHub will remove any cache entries that have not been accessed in over 7 days.)</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Cache</span> <span class="hljs-string">node</span> <span class="hljs-string">modules</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v1</span><br>        <span class="hljs-attr">id:</span> <span class="hljs-string">cache</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">node_modules</span><br>          <span class="hljs-attr">key:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">&#125;&#125;-node-$&#123;&#123;</span> <span class="hljs-string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">restore-keys:</span> <span class="hljs-string">|</span><br><span class="hljs-string">            $&#123;&#123; runner.os &#125;&#125;-node-</span><br><span class="hljs-string"></span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Dependencies</span><br>        <span class="hljs-attr">if:</span> <span class="hljs-string">steps.cache.outputs.cache-hit</span> <span class="hljs-type">!=</span> <span class="hljs-string">&#x27;true&#x27;</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span><br><br>      <span class="hljs-comment"># Deploy hexo blog website.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span><br>        <span class="hljs-attr">id:</span> <span class="hljs-string">deploy</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">sma11black/hexo-action@v1.0.3</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">deploy_key:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.DEPLOY_KEY</span> <span class="hljs-string">&#125;&#125;</span><br>          <span class="hljs-attr">user_name:</span> <span class="hljs-string">&lt;ä½ çš„githubç”¨æˆ·å&gt;</span> <span class="hljs-comment"># (or delete this input setting to use bot account)</span><br>          <span class="hljs-attr">user_email:</span> <span class="hljs-string">&lt;ä½ çš„githubé‚®ç®±&gt;</span> <span class="hljs-comment"># (or delete this input setting to use bot account)</span><br>          <span class="hljs-attr">commit_msg:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">github.event.head_commit.message</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-comment"># (or delete this input setting to use hexo default settings)</span><br>      <span class="hljs-comment"># Use the output from the `deploy` step(use for test action)</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">the</span> <span class="hljs-string">output</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>          <span class="hljs-string">echo</span> <span class="hljs-string">&quot;$<span class="hljs-template-variable">&#123;&#123; steps.deploy.outputs.notify &#125;&#125;</span>&quot;</span><br></code></pre></div></td></tr></table></figure><ol start="7"><li>ä½¿ç”¨<code>git</code>æäº¤ä»£ç ï¼Œåœ¨ä»“åº“<code>Actions</code>é‡Œå¯ä»¥çœ‹åˆ° yml é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨æ‰§è¡Œæ—¥å¿—ï¼Œæ‰§è¡Œç»“æŸåï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œæµè§ˆå™¨é‡Œè®¿é—®<code>https://&lt;ä½ çš„githubç”¨æˆ·å&gt;.github.io</code>ï¼Œå¯ä»¥çœ‹åˆ°ä½ çš„åšå®¢äº†ï¼</li></ol><h3 id="6-2-docker-å®¹å™¨éƒ¨ç½²åœ¨ä¸ªäººäº‘æœåŠ¡å™¨"><a href="#6-2-docker-å®¹å™¨éƒ¨ç½²åœ¨ä¸ªäººäº‘æœåŠ¡å™¨" class="headerlink" title="6.2 docker å®¹å™¨éƒ¨ç½²åœ¨ä¸ªäººäº‘æœåŠ¡å™¨"></a>6.2 docker å®¹å™¨éƒ¨ç½²åœ¨ä¸ªäººäº‘æœåŠ¡å™¨</h3><ol><li><p>åœ¨ github ä»“åº“<code>Settings &gt; Secrets</code>ä¸­æ·»åŠ ä½ çš„é˜¿é‡Œäº‘é•œåƒå®¹å™¨æœåŠ¡è´¦å·ï¼Œkey ä¸º<code>ALIYUN_DOCKER_USERNAME</code>ï¼Œdockerhub ç­‰ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œä»¥é˜¿é‡Œäº‘é•œåƒå®¹å™¨æœåŠ¡ä¸ºä¾‹</p></li><li><p>åœ¨ github ä»“åº“<code>Settings &gt; Secrets</code>ä¸­æ·»åŠ ä½ çš„é˜¿é‡Œäº‘é•œåƒå®¹å™¨æœåŠ¡å¯†ç ï¼Œkey ä¸º<code>ALIYUN_DOCKER_PASSWORD</code></p></li><li><p>Dockerfile</p></li></ol><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Dockerfile"><span class="hljs-comment"># 1. åŸºç¡€é•œåƒå®‰è£…</span><br><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.15</span> AS base<br><br><span class="hljs-keyword">ENV</span> NODE_ENV=production \<br>  APP_PATH=/usr/share/nginx/hexo<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$APP_PATH</span></span><br><br><span class="hljs-comment"># ä½¿ç”¨å›½å†…é•œåƒï¼ŒåŠ é€Ÿä¸‹é¢ apk addå®‰è£…</span><br><span class="hljs-comment"># å¦‚æœæ˜¯åœ¨githubä¸Šæ‰“åŒ…é•œåƒï¼Œæ— éœ€ä½¿ç”¨å†…å†…é•œåƒï¼Œæ³¨é‡Šæ‰å³å¯</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apk add --no-cache --update nodejs=16.14.0-r0 yarn=1.22.17-r0</span><br><br><span class="hljs-comment"># 2. åŸºäºåŸºç¡€é•œåƒå®‰è£…é¡¹ç›®ä¾èµ–å’Œæ‰“åŒ…</span><br><span class="hljs-keyword">FROM</span> base AS install<br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . ./</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn install</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn run build</span><br><br><span class="hljs-keyword">FROM</span> base AS result<br><br><span class="hljs-comment"># å°†publicç›®å½•ä¸‹çš„æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°/usr/share/nginx/hexoä¸‹é¢</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=install <span class="hljs-variable">$APP_PATH</span>/public .</span><br><br><span class="hljs-comment"># 3. æœ€ç»ˆåŸºäºnginxè¿›è¡Œæ„å»º</span><br><span class="hljs-keyword">FROM</span> nginx:alpine<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /usr/share/nginx/hexo</span><br><br><span class="hljs-comment"># æ·»åŠ è‡ªå·±çš„é…ç½® default.conf åœ¨ä¸‹é¢</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> nginx.conf /etc/nginx/conf.d/default.conf</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=result /usr/share/nginx/hexo .</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br></code></pre></div></td></tr></table></figure><ol start="4"><li><code>.github/workflows/deploy.yml</code></li></ol><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">deploy</span> <span class="hljs-string">ci</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span> <span class="hljs-comment"># push æ—¶è§¦å‘ci</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>] <span class="hljs-comment"># ä½œç”¨äºmainåˆ†æ”¯</span><br>  <span class="hljs-comment"># pull_request:</span><br>  <span class="hljs-comment">#   branches: [main]</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-comment"># strategy:</span><br>    <span class="hljs-comment">#   matrix:</span><br>    <span class="hljs-comment">#     node-version: [14.x]</span><br>    <span class="hljs-comment">#     # See supported Node.js release schedule at https://nodejs.org/en/about/releases/</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-comment"># æ‹‰å–mainåˆ†æ”¯ä»£ç </span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span><br><br>      <span class="hljs-comment"># # æŒ‡å®šnodejsç‰ˆæœ¬</span><br>      <span class="hljs-comment"># - name: Use Node.js $&#123;&#123; matrix.node-version &#125;&#125;</span><br>      <span class="hljs-comment">#   uses: actions/setup-node@v2</span><br>      <span class="hljs-comment">#   with:</span><br>      <span class="hljs-comment">#     node-version: $&#123;&#123; matrix.node-version &#125;&#125;</span><br>      <span class="hljs-comment">#     cache: &quot;yarn&quot;</span><br><br>      <span class="hljs-comment"># # å®‰è£…ä¾èµ–</span><br>      <span class="hljs-comment"># - name: install</span><br>      <span class="hljs-comment">#   run: sudo yarn install</span><br><br>      <span class="hljs-comment"># # æ‰“åŒ…</span><br>      <span class="hljs-comment"># - name: build</span><br>      <span class="hljs-comment">#   run: sudo yarn run build</span><br><br>      <span class="hljs-comment"># åˆ¶ä½œdockeré•œåƒå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">docker</span> <span class="hljs-string">image</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          echo $&#123;&#123; secrets.ALIYUN_DOCKER_PASSWORD &#125;&#125; | docker login registry.cn-hangzhou.aliyuncs.com --username $&#123;&#123; secrets.ALIYUN_DOCKER_USERNAME &#125;&#125; --password-stdin</span><br><span class="hljs-string">          docker image build -t hexo-blog .</span><br><span class="hljs-string">          docker tag hexo-blog registry.cn-hangzhou.aliyuncs.com/&lt;å‘½åç©ºé—´&gt;/&lt;é•œåƒä»“åº“å&gt;:latest</span><br><span class="hljs-string">          docker push registry.cn-hangzhou.aliyuncs.com/&lt;å‘½åç©ºé—´&gt;/&lt;é•œåƒä»“åº“å&gt;:latest</span><br><span class="hljs-string">          docker logout</span><br></code></pre></div></td></tr></table></figure><ol start="5"><li>ä½¿ç”¨ docker å®¹å™¨å¯è§†åŒ–ç®¡ç†ï¼Œæ¯”å¦‚<code>portainer</code>ç­‰ï¼Œæ‹‰å–åˆšæ‰åˆ¶ä½œçš„é•œåƒï¼Œç„¶åè¿è¡Œå®¹å™¨ã€‚æˆ–è€…ç™»å½•äº‘æœåŠ¡å™¨ï¼Œæ‰‹åŠ¨æ‹‰å–é•œåƒå†è¿è¡Œå®¹å™¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># æ‹‰å–é•œåƒ</span><br>docker pull registry.cn-hangzhou.aliyuncs.com/&lt;å‘½åç©ºé—´&gt;/&lt;é•œåƒä»“åº“å&gt;:latest<br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker container run -d -p &lt;ä½ çš„æœåŠ¡å™¨å®¿ä¸»æœºå‘å¤–æš´éœ²çš„ç«¯å£&gt;:80 --name hexo-blog registry.cn-hangzhou.aliyuncs.com/&lt;å‘½åç©ºé—´&gt;/&lt;é•œåƒä»“åº“å&gt;:latest<br></code></pre></div></td></tr></table></figure><ol start="6"><li>ä¸å‡ºæ„å¤–ï¼Œæµè§ˆå™¨é‡Œè®¿é—®<code>http:&lt;ä½ çš„ipæˆ–è€…é…å¥½çš„åŸŸå&gt;:&lt;ç«¯å£&gt;</code>ï¼Œå¯ä»¥çœ‹åˆ°ä½ çš„åšå®¢äº†ï¼</li></ol><h2 id="7-å‚è€ƒèµ„æ–™"><a href="#7-å‚è€ƒèµ„æ–™" class="headerlink" title="7. å‚è€ƒèµ„æ–™"></a>7. å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://hexo.io/zh-cn/docs">Hexo å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://hexo.fluid-dev.com/docs/guide">Hexo Fluid ä¸»é¢˜ç”¨æˆ·æ‰‹å†Œ</a></li><li><a href="https://github.com/marketplace/actions/hexo-action?version=v1.0.4">Hexo Github Action</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>github actions</tag>
      
      <tag>CI</tag>
      
      <tag>CD</tag>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mermaidä½¿ç”¨</title>
    <link href="/2022/03/11/mermaid/"/>
    <url>/2022/03/11/mermaid/</url>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œæ˜¯æ–‡ç« æ‘˜è¦â€¦</p><span id="more"></span><p>mermaid æµç¨‹å›¾ + é¥¼å›¾ä½¿ç”¨<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="mermaid">[1]</span></a></sup></p><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><pre><code class=" mermaid">flowchart TBA[Hard] --&gt;|Text| B(Round)B --&gt; C&#123;Decision&#125;C --&gt;|One| D[Result 1]C --&gt;|Two| E(Result 2)</code></pre><h2 id="é¥¼å›¾"><a href="#é¥¼å›¾" class="headerlink" title="é¥¼å›¾"></a>é¥¼å›¾</h2><blockquote><p><a href="https://mermaid-js.github.io/mermaid/#/pie">https://mermaid-js.github.io/mermaid/#/pie</a></p></blockquote><pre><code class=" mermaid">pietitle Pets adopted by volunteers&quot;Dogs&quot; : 386&quot;Cats&quot; : 85&quot;Rats&quot; : 15</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://github.com/mermaid-js/mermaid/blob/develop/README.zh-CN.md">mermaid</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    
    <tags>
      
      <tag>mermaid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºæŒç»­å®šä½</title>
    <link href="/2022/03/10/wechat-location/"/>
    <url>/2022/03/10/wechat-location/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="https://github.com/sRect/taro_wx">github æºç ä»“åº“</a></li></ul><h3 id="1-å®¢æˆ·ç«¯è¯¦æƒ…"><a href="#1-å®¢æˆ·ç«¯è¯¦æƒ…" class="headerlink" title="1. å®¢æˆ·ç«¯è¯¦æƒ…"></a>1. å®¢æˆ·ç«¯è¯¦æƒ…</h3><blockquote><p>æ–‡ç« å†…ä½¿ç”¨ Tarojs å¼€å‘å¾®ä¿¡å°ç¨‹åº</p></blockquote><ul><li>æ‰‹æœºå‹å·ï¼šå°ç±³ 10</li><li>æ“ä½œç³»ç»ŸåŠç‰ˆæœ¬ï¼šAndroid 10</li><li>å®¢æˆ·ç«¯å¹³å°ï¼šandroid</li><li>SDKVersionï¼š2.20.2</li></ul><h3 id="2-æ³¨æ„ç‚¹"><a href="#2-æ³¨æ„ç‚¹" class="headerlink" title="2. æ³¨æ„ç‚¹"></a>2. æ³¨æ„ç‚¹</h3><ol><li>taro é¡¹ç›®é…ç½®æ–‡ä»¶<code>src/app.config.js</code>ä¸­è¦æ·»åŠ ä»¥ä¸‹é…ç½®</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">requiredBackgroundModes</span>: [<span class="hljs-string">&quot;location&quot;</span>],<br>  <span class="hljs-attr">permission</span>: &#123;<br>    <span class="hljs-string">&quot;scope.userLocation&quot;</span>: &#123;<br>      <span class="hljs-attr">desc</span>: <span class="hljs-string">&quot;å¦‚å®å¡«å†™å®é™…ç”¨é€”&quot;</span>, <span class="hljs-comment">// é«˜é€Ÿå…¬è·¯è¡Œé©¶æŒç»­åå°å®šä½</span><br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ‰“å¼€ä½ç½®ä¿¡æ¯å¼€å…³</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getSystemInfoAsync</span>(&#123;<br>  <span class="hljs-title function_">success</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">locationEnabled</span>);<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><ol start="3"><li>æ£€æŸ¥æ˜¯å¦ç»™å¾®ä¿¡å¼€äº†å®šä½æƒé™</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getSystemInfoAsync</span>(&#123;<br>  <span class="hljs-title function_">success</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">locationAuthorized</span>);<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><ol start="4"><li>æ£€æŸ¥å½“å‰å°ç¨‹åºæ˜¯å¦å¼€äº†åå°å®šä½æƒé™</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getSetting</span>(&#123;<br>  <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<br>    <span class="hljs-keyword">const</span> authSetting = res.<span class="hljs-property">authSetting</span>;<br>    <span class="hljs-keyword">if</span> (<br>      !authSetting[<span class="hljs-string">&quot;scope.userLocation&quot;</span>] ||<br>      !authSetting[<span class="hljs-string">&quot;scope.userLocationBackground&quot;</span>]<br>    ) &#123;<br>      <span class="hljs-comment">// è®©ç”¨æˆ·åœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­åŠ¡å¿…å‹¾é€‰â€œä½¿ç”¨å°ç¨‹åºæœŸé—´å’Œç¦»å¼€å°ç¨‹åºä¹‹åâ€é€‰é¡¹</span><br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">openSetting</span>();<br>    &#125;<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><h3 id="3-å®Œæ•´ä»£ç "><a href="#3-å®Œæ•´ä»£ç " class="headerlink" title="3. å®Œæ•´ä»£ç "></a>3. å®Œæ•´ä»£ç </h3><figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span>, &#123; useReady, useDidShow, useDidHide &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tarojs/taro&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Map</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@tarojs/components&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">hasOwnProperty</span> = (<span class="hljs-params">obj, key</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(obj, key);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">HandleLocation</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [systemSetting, setSystemSetting] = <span class="hljs-title function_">useState</span>(&#123;&#125;);<br>  <span class="hljs-keyword">const</span> [location, setLocation] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">longitude</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-attr">latitude</span>: <span class="hljs-string">&quot;&quot;</span> &#125;);<br>  <span class="hljs-keyword">const</span> [locationList, setLocationList] = <span class="hljs-title function_">useState</span>([]);<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleGetLocation</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">&quot;startLocationUpdateBackground&quot;</span>)) &#123;<br>      <span class="hljs-comment">// https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html</span><br>      <span class="hljs-comment">// å°ç¨‹åºå…¨å±€é…ç½®</span><br>      <span class="hljs-comment">// https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission</span><br>      <span class="hljs-comment">// wx.authorize(&#123;scope: &quot;scope.userInfo&quot;&#125;)ï¼Œä¸ä¼šå¼¹å‡ºæˆæƒçª—å£ï¼Œè¯·ä½¿ç”¨ &lt;button open-type=&quot;getUserInfo&quot;/&gt;</span><br>      <span class="hljs-comment">// éœ€è¦æˆæƒ scope.userLocationã€scope.userLocationBackground æ—¶å¿…é¡»é…ç½®åœ°ç†ä½ç½®ç”¨é€”è¯´æ˜</span><br><br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">startLocationUpdateBackground</span>(&#123;<br>        <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">onLocationChange</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>            <span class="hljs-title function_">setLocationList</span>(<span class="hljs-function">(<span class="hljs-params">pre</span>) =&gt;</span> [...pre, data]);<br><br>            <span class="hljs-title function_">setLocation</span>(&#123; <span class="hljs-attr">longitude</span>: data.<span class="hljs-property">longitude</span>, <span class="hljs-attr">latitude</span>: data.<span class="hljs-property">latitude</span> &#125;);<br><br>            <span class="hljs-comment">// ajaxå‘é€æ•°æ®åˆ°åå°</span><br>            <span class="hljs-comment">// ...</span><br>          &#125;);<br>        &#125;,<br>        <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);<br>          <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showToast</span>(&#123;<br>            <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>            <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;å®šä½å¤±è´¥&quot;</span>,<br>          &#125;);<br><br>          <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">openSetting</span>();<br>        &#125;,<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showToast</span>(&#123;<br>        <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æ‚¨çš„è®¾å¤‡æš‚ä¸æ”¯æŒå®šä½&quot;</span>,<br>      &#125;);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">// æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ‰“å¼€ä½ç½®ä¿¡æ¯å¼€å…³</span><br>  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ç»™å¾®ä¿¡å¼€äº†å®šä½æƒé™</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkMobileLocationAuth</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getSystemInfoAsync</span>(&#123;<br>        <span class="hljs-title function_">success</span>(<span class="hljs-params">data</span>) &#123;<br>          <span class="hljs-title function_">setSystemSetting</span>(data);<br><br>          <span class="hljs-keyword">if</span> (<br>            data &amp;&amp;<br>            <span class="hljs-title function_">hasOwnProperty</span>(data, <span class="hljs-string">&quot;locationEnabled&quot;</span>) &amp;&amp;<br>            !data.<span class="hljs-property">locationEnabled</span><br>          ) &#123;<br>            <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showModal</span>(&#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æç¤º&quot;</span>,<br>              <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;è¯·æ‰“å¼€æ‰‹æœºè®¾ç½®-ä½ç½®ä¿¡æ¯(GPS)å¼€å…³&quot;</span>,<br>              <span class="hljs-attr">confirmText</span>: <span class="hljs-string">&quot;ç¡®å®š&quot;</span>,<br>              <span class="hljs-attr">showCancel</span>: <span class="hljs-literal">false</span>,<br>            &#125;);<br><br>            <span class="hljs-title function_">reject</span>();<br>          &#125;<br><br>          <span class="hljs-keyword">if</span> (<br>            data &amp;&amp;<br>            <span class="hljs-title function_">hasOwnProperty</span>(data, <span class="hljs-string">&quot;locationAuthorized&quot;</span>) &amp;&amp;<br>            !data.<span class="hljs-property">locationAuthorized</span><br>          ) &#123;<br>            <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showModal</span>(&#123;<br>              <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æç¤º&quot;</span>,<br>              <span class="hljs-attr">content</span>:<br>                <span class="hljs-string">&quot;è¯·æ‰“å¼€æ‰‹æœºè®¾ç½®-åº”ç”¨è®¾ç½®-åº”ç”¨ç®¡ç†-å¾®ä¿¡-æƒé™ç®¡ç†-å®šä½æƒé™å¼€å…³&quot;</span>,<br>              <span class="hljs-attr">confirmText</span>: <span class="hljs-string">&quot;ç¡®å®š&quot;</span>,<br>              <span class="hljs-attr">showCancel</span>: <span class="hljs-literal">false</span>,<br>              <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-comment">// Taro.openSetting();</span><br>              &#125;,<br>            &#125;);<br><br>            <span class="hljs-title function_">reject</span>();<br>          &#125;<br><br>          <span class="hljs-title function_">resolve</span>();<br>        &#125;,<br>        <span class="hljs-title function_">fail</span>(<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-title function_">reject</span>();<br>        &#125;,<br>      &#125;);<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-comment">// æ£€æŸ¥å½“å‰å°ç¨‹åºæ˜¯å¦å¼€äº†å®šä½æƒé™</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkMiniAppLocationAuth</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">&quot;getSetting&quot;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>();<br><br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getSetting</span>(&#123;<br>        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>          <span class="hljs-keyword">const</span> authSetting = res.<span class="hljs-property">authSetting</span>;<br><br>          <span class="hljs-keyword">if</span> (<br>            authSetting &amp;&amp;<br>            <span class="hljs-title function_">hasOwnProperty</span>(authSetting, <span class="hljs-string">&quot;scope.userLocation&quot;</span>) &amp;&amp;<br>            <span class="hljs-title function_">hasOwnProperty</span>(authSetting, <span class="hljs-string">&quot;scope.userLocationBackground&quot;</span>) &amp;&amp;<br>            authSetting[<span class="hljs-string">&quot;scope.userLocation&quot;</span>] &amp;&amp;<br>            authSetting[<span class="hljs-string">&quot;scope.userLocationBackground&quot;</span>]<br>          ) &#123;<br>            <span class="hljs-title function_">resolve</span>();<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">&quot;openSetting&quot;</span>)) &#123;<br>              <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showModal</span>(&#123;<br>                <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æç¤º&quot;</span>,<br>                <span class="hljs-attr">content</span>:<br>                  <span class="hljs-string">&quot;è¯·åœ¨ç‚¹å‡»ç¡®å®šåï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­åŠ¡å¿…å‹¾é€‰â€œä½¿ç”¨å°ç¨‹åºæœŸé—´å’Œç¦»å¼€å°ç¨‹åºä¹‹åâ€é€‰é¡¹&quot;</span>,<br>                <span class="hljs-attr">confirmText</span>: <span class="hljs-string">&quot;ç¡®å®š&quot;</span>,<br>                <span class="hljs-attr">showCancel</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>) &#123;<br>                  <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">openSetting</span>();<br>                &#125;,<br>              &#125;);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">showModal</span>(&#123;<br>                <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;æç¤º&quot;</span>,<br>                <span class="hljs-attr">content</span>:<br>                  <span class="hljs-string">&quot;è¯·ç‚¹å‡»å³ä¸Šè§’â€œ...â€æ›´å¤š-è®¾ç½®-ä½ç½®ä¿¡æ¯ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­åŠ¡å¿…å‹¾é€‰â€œä½¿ç”¨å°ç¨‹åºæœŸé—´å’Œç¦»å¼€å°ç¨‹åºä¹‹åâ€é€‰é¡¹&quot;</span>,<br>                <span class="hljs-attr">confirmText</span>: <span class="hljs-string">&quot;ç¡®å®š&quot;</span>,<br>                <span class="hljs-attr">showCancel</span>: <span class="hljs-literal">false</span>,<br>              &#125;);<br>            &#125;<br><br>            <span class="hljs-title function_">reject</span>();<br>          &#125;<br>        &#125;,<br>      &#125;);<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-title function_">useReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;useReady==&gt;&quot;</span>);<br>  &#125;);<br><br>  <span class="hljs-title function_">useDidShow</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;useDidShow==&gt;&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">&quot;stopLocationUpdate&quot;</span>)) &#123;<br>      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">stopLocationUpdate</span>(&#123;<br>        <span class="hljs-title function_">complete</span>(<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-title function_">checkMobileLocationAuth</span>()<br>            .<span class="hljs-title function_">then</span>(checkMiniAppLocationAuth)<br>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>              <span class="hljs-comment">// å…¨éƒ¨okï¼Œå¯ä»¥è¿›è¡ŒæŒç»­å®šä½</span><br>              <span class="hljs-title function_">handleGetLocation</span>();<br>            &#125;)<br>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;err==&gt;&quot;</span>);<br>            &#125;);<br>        &#125;,<br>      &#125;);<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-title function_">useDidHide</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;useDidHide==&gt;&quot;</span>);<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Map</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 100%; height: 200px;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">scale</span>=<span class="hljs-string">&#123;16&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">longitude</span>=<span class="hljs-string">&#123;location.longitude&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">latitude</span>=<span class="hljs-string">&#123;location.latitude&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure><h3 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h3><ul><li>ç»è¿‡æœ¬åœ°å¼€å‘å®é™…æµ‹è¯•ï¼ŒæŠŠå°ç¨‹åºåˆ‡åˆ°åå°åï¼Œåˆ‡æ¢åˆ°å…¶ä»– app</li><li>æˆ–è€…æ‰‹æœºç›´æ¥é”å±</li></ul><p>ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œ1 åˆ†é’Ÿåï¼Œ<code>startLocationUpdateBackground</code>api å³å¤±æ•ˆï¼Œåªæœ‰é‡æ–°è§£é”æ‰‹æœºï¼Œé‡æ–°å›åˆ°å¾®ä¿¡ï¼Œapi çš„å®æ—¶ä½ç½®ç›‘æ§æ‰è¢«å”¤é†’ï¼Œå°šæœªæ‰¾åˆ°è§£å†³æ–¹æ³• <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="å¾®ä¿¡å°ç¨‹åºæˆæƒ">[1]</span></a></sup></p><h3 id="5-å…¶ä»–"><a href="#5-å…¶ä»–" class="headerlink" title="5. å…¶ä»–"></a>5. å…¶ä»–</h3><p>é’‰é’‰å°ç¨‹åº<code>dd.getLocation</code>åªæœ‰å½“å‰é’‰é’‰å°ç¨‹åºå½“å‰åœ¨æ¿€æ´»çŠ¶æ€ä¸‹å¯ä»¥è·å–åˆ°ï¼Œåˆ‡æ¢åˆ°åå°å’Œæ‰‹æœºé”å±åï¼Œå³å¤±æ•ˆ <sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="å¾®ä¿¡å°ç¨‹åºå…¨å±€é…ç½®">[2]</span></a></sup></p><h3 id="6-å‚è€ƒèµ„æ–™"><a href="#6-å‚è€ƒèµ„æ–™" class="headerlink" title="6. å‚è€ƒèµ„æ–™"></a>6. å‚è€ƒèµ„æ–™</h3><!-- 1. [å¾®ä¿¡å°ç¨‹åºæˆæƒ](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)2. [å¾®ä¿¡å°ç¨‹åºå…¨å±€é…ç½®](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission) --><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html">å¾®ä¿¡å°ç¨‹åºæˆæƒ</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission">å¾®ä¿¡å°ç¨‹åºå…¨å±€é…ç½®</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>wechat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      
      <tag>wechat</tag>
      
      <tag>tarojs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šå›¾è¶…è¯¦ç»† jenkins å®¹å™¨å®‰è£…å¹¶éƒ¨ç½²å‰ç«¯é¡¹ç›®</title>
    <link href="/2022/03/08/jenkins/"/>
    <url>/2022/03/08/jenkins/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="https://github.com/sRect/myJenkins">æœ¬æ–‡ my-jenkins github ä»“åº“</a></li><li><a href="https://github.com/sRect/myblog">æœ¬æ–‡å‰ç«¯ react é¡¹ç›® github ä»“åº“</a></li></ul><h3 id="1-æå‰å‡†å¤‡"><a href="#1-æå‰å‡†å¤‡" class="headerlink" title="1.æå‰å‡†å¤‡"></a>1.æå‰å‡†å¤‡</h3><ol><li>1 å° linux äº‘æœåŠ¡å™¨æˆ–è€…æœ¬åœ°è™šæ‹Ÿæœºä»£æ›¿</li><li>åœ¨æœåŠ¡å™¨å®¿ä¸»æœºä¸Šè£…å¥½ docker</li><li>å‡†å¤‡å¥½ 2 ä¸ª github ä»“åº“(æˆ–è€… gitee ä»“åº“),1 ä¸ªç”¨äº jenkinsï¼Œ1 ä¸ªç”¨äºå‰ç«¯é¡¹ç›®(æ–‡ç« ä»¥ github ä»“åº“ä¸ºä¾‹)</li><li>1 ä¸ª dockerhub ä»“åº“ï¼Œç”¨äºå­˜å‚¨ jenkins é•œåƒ</li></ol><h3 id="2-jenkins-å®¹å™¨å®‰è£…"><a href="#2-jenkins-å®¹å™¨å®‰è£…" class="headerlink" title="2.jenkins å®¹å™¨å®‰è£…"></a>2.jenkins å®¹å™¨å®‰è£…</h3><h4 id="1-å®‰è£…å‰çš„ç–‘é—®"><a href="#1-å®‰è£…å‰çš„ç–‘é—®" class="headerlink" title="1. å®‰è£…å‰çš„ç–‘é—®"></a>1. å®‰è£…å‰çš„ç–‘é—®</h4><ol><li>ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šå®‰è£… jenkinsï¼Ÿ</li></ol><p>ç­”ï¼šå¯ä»¥ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šå®‰è£… jenkinsï¼Œå¹¶ä¸ä¸€å®šéå¾—ä½¿ç”¨å®¹å™¨è¿™ç§å½¢å¼å®‰è£…ï¼Œåªä¸è¿‡æœ¬æ–‡ä½¿ç”¨äº†å®¹å™¨å®‰è£…è¿™ç§æ–¹å¼ã€‚</p><ol start="2"><li>ä¸ºä»€ä¹ˆä¸ç›´æ¥æ‹‰å– dockerhub ä¸Šçš„ jenkins é•œåƒï¼Ÿ</li></ol><p>ç­”ï¼šå¯ä»¥ç›´æ¥æ‹‰å–ï¼Œä½†ä¸€å®šè¦æ‹‰å–<code>jenkins/jenkins</code>è¿™ä¸ªé•œåƒï¼Œ<code>jenkins</code>è¿™ä¸ªé•œåƒå·²ç»å¾ˆä¹…æ²¡ç»´æŠ¤äº†ã€‚<br>è¿˜æœ‰å®˜æ–¹çš„ jenkins é•œåƒé»˜è®¤æ˜¯æ²¡æœ‰ sudo ç”¨æˆ·æƒé™çš„ï¼Œå³æ‰§è¡Œ<code>sudo wget http://xxxx</code>ï¼Œæ˜¯ä¸è¯†åˆ« sudo å‘½ä»¤çš„ï¼Œè¿˜æœ‰å¸¸è§çš„<code>wget</code>ã€<code>vim</code>ã€<code>ping</code>ç­‰å¸¸ç”¨å‘½ä»¤éƒ½æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦è‡ªå·±å®‰è£…ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©è‡ªå·±æ„å»º jenkins é•œåƒã€‚</p><ol start="3"><li>å¦‚ä½•åœ¨ jenkins å®¹å™¨é‡Œæ‰§è¡Œ docker å‘½ä»¤ï¼Ÿ</li></ol><p>ç­”ï¼š<a href="http://www.up4dev.com/2018/11/27/run-docker-by-jenkins-in-docker/">ä¸€ç•ªæœç´¢ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ</a>ï¼Œæœ¬æ–‡ä½¿ç”¨äº† <code>Docker-outside-of-Docker</code> æ–¹æ¡ˆï¼Œå¦ä¸€ç§æœªå®éªŒæˆåŠŸã€‚</p><ul><li><p><code>Docker-outside-of-Docker</code></p><p>ä½¿ç”¨å¤–éƒ¨çš„ dockerï¼Œå³å®¹å™¨å®¿ä¸»æœºä¸Šçš„ dockerã€‚å°†å®¿ä¸»æœºçš„ docker ç¨‹åºæ˜ å°„åˆ° jenkins å®¹å™¨é‡Œã€‚è¿™æ ·æ²¡å®‰è£… docker çš„ jenkins å®¹å™¨å¯ä»¥æ‰§è¡Œ docker å‘½ä»¤ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®¹å™¨é‡Œæœ¬èº«æ˜¯æ²¡æœ‰ docker çš„ï¼Œæ˜¯æŠŠæŒ‡ä»¤å‘é€ç»™å®¿ä¸»æœºæ¥æ‰§è¡Œçš„ã€‚</p></li><li><p><code>Docker-in-Docker</code></p><p>é¡¾åæ€ä¹‰ï¼Œåœ¨ docker å®¹å™¨é‡Œå®‰è£… dockerï¼Œç„¶åä½¿ç”¨ dockerã€‚å®¹å™¨é‡Œæœ‰ dockerï¼Œå’Œå®¿ä¸»æœºä¸Šçš„ docker æ˜¯éš”ç¦»çš„ã€‚</p></li></ul><h4 id="2-Dockerfile-ç¼–å†™"><a href="#2-Dockerfile-ç¼–å†™" class="headerlink" title="2. Dockerfile ç¼–å†™"></a>2. Dockerfile ç¼–å†™</h4><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> jenkins/jenkins:latest<br><br><span class="hljs-keyword">USER</span> root<br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update \</span><br><span class="language-bash">  <span class="hljs-comment"># å®‰è£…sudo</span></span><br>  &amp;&amp; apt-get install -y sudo \<br>  &amp;&amp; rm -rf /var/lib/apt/lists/*<br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;jenkins ALL=NOPASSWD: ALL&quot;</span> &gt;&gt; /etc/sudoers</span><br><br><span class="hljs-keyword">USER</span> jenkins<br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br></code></pre></div></td></tr></table></figure><h4 id="3-github-çš„-workflow-é…ç½®æ–‡ä»¶"><a href="#3-github-çš„-workflow-é…ç½®æ–‡ä»¶" class="headerlink" title="3. github çš„ workflow é…ç½®æ–‡ä»¶"></a>3. github çš„ workflow é…ç½®æ–‡ä»¶</h4><ul><li><p>å‰æéœ€è¦åœ¨ github çš„ jenkins ä»“åº“é‡Œè®¾ç½®å¥½ secrets</p></li><li><p>åœ¨ä»“åº“çš„<code>Settings -&gt; Secrets -&gt; Actions</code>ï¼Œç‚¹å‡»<code>New repository secret</code>æŒ‰é’®åˆ›å»ºä½ çš„ dockerhub è´¦å·å’Œå¯†ç ï¼Œå³æ·»åŠ <code>DOCKERHUB_USERNAME</code>å’Œ<code>DOCKERHUB_TOKEN</code>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºæ“ä½œï¼š</p></li></ul><p><img src="/assets/img/jenkins-docker/add-secrets.jpg" alt="add secrets"></p><ul><li>&#x2F;.github&#x2F;workflows&#x2F;deploy.yml</li></ul><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">jenkins</span> <span class="hljs-string">image</span> <span class="hljs-string">build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]<br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span><br><br>      <span class="hljs-comment">#åˆ¶ä½œdockeré•œåƒæ¨é€åˆ°dockerhub</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">to</span> <span class="hljs-string">dockerhub</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          docker login -u $&#123;&#123; secrets.DOCKERHUB_USERNAME &#125;&#125; -p $&#123;&#123; secrets.DOCKERHUB_TOKEN &#125;&#125;</span><br><span class="hljs-string">          docker image build -t my-jenkins:latest .</span><br><span class="hljs-string">          docker tag my-jenkins:latest $&#123;&#123; secrets.DOCKERHUB_USERNAME &#125;&#125;/my-jenkins:latest</span><br><span class="hljs-string">          docker push $&#123;&#123; secrets.DOCKERHUB_USERNAME &#125;&#125;/my-jenkins:latest</span><br><span class="hljs-string">          docker logout</span><br></code></pre></div></td></tr></table></figure><ul><li>git æäº¤ä»£ç ï¼Œè‡ªåŠ¨æ‰“åŒ…æ¨é€é•œåƒåˆ° dockerhub</li></ul><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">git add .<br>git commit -m <span class="hljs-string">&quot;feat: init&quot;</span><br>git push -u origin main<br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œ<code>Actions</code>é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè‡ªåŠ¨éƒ¨ç½²æˆåŠŸ</p><p><img src="/assets/img/jenkins-docker/workflows.jpg" alt="workflows"></p><p>é•œåƒä¹ŸæˆåŠŸæ¨é€åˆ° dockerhub äº†</p><p><img src="/assets/img/jenkins-docker/myjebkins.jpg" alt="myjebkins"></p><h4 id="4-åœ¨æœåŠ¡å™¨å®¿ä¸»æœºä¸Šæ‹‰å–åˆšæ‰çš„é•œåƒå¹¶å®‰è£…"><a href="#4-åœ¨æœåŠ¡å™¨å®¿ä¸»æœºä¸Šæ‹‰å–åˆšæ‰çš„é•œåƒå¹¶å®‰è£…" class="headerlink" title="4. åœ¨æœåŠ¡å™¨å®¿ä¸»æœºä¸Šæ‹‰å–åˆšæ‰çš„é•œåƒå¹¶å®‰è£…"></a>4. åœ¨æœåŠ¡å™¨å®¿ä¸»æœºä¸Šæ‹‰å–åˆšæ‰çš„é•œåƒå¹¶å®‰è£…</h4><ol><li>æ‹‰å–é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull [ä½ çš„dockerhubåå­—]/my-jenkins:latest<br></code></pre></div></td></tr></table></figure><ol start="2"><li>å¯åŠ¨å®¹å™¨</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo docker container run -d \<br>-v /var/run/docker.sock:/var/run/docker.sock \<br>-v $(which docker):/usr/bin/docker \<br>-p 8000:8080 \<br>--name my-jenkins [ä½ çš„dockerhubåå­—]/my-jenkins:latest<br></code></pre></div></td></tr></table></figure><p>è§£é‡Šä¸‹å‚æ•°çš„å«ä¹‰ï¼š</p><ul><li><p><code>-d</code>: åå°è¿è¡Œå®¹å™¨</p></li><li><p><code>-v</code>: æŒ‡å®šæŒ‚è½½ç›®å½•å·ã€‚</p><ul><li>ç¬¬ 1 è¡Œè¡¨ç¤ºå°†å®¿ä¸»æœºä¸Šçš„<code>/var/run/docker.sock</code>ç›®å½•æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ docker å‘½ä»¤ï¼Œå°±ä¼šè¢«å‘é€åˆ°å®¿ä¸»æœºä¸Šå»æ‰§è¡Œ</li><li>ç¬¬ 2 è¡Œè¡¨ç¤ºå°†å®¿ä¸»æœºä¸Šçš„ docker ç¨‹åºæ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·å®¹å™¨å°±å¯ä»¥è¿è¡Œ docker å‘½ä»¤ï¼Œå®¹å™¨æœ¬èº«æ²¡æœ‰å®‰è£… docker æœåŠ¡ã€‚</li></ul></li><li><p><code>-p</code>: å‰é¢æ˜¯å®¿ä¸»æœºä¸Šçš„ç«¯å£(æœåŠ¡å™¨å®‰å…¨ç»„ä¸­è¦é…ç½®å¥½ï¼Œä¸ç„¶æµè§ˆå™¨é‡Œæ— æ³•è®¿é—®)ï¼Œåé¢æ˜¯å®¹å™¨ç«¯å£ï¼Œjenkins é»˜è®¤æ˜¯ 8080 ç«¯å£</p></li><li><p><code>-name</code>: ç»™å®¹å™¨å‘½åï¼Œæ˜¯åŸºäº<code>[ä½ çš„dockerhubåå­—]/my-jenkins:latest</code>è¿™ä¸ªé•œåƒåˆ›å»ºçš„å®¹å™¨ï¼Œå¹¶å‘½åä¸º<code>my-jenkins</code></p></li></ul><p>ä¸å‡ºæ„å¤–ï¼Œå®¹å™¨å¯åŠ¨æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®äº†ã€‚</p><h3 id="3-jenkins-å®¹å™¨é…ç½®"><a href="#3-jenkins-å®¹å™¨é…ç½®" class="headerlink" title="3.jenkins å®¹å™¨é…ç½®"></a>3.jenkins å®¹å™¨é…ç½®</h3><blockquote><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœåœ¨ jenkins é‡Œä¸éƒ¨ç½² docker é¡¹ç›®ï¼Œè¿™ä¸€ç« èŠ‚å¯ä»¥ç•¥è¿‡ï¼Œè¿™é‡Œéƒ½æ˜¯ä¸ºäº†èƒ½åœ¨ jenkins é‡Œéƒ¨ç½² docker é¡¹ç›®å‡†å¤‡çš„ã€‚</p></blockquote><p>åœ¨æµè§ˆå™¨è®¿é—®å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œå®‰è£…å¸¸ç”¨å‘½ä»¤å·¥å…·ï¼Œæ£€éªŒæ˜¯å¦å¯ä»¥æ‰§è¡Œ docker å‘½ä»¤ã€‚</p><ol><li>å…ˆè¿›å…¥å®¹å™¨å†…éƒ¨</li></ol><blockquote><p>å¦‚æœä½ çš„å®¿ä¸»æœºä¸Šå®‰è£…äº†å¦‚<code>portainer</code>ã€<code>rancher</code>ç­‰ docker å®¹å™¨ç®¡ç†é¢æ¿ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ¥è¿›å…¥å®¹å™¨ï¼Œå°±ä¸ç”¨æ•²å‘½ä»¤äº†ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">docker container <span class="hljs-built_in">exec</span> -it my-jenkins /bin/bash<br></code></pre></div></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/issue<br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œæ‰“å°å‡º</p><figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript">Debian GNU/Linux <span class="hljs-number">11</span> <span class="hljs-string">\n</span> <span class="hljs-string">\l</span><br></code></pre></div></td></tr></table></figure><p>è¯´æ˜å®¹å™¨å†…éƒ¨æ˜¯<code>Debian</code>å‘è¡Œç‰ˆï¼Œä¸æ˜¯<code>Ubuntu</code>ï¼Œä¹Ÿä¸æ˜¯<code>CentOS</code>ã€‚</p><ol start="3"><li>å®‰è£…å¸¸ç”¨å·¥å…·</li></ol><blockquote><p>å› ä¸ºå®¹å™¨å†…æ˜¯<code>Debian</code>ï¼Œé‚£å°±ä½¿ç”¨ <code>apt-get</code>ã€‚å®‰è£…è¿™äº›å·¥å…·çš„ç›®çš„åœ¨äºåé¢æœ‰å¯èƒ½éœ€è¦è¿›å…¥å®¹å™¨æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæå‰å®‰è£…å¥½ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># å…ˆæ›´æ–°å‡çº§apt-getæº</span><br>sudo apt-get update<br>sudo apt-get upgrade<br><span class="hljs-comment"># å®‰è£…systemctl</span><br>sudo apt-get install -y systemctl<br><span class="hljs-comment"># å®‰è£…vim</span><br>sudo apt-get install -y vim<br><span class="hljs-comment"># å®‰è£…wget</span><br>sudo apt-get install -y wget<br></code></pre></div></td></tr></table></figure><ol start="4"><li>æ£€éªŒå®¹å™¨å†…éƒ¨æ˜¯å¦å¯ä»¥æ‰§è¡Œ docker å‘½ä»¤</li></ol><ul><li><p>æµ‹è¯• <code>docker -v</code> å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">docker -v<br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œæ­£å¸¸æ‰“å°ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">Docker</span> version <span class="hljs-number">17</span>.<span class="hljs-number">12</span>.<span class="hljs-number">1</span>-ce, build <span class="hljs-number">7390</span>fc6<br></code></pre></div></td></tr></table></figure><p>å¦‚æœå‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata">docker: <span class="hljs-keyword">error</span> <span class="hljs-keyword">while</span> loading shared libraries: libltdl.<span class="hljs-keyword">so</span>.7: cannot <span class="hljs-keyword">open</span> shared object <span class="hljs-keyword">file</span>: <span class="hljs-keyword">No</span> such <span class="hljs-keyword">file</span> or directory<br></code></pre></div></td></tr></table></figure><p>é‚£å°±å†å®‰è£…<code>libltdl7</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt-get install -y libltdl7<br></code></pre></div></td></tr></table></figure></li><li><p>æµ‹è¯•è¿è¡Œ <code>hello-world</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo docker run --<span class="hljs-built_in">rm</span> hello-world<br></code></pre></div></td></tr></table></figure><p>å¦‚æœæ­£å¸¸æ‰“å°ä¸‹é¢ä¿¡æ¯ï¼Œè¯´æ˜åœ¨å®¹å™¨é‡Œæ‰§è¡Œ docker å‘½ä»¤æ˜¯æ²¡é—®é¢˜çš„ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">Hello <span class="hljs-keyword">from</span> Docker!<br>This message shows <span class="hljs-keyword">that</span> your installation appears <span class="hljs-keyword">to</span> be working correctly.<br></code></pre></div></td></tr></table></figure></li></ul><h3 id="4-jenkins-åˆå§‹åŒ–"><a href="#4-jenkins-åˆå§‹åŒ–" class="headerlink" title="4.jenkins åˆå§‹åŒ–"></a>4.jenkins åˆå§‹åŒ–</h3><ol><li>æµè§ˆå™¨é‡Œè®¿é—®<code>http://[ä½ çš„æœåŠ¡å™¨ip]:[ä¸Šé¢å¯åŠ¨å®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œæˆ‘è¿™é‡Œæ˜¯8000]</code>ï¼Œå¼€å§‹åˆå§‹åŒ–ï¼Œå¦‚ä¸‹å›¾ï¼š</li></ol><p><img src="/assets/img/jenkins-docker/jenkens-init.jpg"></p><ol start="2"><li>åˆå§‹åŒ–ç»“æŸåï¼Œéœ€è¦è§£é” Jenkins</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-unlock.jpg"></p><p>è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå¤åˆ¶å‡ºé‚£ä¸€ä¸²å¯†ç ï¼Œç²˜è´´åˆ°è¿™é‡Œï¼Œç„¶åç‚¹å‡»ç¡®å®š</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /var/jenkins_home/secrets/initialAdminPassword<br></code></pre></div></td></tr></table></figure><ol start="3"><li>å®‰è£…æ¨èçš„æ’ä»¶</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-plugin.jpg"></p><p>ç‚¹å‡»å·¦ä¾§<em>å®‰è£…æ¨èçš„æ’ä»¶</em>ï¼Œè¿‡ä¸€ä¼šï¼Œç­‰æ’ä»¶å®‰è£…å¥½</p><p><img src="/assets/img/jenkins-docker/jenkins-plugins-install.jpg"></p><ol start="4"><li>æ³¨å†Œç®¡ç†å‘˜è´¦å·</li></ol><p>æŒ‰ç€æç¤ºä¸€æ­¥æ­¥æ¥æ“ä½œ</p><p><img src="/assets/img/jenkins-docker/jenkins-admin.jpg"></p><ol start="5"><li>æœ€ç»ˆè¿›å…¥ jenkins é¦–é¡µï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸäº†</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-welcome.jpg"></p><h3 id="5-jenkins-éƒ¨ç½²å‰ç«¯é¡¹ç›®"><a href="#5-jenkins-éƒ¨ç½²å‰ç«¯é¡¹ç›®" class="headerlink" title="5.jenkins éƒ¨ç½²å‰ç«¯é¡¹ç›®"></a>5.jenkins éƒ¨ç½²å‰ç«¯é¡¹ç›®</h3><blockquote><p>è¿™é‡Œä»¥ react(create-react-app åˆ›å»º) é¡¹ç›®ä¸ºä¾‹ï¼Œvue çš„ä¸€æ ·çš„ï¼Œå’Œæ¡†æ¶æ— å…³</p></blockquote><h4 id="5-1-Jenkins-å®‰è£…-Nodejs-æ’ä»¶"><a href="#5-1-Jenkins-å®‰è£…-Nodejs-æ’ä»¶" class="headerlink" title="5.1 Jenkins å®‰è£… Nodejs æ’ä»¶"></a>5.1 Jenkins å®‰è£… Nodejs æ’ä»¶</h4><blockquote><p>å› ä¸ºæ˜¯å‰ç«¯é¡¹ç›®ï¼Œç¦»ä¸å¼€ nodejsï¼Œæ‰€ä»¥è¦å®‰è£…</p></blockquote><ol><li>ç‚¹å‡»å·¦ä¾§<code>Manage Jenkins(ç³»ç»Ÿç®¡ç†)</code>,åœ¨<code>System Configuration(ç³»ç»Ÿé…ç½®)</code>ä¸‹ç‚¹å‡»<code>Manage Plugins(æ’ä»¶ç®¡ç†)</code>ï¼Œæ‰¾åˆ°å¹¶å®‰è£… Nodejs æ’ä»¶ï¼Œç‚¹å‡»<code>Download now and install after restart</code>,å®‰è£…å®Œæˆåï¼Œå‹¾é€‰é‡å¯ï¼Œjenkins ä¼šè‡ªåŠ¨é‡å¯</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-plugin-nodejs.png"></p><ol start="2"><li>é‡å¯å®Œæˆåï¼Œç‚¹å‡»å·¦ä¾§<code>Manage Jenkins(ç³»ç»Ÿç®¡ç†)</code>,åœ¨<code>System Configuration(ç³»ç»Ÿé…ç½®)</code>ä¸‹ç‚¹å‡»<code>å…¨å±€å·¥å…·é…ç½®</code>ï¼Œæ‰¾åˆ° Nodejs é€‰é¡¹ï¼Œç‚¹å‡»<code>æ–°å¢Nodejs</code>æŒ‰é’®ï¼Œè¾“å…¥åˆ«åï¼Œæœ€åç‚¹å‡»ä¿å­˜ï¼Œå°±é…ç½®å¥½ Nodejs äº†</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-global-plugin.jpg"></p><h4 id="5-2-éƒ¨ç½²å‰çš„é…ç½®"><a href="#5-2-éƒ¨ç½²å‰çš„é…ç½®" class="headerlink" title="5.2 éƒ¨ç½²å‰çš„é…ç½®"></a>5.2 éƒ¨ç½²å‰çš„é…ç½®</h4><ol><li><p>æå‰å‡†å¤‡å¥½å‰ç«¯é¡¹ç›®ï¼Œæäº¤åˆ° github ä»“åº“</p></li><li><p>github ç”Ÿæˆ Personal access tokens</p><p>github å¤´åƒä¸‹æ‹‰æ¡†-&gt; <code>Settings</code> -&gt; å·¦ä¾§èœå•<code>Developer settings</code> -&gt; <code>Personal access tokens</code> -&gt; ç‚¹å‡»<code>Generate new token</code>ï¼Œ<strong>æ³¨æ„ï¼šè¯·æŠŠç”Ÿæˆçš„ token å¤åˆ¶ä¸‹æ¥ï¼Œé¡µé¢åˆ·æ–°åå°±æ²¡äº†</strong></p></li></ol><p><img src="/assets/img/jenkins-docker/github-token.jpg"></p><ol start="3"><li>jenkins ä¸­æ·»åŠ  Github æœåŠ¡å™¨</li></ol><ul><li>ç³»ç»Ÿç®¡ç† -&gt; ç³»ç»Ÿé…ç½® -&gt; æ·»åŠ  Github æœåŠ¡å™¨ -&gt; æ·»åŠ  Secret text å‡­è¯ -&gt; è¿æ¥æµ‹è¯•</li></ul><p><img src="/assets/img/jenkins-docker/jenkins-addpj.jpg"></p><ul><li>ç¬¬ 2 æ­¥ç‚¹å‡»åï¼Œå¼¹å‡ºä¸‹é¢å¼¹æ¡†ï¼Œç±»å‹é‡Œä¸‹æ‹‰é€‰æ‹©<code>Secret text</code>,<code>Secret</code>é‡Œå¡«å…¥ä¸Šé¢ç”Ÿæˆçš„ tokenï¼Œç‚¹å‡»ç¡®å®š</li></ul><p><img src="/assets/img/jenkins-docker/jenkins-pj.jpg"></p><ul><li>ç¬¬ 5 æ­¥ç‚¹å‡»åï¼Œå‹¾é€‰<code>ä¸ºGithubæŒ‡å®šå¦ä¸€ä¸ªHook URL</code>,ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª urlï¼Œä¿å­˜ä¸‹è¿™ä¸ª url</li></ul><p><img src="/assets/img/jenkins-docker/jenkins-auto-webhooks.jpg"></p><p><strong>æœ€åï¼Œåˆ«å¿˜è®°ä¿å­˜</strong></p><ol start="4"><li>é…ç½® github ä»“åº“çš„<code>Webhooks</code></li></ol><ul><li><p>ç‚¹å‡»<code>Settings</code>-&gt;<code>Webhooks</code>-&gt;<code>Add Webhook</code>-&gt;è¾“å…¥<code>Payload URL</code></p></li><li><p>è¿™é‡Œçš„ Payload URLï¼Œå°±æ˜¯ä¸Šé¢ç”Ÿæˆçš„ Hook URL</p></li></ul><p><img src="/assets/img/jenkins-docker/github-webhook.jpg"></p><h4 id="5-3-æ­£å¼éƒ¨ç½²å‰ç«¯é¡¹ç›®"><a href="#5-3-æ­£å¼éƒ¨ç½²å‰ç«¯é¡¹ç›®" class="headerlink" title="5.3 æ­£å¼éƒ¨ç½²å‰ç«¯é¡¹ç›®"></a>5.3 æ­£å¼éƒ¨ç½²å‰ç«¯é¡¹ç›®</h4><ol><li>jenkins å·¦ä¾§èœå•ç‚¹å‡»<code>æ–°å»ºä»»åŠ¡</code>ï¼Œè¾“å…¥ä»»åŠ¡åç§°ï¼Œé€‰æ‹©<code>æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</code>ï¼Œç‚¹å‡»ç¡®å®š</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-firsttask.jpg"></p><ol start="2"><li>åˆ›å»º</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-task-1.jpg"></p><ol start="3"><li>æºç ç®¡ç†</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-task-2.jpg"></p><ol start="4"><li>æ„å»ºè§¦å‘å™¨</li></ol><blockquote><p>è¿™æ ·æ¯æ¬¡åœ¨æäº¤ä»£ç åï¼Œjenkins å°±å¯ä»¥è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ„å»ºé¡¹ç›®</p></blockquote><p>å‹¾é€‰<code>GitHub hook trigger for GITScm polling</code></p><p><img src="/assets/img/jenkins-docker/jenkins-task-3.jpg"></p><ol start="5"><li>æ„å»ºç¯å¢ƒ</li></ol><p>è¿™é‡Œæ˜¯é€‰æ‹©é¡¹ç›®éœ€è¦çš„ nodejs ç‰ˆæœ¬ï¼Œnodejs çš„ç‰ˆæœ¬å°±æŒ‰ç€å‰é¢æ‰€è¯´çš„æ·»åŠ </p><p><img src="/assets/img/jenkins-docker/jenkins-task-4.jpg"></p><ol start="6"><li>æ„å»º-æ‰§è¡Œ shell</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-task-5.jpg"></p><p>å®Œæ•´ shell å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">node -v<br>npm -v<br>docker -v<br>sudo su<br><br>echo &quot;1.å¼€å§‹æ‰“åŒ…æ„å»º==&gt;&quot;<br>npm install -g yarn<br>yarn install<br>npm run build<br><br>&#123; # try<br>echo &quot;2.æš‚åœæ—§çš„å®¹å™¨==&gt;&quot;<br>  sudo docker container stop react-app<br>&#125; || &#123; # catch<br>  echo &quot;2.æ—§çš„å®¹å™¨ä¸å­˜åœ¨==&gt;&quot;<br>    # save log for exception<br>&#125;<br><br>&#123; # try<br>echo &quot;3.åˆ é™¤æ—§çš„å®¹å™¨==&gt;&quot;<br>  sudo docker container rm react-app<br>&#125; || &#123; # catch<br>  echo &quot;3.æ—§çš„å®¹å™¨ä¸å­˜åœ¨==&gt;&quot;<br>&#125;<br><br>&#123; # try<br>echo &quot;4.åˆ é™¤æ—§çš„é•œåƒ==&gt;&quot;<br>  sudo docker image rm react-app:latest<br>&#125; || &#123; # catch<br>  echo &quot;4.æ—§çš„é•œåƒä¸å­˜åœ¨==&gt;&quot;<br>&#125;<br><br>echo &quot;5.å¼€å§‹æ„å»º==&gt;&quot;<br>sudo docker image build -t react-app:latest .<br>sudo docker tag react-app:latest srect/react-app:latest<br><br>echo &quot;6.å¼€å§‹å¯åŠ¨docerå®¹å™¨==&gt;&quot;<br><br>sudo docker container run -d -p 8002:80 --name react-app react-app:latest<br></code></pre></div></td></tr></table></figure><ol start="7"><li>ç‚¹å‡»ä¿å­˜ï¼Œç„¶å<code>ç«‹å³æ„å»º</code>ï¼Œå¯ä»¥è¿›å…¥ä»»åŠ¡ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥çœ‹å…·ä½“çš„æ„å»ºæ—¥å¿—</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-console.jpg"></p><ol start="8"><li>æˆ‘ä»¬å¯ä»¥éšä¾¿ä¿®æ”¹ä¸‹å‰ç«¯ä»£ç ï¼Œç„¶åæäº¤ä»£ç ï¼Œæµ‹è¯•æ˜¯å¦ä¼šè‡ªåŠ¨æ„å»º</li></ol><p><img src="/assets/img/jenkins-docker/jenkins-github-hook-log.jpg"></p><h3 id="6-å‚è€ƒèµ„æ–™"><a href="#6-å‚è€ƒèµ„æ–™" class="headerlink" title="6. å‚è€ƒèµ„æ–™"></a>6. å‚è€ƒèµ„æ–™</h3><ol><li><a href="http://www.up4dev.com/2018/11/27/run-docker-by-jenkins-in-docker/">ç”¨å®‰è£…åœ¨ Docker ä¸­çš„ jenkins è¿è¡Œ Docker ä»»åŠ¡</a></li><li><a href="https://blog.csdn.net/qq_35566908/article/details/103149181">Jenkins+Github å®ç°è‡ªåŠ¨è§¦å‘æ„å»º</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jenkins</tag>
      
      <tag>docker</tag>
      
      <tag>ci</tag>
      
      <tag>cd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰“é€ ä¸€ä¸ªä¿å­˜æ˜é‡‘æ–‡ç« çš„ cli</title>
    <link href="/2022/02/18/mycli/"/>
    <url>/2022/02/18/mycli/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="https://www.npmjs.com/package/juejin-save">npm package</a></li><li><a href="https://github.com/sRect/juejin-save">github æºç ä»“åº“</a></li></ul><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm i juejin-save -g<br></code></pre></div></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight gauss"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gauss">juejin-<span class="hljs-keyword">save</span> <span class="hljs-keyword">save</span> https:<span class="hljs-comment">//xxx</span><br></code></pre></div></td></tr></table></figure><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="/assets/img/mycli/GIF.gif" alt="gif"></p><hr><h3 id="1-ä¸»è¦-package-version"><a href="#1-ä¸»è¦-package-version" class="headerlink" title="1. ä¸»è¦ package version"></a>1. ä¸»è¦ package version</h3><blockquote><p>æ³¨æ„ï¼šæ–‡ç« é‡ç‚¹åœ¨äºæ‰“é€  cliï¼Œä¸æ˜¯ puppeteer</p></blockquote><table><thead><tr><th align="left">package</th><th align="left">version</th><th align="left">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="left"><a href="https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md#%E5%91%BD%E4%BB%A4">commander</a></td><td align="left">^9.0.0</td><td align="left">åˆ›å»ºå¤„ç†å‘½ä»¤</td></tr><tr><td align="left"><a href="https://github.com/SBoudrias/Inquirer.js/#objects">inquirer</a></td><td align="left">^8.2.0</td><td align="left">å¤„ç†äº¤äº’</td></tr><tr><td align="left"><a href="https://www.npmjs.com/package/ora">ora</a></td><td align="left">^5.4.1</td><td align="left">å¤„ç† loading</td></tr><tr><td align="left"><a href="https://github.com/puppeteer/puppeteer">puppeteer</a></td><td align="left">^13.3.2</td><td align="left">é€šè¿‡ api æ¥æ§åˆ¶ Chromium æˆ– Chrome</td></tr></tbody></table><h3 id="2-é¡¹ç›®ç›®å½•ç»“æ„"><a href="#2-é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="2. é¡¹ç›®ç›®å½•ç»“æ„"></a>2. é¡¹ç›®ç›®å½•ç»“æ„</h3><figure class="highlight actionscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs actionscript">â”œâ”€â”€ bin<br>|  â””â”€â”€ cli.js          <span class="hljs-comment">// å…¥å£æ–‡ä»¶</span><br>â”œâ”€â”€ LICENSE<br>â”œâ”€â”€ <span class="hljs-keyword">package</span>-lock.json<br>â”œâ”€â”€ <span class="hljs-keyword">package</span>.json<br>â”œâ”€â”€ puppeteer.js       <span class="hljs-comment">// puppeteerä¿å­˜æ–‡ç« æ–‡ä»¶</span><br>â””â”€â”€ README.md<br></code></pre></div></td></tr></table></figure><h3 id="2-package-json-ä¸­æ·»åŠ binå­—æ®µ"><a href="#2-package-json-ä¸­æ·»åŠ binå­—æ®µ" class="headerlink" title="2. package.json ä¸­æ·»åŠ binå­—æ®µ"></a>2. package.json ä¸­æ·»åŠ <code>bin</code>å­—æ®µ</h3><blockquote><p>æ·»åŠ <code>juejin-save</code>å‘½ä»¤ï¼ŒæŒ‡å®šè¿è¡Œæ–‡ä»¶ä¸º bin ç›®å½• cli.js</p></blockquote><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff"><span class="hljs-addition">+ &#123;</span><br><span class="hljs-addition">+   &quot;bin&quot;: &#123;</span><br><span class="hljs-addition">+     &quot;juejin-save&quot;: &quot;bin/cli.js&quot;</span><br><span class="hljs-addition">+   &#125;</span><br><span class="hljs-addition">+ &#125;</span><br></code></pre></div></td></tr></table></figure><h3 id="3-ä¸»è¦-package-api-ä»‹ç»"><a href="#3-ä¸»è¦-package-api-ä»‹ç»" class="headerlink" title="3. ä¸»è¦ package api ä»‹ç»"></a>3. ä¸»è¦ package api ä»‹ç»</h3><h4 id="3-1-commander"><a href="#3-1-commander" class="headerlink" title="3.1 commander"></a>3.1 commander</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Command</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;commander&quot;</span>);<br><span class="hljs-keyword">const</span> program = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>();<br><br>program<br>  .<span class="hljs-title function_">command</span>(<span class="hljs-string">&quot;clone &lt;source&gt; [destination]&quot;</span>)<br>  .<span class="hljs-title function_">description</span>(<span class="hljs-string">&quot;clone a repository into a newly created directory&quot;</span>)<br>  .<span class="hljs-title function_">action</span>(<span class="hljs-function">(<span class="hljs-params">source, destination</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;clone command called&quot;</span>);<br>  &#125;);<br><br>program.<span class="hljs-title function_">parse</span>();<br></code></pre></div></td></tr></table></figure><h4 id="3-2-inquirer"><a href="#3-2-inquirer" class="headerlink" title="3.2 inquirer"></a>3.2 inquirer</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> inquirer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;inquirer&quot;</span>);<br>inquirer<br>  .<span class="hljs-title function_">prompt</span>([<br>    <span class="hljs-comment">/* Pass your questions in here */</span><br>  ])<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answers</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// Use user feedback for... whatever!!</span><br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">isTtyError</span>) &#123;<br>      <span class="hljs-comment">// Prompt couldn&#x27;t be rendered in the current environment</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// Something else went wrong</span><br>    &#125;<br>  &#125;);<br></code></pre></div></td></tr></table></figure><h4 id="3-3-ora"><a href="#3-3-ora" class="headerlink" title="3.3 ora"></a>3.3 ora</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> ora <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ora&quot;</span>;<br><br><span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>(<span class="hljs-string">&quot;Loading unicorns&quot;</span>).<span class="hljs-title function_">start</span>();<br><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  spinner.<span class="hljs-property">color</span> = <span class="hljs-string">&quot;yellow&quot;</span>;<br>  spinner.<span class="hljs-property">text</span> = <span class="hljs-string">&quot;Loading rainbows&quot;</span>;<br>&#125;, <span class="hljs-number">1000</span>);<br></code></pre></div></td></tr></table></figure><h4 id="3-4-puppeteer"><a href="#3-4-puppeteer" class="headerlink" title="3.4 puppeteer"></a>3.4 puppeteer</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;puppeteer&quot;</span>);<br><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>();<br>  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();<br>  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">&quot;https://example.com&quot;</span>);<br>  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">screenshot</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;example.png&quot;</span> &#125;);<br><br>  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();<br>&#125;)();<br></code></pre></div></td></tr></table></figure><h3 id="4-ä¸»è¦é€»è¾‘ä»£ç "><a href="#4-ä¸»è¦é€»è¾‘ä»£ç " class="headerlink" title="4. ä¸»è¦é€»è¾‘ä»£ç "></a>4. ä¸»è¦é€»è¾‘ä»£ç </h3><ol><li>bin&#x2F;cli.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-meta">#!/usr/bin/env node</span><br><br><span class="hljs-keyword">const</span> inquirer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;inquirer&quot;</span>);<br><span class="hljs-keyword">const</span> ora = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ora&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Command</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;commander&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; puppeteerInit, saveToHtml, saveToMd, saveToPdf &#125; = <span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(<br>  __dirname,<br>  <span class="hljs-string">&quot;../puppeteer&quot;</span><br>));<br><br><span class="hljs-keyword">const</span> program = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>();<br><span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>();<br><br><span class="hljs-comment">// äº¤äº’å¼è¯¢é—®</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePrompt</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> inquirer.<span class="hljs-title function_">prompt</span>([<br>    &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;autoCreateFolder&quot;</span>,<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">`Automatically create folders?`</span>,<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;confirm&quot;</span>,<br>    &#125;,<br>    <span class="hljs-comment">//...</span><br>  ]);<br>&#125;<br><br><span class="hljs-comment">// è¯¢é—®è¿‡åçš„å¤„ç†,å¼€å§‹puppeteeråˆå§‹åŒ–</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AfterePrompt</span>(<span class="hljs-params">articleUrl, answers</span>) &#123;<br>  spinner.<span class="hljs-property">color</span> = <span class="hljs-string">&quot;yellow&quot;</span>;<br>  spinner.<span class="hljs-title function_">start</span>(<span class="hljs-string">&quot;puppeteer intial...&quot;</span>);<br><br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">await</span> <span class="hljs-title function_">puppeteerInit</span>(articleUrl, answers);<br><br>  spinner.<span class="hljs-title function_">stopAndPersist</span>(&#123;<br>    <span class="hljs-attr">symbol</span>: chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&quot;âœ“&quot;</span>),<br>    <span class="hljs-attr">text</span>: chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&quot;puppeteer init ok&quot;</span>),<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> obj;<br>&#125;<br><br><span class="hljs-comment">// å¯¼å‡ºæ–‡ä»¶</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportFile</span>(<span class="hljs-params">arg</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; page, outMdFilePath, outPdfFilePath, outHtmlfFilePath &#125; = arg;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveToMd</span>(page, outMdFilePath);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveToPdf</span>(page, outPdfFilePath);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveToHtml</span>(page, outHtmlfFilePath);<br>&#125;<br><br><span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå‘½ä»¤</span><br>program<br>  .<span class="hljs-title function_">version</span>(<span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../package.json&quot;</span>)).<span class="hljs-property">version</span>)<br>  .<span class="hljs-title function_">command</span>(<span class="hljs-string">&quot;save  &lt;article-url&gt;&quot;</span>)<br>  .<span class="hljs-title function_">description</span>(<span class="hljs-string">&quot;save https://xxx&quot;</span>)<br>  .<span class="hljs-title function_">action</span>(<span class="hljs-keyword">async</span> (articleUrl) =&gt; &#123;<br>    <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šäº¤äº’å¼è¯¢é—®</span><br>    <span class="hljs-keyword">const</span> answers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">handlePrompt</span>(articleUrl);<br>    <span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼šæ‹¿åˆ°äº¤äº’ç»“æœ</span><br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AfterePrompt</span>(articleUrl, answers);<br>    <span class="hljs-comment">// ç¬¬å››æ­¥ï¼šå¯¼å‡ºæ–‡ä»¶</span><br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">exportFile</span>(data);<br><br>    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;);<br><br>program.<span class="hljs-title function_">parse</span>();<br></code></pre></div></td></tr></table></figure><ol start="2"><li>puppeteer.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;puppeteer&quot;</span>);<br><br><span class="hljs-comment">// ä¿å­˜html</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToHtml</span>(<span class="hljs-params">page, outHtmlfFilePath</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// ä¿å­˜markdown</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToMd</span>(<span class="hljs-params">page, outMdFilePath</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// ä¿å­˜pdf</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToPdf</span>(<span class="hljs-params">page, outPdfFilePath</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// puppeteeråˆå§‹åŒ–</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">puppeteerInit</span>(<span class="hljs-params">href</span>) &#123;<br>  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>();<br>  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();<br>  page.<span class="hljs-title function_">setViewport</span>(&#123;<br>    <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,<br>    <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span>,<br>  &#125;);<br><br>  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(href, &#123;<br>    <span class="hljs-attr">waitUntil</span>: <span class="hljs-string">&quot;domcontentloaded&quot;</span>,<br>    <span class="hljs-attr">referer</span>: href,<br>  &#125;);<br>  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">waitForTimeout</span>(<span class="hljs-number">3000</span>); <span class="hljs-comment">// ç¡®ä¿é¡µé¢åŠ è½½å®Œæ¯•</span><br><br>  <span class="hljs-keyword">return</span> &#123;<br>    browser,<br>    page,<br>  &#125;;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  puppeteerInit,<br>  saveToHtml,<br>  saveToMd,<br>  saveToPdf,<br>&#125;;<br></code></pre></div></td></tr></table></figure><h3 id="5-æœ¬åœ°æµ‹è¯•"><a href="#5-æœ¬åœ°æµ‹è¯•" class="headerlink" title="5. æœ¬åœ°æµ‹è¯•"></a>5. æœ¬åœ°æµ‹è¯•</h3><ol><li>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm <span class="hljs-built_in">link</span><br></code></pre></div></td></tr></table></figure><p>æ‰§è¡Œå®Œä¹‹åï¼ŒæˆåŠŸæç¤ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">added</span> <span class="hljs-number">1</span> package, and audited <span class="hljs-number">3</span> packages in <span class="hljs-number">1</span>s<br><br><span class="hljs-attribute">found</span> <span class="hljs-number">0</span> vulnerabilities<br></code></pre></div></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨æœ¬æœºçš„ npm å…¨å±€å®‰è£…é‡Œæ‰¾åˆ°ä¸€ä¸ªè½¯é“¾æ¥ï¼Œå¦‚å›¾ï¼š</p><p><img src="/assets/img/mycli/cli.jpg"></p><ol start="2"><li>åœ¨ä»»æ„ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œï¼Œæ‰§è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">juejin-save save  https://juejin.cn/post/xxxx<br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ç« è¢«ä¿å­˜åœ¨æ–‡ä»¶å¤¹é‡Œé¢äº†ã€‚</p><h3 id="6-å‚è€ƒèµ„æ–™"><a href="#6-å‚è€ƒèµ„æ–™" class="headerlink" title="6. å‚è€ƒèµ„æ–™"></a>6. å‚è€ƒèµ„æ–™</h3><ol><li><p><a href="https://mp.weixin.qq.com/s/AH9fQdZnwMUcuczIVLOLVQ">æ‰‹å†™ä¸€ä¸ªåˆæ ¼çš„å‰ç«¯è„šæ‰‹æ¶</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/1jzwybwyH80uDzfvvmDe_Q">å®ç° CLI å¸¸ç”¨å·¥å…·åŒ… - ç»ˆç«¯äº¤äº’ç›¸å…³</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>cli</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cli</tag>
      
      <tag>puppeteer</tag>
      
      <tag>npm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¶…è¯¦ç»†æ‰‹æ‘¸æ‰‹å¸¦ä½ docker-compose + portaineréƒ¨ç½²ä½ çš„todolistå°åº”ç”¨</title>
    <link href="/2022/01/29/docker-compose-portainer/"/>
    <url>/2022/01/29/docker-compose-portainer/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="http://121.199.8.71:8001/">é¡¹ç›®çº¿ä¸Šé¢„è§ˆ</a></li><li><a href="https://github.com/sRect/docker-compose">github æºç ä»“åº“</a></li></ul><p>æ–‡ç« é‡Œå¾ˆå¤šéƒ½æ˜¯é…ç½®ï¼Œå¯ä»¥ç›´æ¥å…ˆç›´æ¥å¤åˆ¶è¿‡å»ä½¿ç”¨ï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½æºä»£ç è¿è¡Œï¼Œå…ˆè·‘é€šé¡¹ç›®ã€‚</p><h3 id="1-ä¸»è¦-package-version-å’Œæå‰å‡†å¤‡"><a href="#1-ä¸»è¦-package-version-å’Œæå‰å‡†å¤‡" class="headerlink" title="1. ä¸»è¦ package version å’Œæå‰å‡†å¤‡"></a>1. ä¸»è¦ package version å’Œæå‰å‡†å¤‡</h3><ol><li>package version</li></ol><table><thead><tr><th align="center">package</th><th align="center">version</th></tr></thead><tbody><tr><td align="center">koa</td><td align="center">^2.13.4</td></tr><tr><td align="center">sequelize</td><td align="center">^6.14.1</td></tr><tr><td align="center">vite</td><td align="center">^2.7.13</td></tr><tr><td align="center">vue</td><td align="center">^3.2.25</td></tr><tr><td align="center">pinia</td><td align="center">^2.0.6</td></tr></tbody></table><ol start="2"><li>æå‰å‡†å¤‡</li></ol><ul><li>1 å°çº¿ä¸ŠæœåŠ¡å™¨ï¼Œç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç­‰ç­‰ï¼Œå¹¶å®‰è£…å¥½ docker(æ•™ç¨‹è‡ªè¡Œæœç´¢ï¼Œå¾ˆç®€å•)ã€‚æ²¡æœ‰çš„ç”¨æœ¬åœ°è™šæ‹Ÿæœºä»£æ›¿ï¼Œè‡ªè¡Œç ”ç©¶</li><li>æ³¨å†Œä¸€ä¸ª dockerhub è´¦æˆ·ï¼Œæœ‰é˜¿é‡Œäº‘æœåŠ¡å™¨çš„ä¼šè‡ªå¸¦å®¹å™¨é•œåƒæœåŠ¡å¯ä»¥ç”¨ï¼Œå¯ä»¥ä¸ç”¨æ³¨å†Œ dockerhub</li><li>æ³¨å†Œä¸€ä¸ª github è´¦æˆ·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä»“åº“ã€‚æ–‡ç« ä»¥ github ä¸ºä¾‹ï¼Œgitee çš„è‡ªè¡Œç ”ç©¶</li></ul><h3 id="2-é¡¹ç›®ç›®å½•è§£æ„"><a href="#2-é¡¹ç›®ç›®å½•è§£æ„" class="headerlink" title="2. é¡¹ç›®ç›®å½•è§£æ„"></a>2. é¡¹ç›®ç›®å½•è§£æ„</h3><blockquote><p>é¡¹ç›®ç›®å½•ç»“æ„ç®€å•ï¼Œå‰ç«¯åº”ç”¨æ”¾åœ¨<code>web</code>ç›®å½•å†…ï¼Œæ•°æ®åº“æ”¾åœ¨<code>mysql</code>ç›®å½•å†…ï¼Œå…¶å®ƒçš„æ˜¯åå°<code>koa</code>åº”ç”¨</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs 1c">â”œâ”€â”€ docker-compose.yml  <span class="hljs-meta"># docker-composeé…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ Dockerfile <span class="hljs-meta"># åå°koaçš„å®¹å™¨é•œåƒé…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ <span class="hljs-built_in">log</span> <span class="hljs-meta"># æ—¥å¿—å­˜å‚¨</span><br><span class="hljs-string">|  â”œâ”€â”€ access.log-2022-01-28.log</span><br><span class="hljs-string">|  â”œâ”€â”€ application.log-2022-01-28.log</span><br><span class="hljs-string">|  â””â”€â”€ mysql.log-2022-01-28.log</span><br>â”œâ”€â”€ middleware <span class="hljs-meta"># koaä¸­é—´ä»¶</span><br><span class="hljs-string">|  â”œâ”€â”€ handleGlobalError.js</span><br><span class="hljs-string">|  â”œâ”€â”€ index.js</span><br><span class="hljs-string">|  â””â”€â”€ logClientDevices.js</span><br>â”œâ”€â”€ mysql <span class="hljs-meta"># mysqlé…ç½®æ–‡ä»¶</span><br><span class="hljs-string">|  â”œâ”€â”€ create_db.sql # åˆ›å»ºæ•°æ®åº“sql</span><br><span class="hljs-string">|  â”œâ”€â”€ Dockerfile # mysqlçš„å®¹å™¨é•œåƒé…ç½®æ–‡ä»¶</span><br><span class="hljs-string">|  â”œâ”€â”€ initial_data.sql # åˆå§‹åŒ–æ•°æ®è¡¨sql</span><br><span class="hljs-string">|  â”œâ”€â”€ privileges.sql # ä¿®æ”¹mysqlè´¦å·æƒé™å¯†ç </span><br><span class="hljs-string">|  â””â”€â”€ setup.sh # å®¹å™¨å¯åŠ¨æ‰§è¡Œçš„shell</span><br>â”œâ”€â”€ package-lock.json<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ public <span class="hljs-meta"># koa-staticé™æ€æ–‡ä»¶é…ç½®ç›®å½•</span><br><span class="hljs-string">|  â”œâ”€â”€ favicon.ico</span><br><span class="hljs-string">|  â””â”€â”€ index2.html</span><br>â”œâ”€â”€ README.md<br>â”œâ”€â”€ routes <span class="hljs-meta"># @koa/routerçš„æ¥å£è·¯ç”±</span><br><span class="hljs-string">|  â”œâ”€â”€ todoList.js</span><br><span class="hljs-string">|  â””â”€â”€ uuid.js</span><br>â”œâ”€â”€ server.js <span class="hljs-meta"># koaçš„å¯åŠ¨æ–‡ä»¶</span><br>â”œâ”€â”€ util<br><span class="hljs-string">|  â”œâ”€â”€ db.js # mysqlè¿æ¥é…ç½®</span><br><span class="hljs-string">|  â””â”€â”€ logger.js # koa-log4çš„æ—¥å¿—é…ç½®</span><br>â””â”€â”€ web <span class="hljs-meta"># vueå‰ç«¯åº”ç”¨</span><br>    â”œâ”€â”€ Dockerfile<br>    â”œâ”€â”€ index.html<br>    â”œâ”€â”€ nginx.conf<br>    â”œâ”€â”€ package.json<br>    â”œâ”€â”€ public<br>    â”œâ”€â”€ README.md<br>    â”œâ”€â”€ src<br>    <span class="hljs-string">|  â”œâ”€â”€ App.vue</span><br>    <span class="hljs-string">|  â”œâ”€â”€ assets</span><br>    <span class="hljs-string">|  â”œâ”€â”€ components</span><br>    <span class="hljs-string">|  â”œâ”€â”€ main.js</span><br>    <span class="hljs-string">|  â”œâ”€â”€ services # æ¥å£</span><br>    <span class="hljs-string">|  â””â”€â”€ store # PiniaçŠ¶æ€ç®¡ç†</span><br>    â”œâ”€â”€ vite.config.js<br>    â””â”€â”€ yarn.lock<br></code></pre></div></td></tr></table></figure><h3 id="3-å‰ç«¯éƒ¨åˆ†"><a href="#3-å‰ç«¯éƒ¨åˆ†" class="headerlink" title="3. å‰ç«¯éƒ¨åˆ†"></a>3. å‰ç«¯éƒ¨åˆ†</h3><blockquote><p>å½“ç„¶è¦ç”¨æœ€è¿‘ç‚’çš„ç«çƒ­çš„ Pinia çŠ¶æ€ç®¡ç† + vue3 æ¥å†™ todolist åº”ç”¨äº†</p></blockquote><p><img src="/assets/img/portainer/todolist.jpg" alt="todolist.jpg"></p><h4 id="3-1-Pinia-çŠ¶æ€ç®¡ç†å¿«é€Ÿä¸Šæ‰‹ï¼Œå¯¹ç€æ–‡æ¡£å¼€æ’¸"><a href="#3-1-Pinia-çŠ¶æ€ç®¡ç†å¿«é€Ÿä¸Šæ‰‹ï¼Œå¯¹ç€æ–‡æ¡£å¼€æ’¸" class="headerlink" title="3.1 Pinia çŠ¶æ€ç®¡ç†å¿«é€Ÿä¸Šæ‰‹ï¼Œå¯¹ç€æ–‡æ¡£å¼€æ’¸"></a>3.1 <a href="https://pinia.esm.dev/introduction.html#a-more-realistic-example">Pinia çŠ¶æ€ç®¡ç†å¿«é€Ÿä¸Šæ‰‹</a>ï¼Œå¯¹ç€æ–‡æ¡£å¼€æ’¸</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// src/store/index.js</span><br><span class="hljs-keyword">import</span> &#123; defineStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;pinia&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> types <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./types&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useTodosStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">&quot;todos&quot;</span>, &#123;<br>  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> (&#123;<br>    <span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">&#123; msg: string, id: string, is_finished: boolean, create_time: date </span>&#125;[]&#125; */</span><br>    <span class="hljs-attr">todos</span>: [],<br>    <span class="hljs-attr">filter</span>: types.<span class="hljs-property">ALL</span>,<br>    <span class="hljs-attr">nextId</span>: <span class="hljs-number">0</span>,<br>  &#125;),<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">finishedTodos</span>(<span class="hljs-params">state</span>) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> todo.<span class="hljs-property">is_finished</span>);<br>    &#125;,<br>    <span class="hljs-title function_">unfinishedTodos</span>(<span class="hljs-params">state</span>) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo</span>) =&gt;</span> !todo.<span class="hljs-property">is_finished</span>);<br>    &#125;,<br>    <span class="hljs-title function_">filterTodos</span>(<span class="hljs-params">state</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">filter</span> === types.<span class="hljs-property">FINISHED</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">finishedTodos</span>;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">filter</span> === types.<span class="hljs-property">UNFINISHED</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">unfinishedTodos</span>;<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>;<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">actions</span>: &#123;<br>    <span class="hljs-title function_">addTodos</span>(<span class="hljs-params">&#123; id, msg, create_time &#125;</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">unshift</span>(&#123; id, msg, create_time, <span class="hljs-attr">is_finished</span>: <span class="hljs-literal">false</span> &#125;);<br>    &#125;,<br>    <span class="hljs-title function_">finishedOneTodo</span>(<span class="hljs-params">obj</span>) &#123;<br>      <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> === obj.<span class="hljs-property">id</span>);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>, &#123;<br>        ...obj,<br>        <span class="hljs-attr">is_finished</span>: <span class="hljs-literal">true</span>,<br>      &#125;);<br>    &#125;,<br>    <span class="hljs-title function_">deleteOne</span>(<span class="hljs-params">id</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> !== id);<br>    &#125;,<br>    <span class="hljs-title function_">setInitialData</span>(<span class="hljs-params">arr</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">todos</span> = [...arr];<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="3-2-å…³äº-vite-element-plus-å¯åŠ¨æŠ¥é”™-error-while-updating-dependencies"><a href="#3-2-å…³äº-vite-element-plus-å¯åŠ¨æŠ¥é”™-error-while-updating-dependencies" class="headerlink" title="3.2 å…³äº vite+element-plus å¯åŠ¨æŠ¥é”™ error while updating dependencies"></a>3.2 å…³äº vite+element-plus å¯åŠ¨æŠ¥é”™ error while updating dependencies</h4><p>æŠ¥é”™éƒ¨åˆ†ï¼š</p><figure class="highlight moonscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs moonscript">ä¸Šåˆ<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">22</span> [vite] new dependencies <span class="hljs-name">found</span>: element-plus/es, element-plus/es/components/option/style/css, updating...<br>ä¸Šåˆ<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">22</span> [vite] Failed to <span class="hljs-built_in">load</span> source map <span class="hljs-keyword">for</span> /node_modules/.vite/chunk-TPOPRDHF.js?v=e12284c2.<br> &gt; <span class="hljs-name">error</span>: Failed to write to output <span class="hljs-name">file</span>: open <span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\.vite\element-plus.<span class="hljs-name">js</span>: Access is denied.<br><br>ä¸Šåˆ<span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">37</span> [vite] <span class="hljs-built_in">error</span> <span class="hljs-keyword">while</span> updating <span class="hljs-name">dependencies</span>:<br><span class="hljs-name">Error</span>: Build failed with <span class="hljs-number">1</span> <span class="hljs-name">error</span>:<br><span class="hljs-name">error</span>: Failed to write to output <span class="hljs-name">file</span>: open <span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\.vite\element-plus.<span class="hljs-name">js</span>: Access is denied.<br>    at failureErrorWithLog (<span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">1493</span>:<span class="hljs-number">15</span>)<br>    at <span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">1151</span>:<span class="hljs-number">28</span><br>    at runOnEndCallbacks (<span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">941</span>:<span class="hljs-number">63</span>)<br>    at buildResponseToResult (<span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">1149</span>:<span class="hljs-number">7</span>)<br>    at <span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">1258</span>:<span class="hljs-number">14</span><br>    at <span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">629</span>:<span class="hljs-number">9</span><br>    at handleIncomingPacket (<span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">726</span>:<span class="hljs-number">9</span>)<br>    at Socket.readFromStdout (<span class="hljs-name">D</span>:\my\resource\Vue.js\vue3+Pinia\node_modules\esbuild\lib\main.<span class="hljs-name">js</span>:<span class="hljs-number">596</span>:<span class="hljs-number">7</span>)<br>    at Socket.emit (events.<span class="hljs-name">js</span>:<span class="hljs-number">400</span>:<span class="hljs-number">28</span>)<br>    at addChunk (internal/streams/readable.<span class="hljs-name">js</span>:<span class="hljs-number">290</span>:<span class="hljs-number">12</span>)<br></code></pre></div></td></tr></table></figure><p>ä¸€ç•ªæŠ˜è…¾ï¼ˆåˆæ˜¯åˆ é™¤ node_modules é‡æ–° install å®‰è£…ï¼Œåˆæ˜¯å‡çº§ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œåˆæ˜¯æ£€æŸ¥æ–‡ä»¶å¤¹è·¯å¾„æœ‰æ— ä¸­æ–‡â€¦ï¼‰è¿‡åï¼Œæ‰¾åˆ°äº†<a href="https://github.com/nuxt/vite/issues/207#issuecomment-972655272">è§£å†³æ–¹æ³•</a>ï¼š</p><p><img src="/assets/img/portainer/vite.png" alt="vite.png"></p><p>å‡çº§ Node.js åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º 16.13.2ï¼‰ï¼Œåˆ æ‰ node_modules æ–‡ä»¶å¤¹ï¼Œé‡æ–°å®‰è£…ä¾èµ–ï¼Œå¯åŠ¨æ­£å¸¸</p><p>å¦‚æœä½ ä½¿ç”¨ nvmï¼Œå¯ä»¥è¿™æ ·å¿«æ·å‡çº§ nodejs</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">nvm install 16.13.2<br>nvm use 16.13.2<br></code></pre></div></td></tr></table></figure><h4 id="3-3-nginx-conf"><a href="#3-3-nginx-conf" class="headerlink" title="3.3 nginx.conf"></a>3.3 nginx.conf</h4><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs conf">server &#123;<br>    listen  80; #é…ç½®ç›‘å¬ç«¯å£<br>    charset utf-8;<br><br>    #charset koi8-r;<br>    #access_log  /var/log/nginx/host.access.log  main;<br><br>    location ~ /api/ &#123; # é…ç½®è·¨åŸŸè½¬å‘<br>        # æ³¨æ„è¿™é‡Œçš„é…ç½®ä»£ç†åç§°ä¸ºdocker-composeä¸­koaå®¹å™¨çš„åç§°<br>        proxy_pass  http://koa_server:4000;<br>        # rewrite ^/api/(.*)$ /$1 break;<br>        proxy_set_header Host $host;<br>        proxy_set_header X-Real-IP $remote_addr;<br>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>        client_max_body_size 100m;<br>    &#125;<br><br>    location / &#123;<br>        root   /usr/share/nginx/dist; #æœåŠ¡é»˜è®¤å¯åŠ¨ç›®å½•<br>        index  index.html index.htm; #é»˜è®¤è®¿é—®æ–‡ä»¶<br>        try_files $uri /index.html; # é˜²æ­¢æµè§ˆå™¨åˆ·æ–°åï¼Œé¡µé¢404<br>        client_max_body_size 100m;<br>    &#125;<br><br>    location =/admin &#123;<br>        deny all; #adminç›®å½•ç¦æ­¢ä»»ä½•äººè®¿é—®<br>    &#125;<br><br>    location ~\.java$ &#123;<br>        deny all; #åŒ¹é…æ‰€æœ‰javaæ–‡ä»¶ç¦æ­¢è®¿é—®<br>    &#125;<br><br>    error_page   500 502 503 504  /50x.html; #é”™è¯¯çŠ¶æ€çš„æ˜¾ç¤ºé¡µé¢ï¼Œé…ç½®åéœ€é‡å¯<br>    error_page 404 /404.html; #404é¡µé¢<br>    location = /50x.html &#123;<br>        root   /usr/share/nginx/html;<br>    &#125;<br><br>    gzip on; #å¼€å¯gzip<br>    gzip_buffers 32 4k; #è®¾ç½®å‹ç¼©æ‰€éœ€è¦çš„ç¼“å†²åŒºå¤§å°ï¼Œä»¥4kä¸ºå•ä½ï¼Œå¦‚æœæ–‡ä»¶ä¸º32kåˆ™ç”³è¯·32*4kçš„ç¼“å†²åŒº<br>    gzip_comp_level 6; #gzip å‹ç¼©çº§åˆ«ï¼Œ1-9ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©çš„è¶Šå¥½ï¼Œä¹Ÿè¶Šå ç”¨CPUæ—¶é—´<br>    gzip_min_length 4000; #gizpå‹ç¼©èµ·ç‚¹ï¼Œæ–‡ä»¶å¤§äº4kæ‰è¿›è¡Œå‹ç¼©<br>    gzip_vary on; # æ˜¯å¦åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encodingï¼Œå»ºè®®å¼€å¯<br>    gzip_static on; #nginxå¯¹äºé™æ€æ–‡ä»¶çš„å¤„ç†æ¨¡å—ï¼Œå¼€å¯åä¼šå¯»æ‰¾ä»¥.gzç»“å°¾çš„æ–‡ä»¶ï¼Œç›´æ¥è¿”å›ï¼Œä¸ä¼šå ç”¨cpuè¿›è¡Œå‹ç¼©ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¸è¿›è¡Œå‹ç¼©<br>    gzip_types text/xml text/javascript application/javascript text/css text/plain application/json application/x-javascript; # è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-4-Dockerfile"><a href="#3-4-Dockerfile" class="headerlink" title="3.4 Dockerfile"></a>3.4 Dockerfile</h4><blockquote><p>ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œå‡å°‘å®¹å™¨ä½“ç§¯</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.15</span> AS base<br><span class="hljs-keyword">ENV</span> NODE_ENV=production \<br>  APP_PATH=/app<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$APP_PATH</span></span><br><span class="hljs-comment"># ä½¿ç”¨apkå‘½ä»¤å®‰è£… nodejs å’Œ yarn</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apk add --no-cache --update nodejs=16.13.2-r0 yarn</span><br><br><span class="hljs-keyword">FROM</span> base AS install<br><span class="hljs-keyword">COPY</span><span class="language-bash"> package.json yarn.lock <span class="hljs-variable">$APP_PATH</span>/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn install</span><br><br><span class="hljs-keyword">FROM</span> base AS build<br><span class="hljs-comment"># æ‹·è´ä¸Šé¢ç”Ÿæˆçš„ node_modules æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æœ€ç»ˆçš„å·¥ä½œç›®å½•ä¸‹</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=install <span class="hljs-variable">$APP_PATH</span>/node_modules <span class="hljs-variable">$APP_PATH</span>/node_modules</span><br><span class="hljs-comment"># æ‹·è´å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ°å·¥ä½œç›®å½•(é™¤äº†.dockerignoreä¸­å¿½ç•¥çš„)</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . <span class="hljs-variable">$APP_PATH</span>/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn run build</span><br><br><span class="hljs-keyword">FROM</span> nginx:alpine<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /usr/share/nginx/dist</span><br><span class="hljs-comment"># æ·»åŠ è‡ªå·±çš„é…ç½® default.conf åœ¨ä¸‹é¢</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> nginx.conf /etc/nginx/conf.d/default.conf</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=build /app/dist .</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br></code></pre></div></td></tr></table></figure><h3 id="4-åå°éƒ¨åˆ†"><a href="#4-åå°éƒ¨åˆ†" class="headerlink" title="4. åå°éƒ¨åˆ†"></a>4. åå°éƒ¨åˆ†</h3><h4 id="4-1-å…¥å£æ–‡ä»¶"><a href="#4-1-å…¥å£æ–‡ä»¶" class="headerlink" title="4.1 å…¥å£æ–‡ä»¶"></a>4.1 å…¥å£æ–‡ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// server.js</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Router</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@koa/router&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ROOT</span> = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&quot;./&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; connectMySQL &#125; = <span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">ROOT</span>, <span class="hljs-string">&quot;./util/db&quot;</span>));<br><span class="hljs-keyword">const</span> todoList = <span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">ROOT</span>, <span class="hljs-string">&quot;./routes/todoList&quot;</span>));<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();<br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><br><span class="hljs-comment">// åŠ è½½æ‰€æœ‰å­è·¯ç”±</span><br>router.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api&quot;</span>, todoList.<span class="hljs-title function_">routes</span>(), todoList.<span class="hljs-title function_">allowedMethods</span>());<br><span class="hljs-comment">// åŠ è½½è·¯ç”±ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>()).<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">allowedMethods</span>());<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">4000</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">connectMySQL</span>();<br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="4-2-sequelize-è¿æ¥-mysql-æ•°æ®åº“"><a href="#4-2-sequelize-è¿æ¥-mysql-æ•°æ®åº“" class="headerlink" title="4.2 sequelize è¿æ¥ mysql æ•°æ®åº“"></a>4.2 <a href="https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/getting-started.md">sequelize è¿æ¥ mysql æ•°æ®åº“</a></h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// util/db.js</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Sequelize</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;sequelize&quot;</span>);<br><br><span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sequelize</span>(<span class="hljs-string">&quot;todolist&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>, &#123;<br>  <span class="hljs-attr">dialect</span>: <span class="hljs-string">&quot;mysql&quot;</span>,<br>  <span class="hljs-attr">dialectOptions</span>: &#123;<br>    <span class="hljs-attr">charset</span>: <span class="hljs-string">&quot;utf8mb4&quot;</span>,<br>    <span class="hljs-attr">collate</span>: <span class="hljs-string">&quot;utf8mb4_unicode_ci&quot;</span>,<br>    <span class="hljs-attr">supportBigNumbers</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">bigNumberStrings</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-comment">// è¿™é‡Œçš„hostï¼Œçº¿ä¸ŠæŒ‡å‘docker-composeä¸­mysqlçš„å®¹å™¨å</span><br>  <span class="hljs-attr">host</span>:<br>    process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span><br>      ? <span class="hljs-string">&quot;localhost&quot;</span><br>      : <span class="hljs-string">&quot;todolist_mysql_server&quot;</span>,<br>  <span class="hljs-attr">timezone</span>: <span class="hljs-string">&quot;+08:00&quot;</span>, <span class="hljs-comment">// ä¸œ8åŒº</span><br>  <span class="hljs-attr">port</span>: <span class="hljs-string">&quot;3306&quot;</span>,<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">connectMySQL</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">authenticate</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mysqlè¿æ¥æˆåŠŸ&quot;</span>);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥ï¼Œ3ç§’åé‡è¯•&quot;</span>);<br>    <span class="hljs-built_in">setTimeout</span>(connectMySQL, <span class="hljs-number">3000</span>);<br>  &#125;<br>&#125;;<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">connectMySQL</span> = connectMySQL;<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">db</span> = db;<br></code></pre></div></td></tr></table></figure><h4 id="4-3-æ¥å£ç¤ºä¾‹"><a href="#4-3-æ¥å£ç¤ºä¾‹" class="headerlink" title="4.3 æ¥å£ç¤ºä¾‹"></a>4.3 æ¥å£ç¤ºä¾‹</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// routes/todolist.js</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Router</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@koa/router&quot;</span>);<br><span class="hljs-keyword">const</span> dayjs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dayjs&quot;</span>);<br><span class="hljs-keyword">const</span> utc = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dayjs/plugin/utc&quot;</span>); <span class="hljs-comment">// dependent on utc plugin</span><br><span class="hljs-keyword">const</span> timezone = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;dayjs/plugin/timezone&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">QueryTypes</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;sequelize&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ROOT</span> = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&quot;./&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; db &#125; = <span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">ROOT</span>, <span class="hljs-string">&quot;./util/db&quot;</span>));<br><br><span class="hljs-keyword">const</span> todoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><span class="hljs-comment">// https://dayjs.gitee.io/docs/zh-CN/plugin/timezone</span><br>dayjs.<span class="hljs-title function_">extend</span>(utc);<br>dayjs.<span class="hljs-title function_">extend</span>(timezone);<br>dayjs.<span class="hljs-property">tz</span>.<span class="hljs-title function_">setDefault</span>(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>);<br><br><span class="hljs-comment">// åˆ—è¡¨æŸ¥è¯¢</span><br>todoList.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/todoList/list&quot;</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> reqParams = ctx.<span class="hljs-property">query</span>;<br>  <span class="hljs-comment">// https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/core-concepts/getting-started.md#promises-%E5%92%8C-asyncawait</span><br><br>  <span class="hljs-keyword">const</span> selects = &#123;<br>    <span class="hljs-number">0</span>: <span class="hljs-string">&quot;SELECT * FROM todolist WHERE is_finished=&#x27;0&#x27; ORDER BY create_time DESC;&quot;</span>,<br>    <span class="hljs-number">1</span>: <span class="hljs-string">&quot;SELECT * FROM todolist WHERE is_finished=&#x27;1&#x27; ORDER BY create_time DESC;&quot;</span>,<br>    <span class="hljs-number">2</span>: <span class="hljs-string">&quot;SELECT * FROM todolist ORDER BY create_time DESC;&quot;</span>,<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> filterType = reqParams.<span class="hljs-property">filterType</span> || <span class="hljs-string">&quot;2&quot;</span>;<br><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">let</span> list = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(selects[filterType], &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">QueryTypes</span>.<span class="hljs-property">SELECT</span>,<br>    &#125;);<br><br>    list = list.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> (&#123;<br>      ...item,<br>      <span class="hljs-attr">create_time</span>: <span class="hljs-title function_">dayjs</span>(item.<span class="hljs-property">create_time</span>)<br>        .<span class="hljs-title function_">tz</span>(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>)<br>        .<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>),<br>      <span class="hljs-attr">is_finished</span>: item.<span class="hljs-property">is_finished</span> === <span class="hljs-string">&quot;0&quot;</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>,<br>    &#125;));<br><br>    ctx.<span class="hljs-property">body</span> = &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,<br>      <span class="hljs-attr">data</span>: list || [],<br>      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;ok&quot;</span>,<br>    &#125;;<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br>  &#125;<br><br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = todoList;<br></code></pre></div></td></tr></table></figure><h4 id="4-4-Dockerfile"><a href="#4-4-Dockerfile" class="headerlink" title="4.4 Dockerfile"></a>4.4 Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.15</span> AS base<br><br><span class="hljs-keyword">ENV</span> NODE_ENV=production \<br>  APP_PATH=/www/node-server<br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$APP_PATH</span></span><br><br><span class="hljs-comment"># ä½¿ç”¨apkå‘½ä»¤å®‰è£… nodejs</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apk add --no-cache --update nodejs=16.13.2-r0 npm</span><br><br><span class="hljs-comment"># åŸºäºåŸºç¡€é•œåƒå®‰è£…é¡¹ç›®ä¾èµ–</span><br><span class="hljs-keyword">FROM</span> base AS install<br><br><span class="hljs-comment"># å°†å½“å‰ç›®å½•çš„package.json æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> package.json package-lock.json <span class="hljs-variable">$APP_PATH</span>/</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm install</span><br><br><span class="hljs-comment"># åŸºäºåŸºç¡€é•œåƒè¿›è¡Œæœ€ç»ˆæ„å»º</span><br><span class="hljs-keyword">FROM</span> base<br><br><span class="hljs-comment"># æ‹·è´ ä¸Šé¢ç”Ÿæˆçš„ node_modules æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æœ€ç»ˆçš„å·¥ä½œç›®å½•ä¸‹</span><br><span class="hljs-comment"># COPYå‘½ä»¤å¤åˆ¶æ–‡ä»¶å¤¹çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥å¤åˆ¶è¯¥æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯å°†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=install <span class="hljs-variable">$APP_PATH</span>/node_modules <span class="hljs-variable">$APP_PATH</span>/node_modules</span><br><span class="hljs-comment"># æ‹·è´å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ°å·¥ä½œç›®å½•(é™¤äº†.dockerignoreä¸­å¿½ç•¥çš„)</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . <span class="hljs-variable">$APP_PATH</span>/</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">4000</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;npm&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-string">&quot;server&quot;</span>]</span><br></code></pre></div></td></tr></table></figure><h4 id="4-5-æ³¨æ„äº‹é¡¹"><a href="#4-5-æ³¨æ„äº‹é¡¹" class="headerlink" title="4.5 æ³¨æ„äº‹é¡¹"></a>4.5 æ³¨æ„äº‹é¡¹</h4><ul><li>æ•°æ®åº“è¿æ¥é…ç½®æ—¶åŒº<code>timezone</code>ï¼Œè®¾ç½®ä¸ºä¸œ 8 åŒº</li><li>è®¾ç½®æ•°æ®åº“å­—ç¬¦é›†ä¸º<code>utf8mb4</code>ï¼Œæ–¹ä¾¿åé¢å­˜å‚¨è¡¨æƒ…ç¬¦</li><li><code>dayjs</code>åº“è°ƒæ•´æ˜¾ç¤ºä¸ºä¸œ 8 åŒºæ—¶é—´</li><li><code>sequelize</code>æŸ¥è¯¢å‡ºæ¥æœ‰é‡å¤é¡¹(éæ•°æ®åº“é‡Œçš„æ•°æ®é‡å¤)ï¼Œéœ€è¦é…ç½®<code>type</code>ä¸º<code>QueryTypes.SELECT</code></li></ul><h3 id="5-MySQL-éƒ¨åˆ†"><a href="#5-MySQL-éƒ¨åˆ†" class="headerlink" title="5. MySQL éƒ¨åˆ†"></a>5. MySQL éƒ¨åˆ†</h3><blockquote><p>è¿™é‡Œé€‰æ‹©çš„ç‰ˆæœ¬ä¸º<strong>5.7.30</strong>ç‰ˆæœ¬ï¼Œçº¿ä¸Š 8.0 ç‰ˆæœ¬æœªéƒ¨ç½²æˆåŠŸ</p></blockquote><h4 id="5-1-mysql-x2F-Dockerfile"><a href="#5-1-mysql-x2F-Dockerfile" class="headerlink" title="5.1 mysql&#x2F;Dockerfile"></a>5.1 mysql&#x2F;Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br><br><span class="hljs-keyword">LABEL</span><span class="language-bash"> version=<span class="hljs-string">&quot;1.0.0&quot;</span> description=<span class="hljs-string">&quot;todolist MySQL æœåŠ¡å™¨&quot;</span></span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /mysql</span><br><br><span class="hljs-keyword">ENV</span> MYSQL_ROOT_PASSWORD=<span class="hljs-number">123456</span><br><span class="hljs-comment"># MYSQL_DATABASE=todolist</span><br><span class="hljs-comment"># MYSQL_ALLOW_EMPTY_PASSWORD=yes</span><br><br><span class="hljs-comment"># å¯åŠ¨è„šæœ¬</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> setup.sh /mysql/setup.sh</span><br><span class="hljs-comment"># åˆ›å»ºæ•°æ®åº“</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> create_db.sql /mysql/create_db.sql</span><br><span class="hljs-comment"># åˆå§‹åŒ–æ•°æ®</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> initial_data.sql /mysql/initial_data.sql</span><br><span class="hljs-comment"># è®¾ç½®å¯†ç å’Œæƒé™</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> privileges.sql /mysql/privileges.sql</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3306</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;/mysql/setup.sh&quot;</span>]</span><br></code></pre></div></td></tr></table></figure><h4 id="5-2-mysql-setup-shå®¹å™¨å¯åŠ¨è„šæœ¬"><a href="#5-2-mysql-setup-shå®¹å™¨å¯åŠ¨è„šæœ¬" class="headerlink" title="5.2 mysql/setup.shå®¹å™¨å¯åŠ¨è„šæœ¬"></a>5.2 <code>mysql/setup.sh</code>å®¹å™¨å¯åŠ¨è„šæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><span class="hljs-comment"># https://xie.infoq.cn/article/a3c8ffbd34d818de010f2b0f6</span><br><span class="hljs-comment"># æ‰“å°mysqlæœåŠ¡çš„çŠ¶æ€</span><br><span class="hljs-built_in">echo</span> $(service mysql status)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;1.å¯åŠ¨mysql...&#x27;</span><br><span class="hljs-comment">#å¯åŠ¨mysql</span><br><span class="hljs-comment"># service mysql stop</span><br><span class="hljs-comment"># service mysql restart</span><br>service mysql start<br><br><span class="hljs-comment"># sleep 3</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;2.åˆ›å»ºæ•°æ®åº“...&#x27;</span><br>mysql &lt;/mysql/create_db.sql<br><span class="hljs-built_in">sleep</span> 3<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;3.å¼€å§‹å¯¼å…¥æ•°æ®...&#x27;</span><br>mysql &lt;/mysql/initial_data.sql<br><br><span class="hljs-built_in">sleep</span> 3<br><span class="hljs-built_in">echo</span> $(service mysql status)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;4.ä¿®æ”¹mysqlæƒé™...&#x27;</span><br>mysql &lt;/mysql/privileges.sql<br><span class="hljs-built_in">sleep</span> 3<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;4.æƒé™ä¿®æ”¹å®Œæ¯•...&#x27;</span><br><br><span class="hljs-comment"># é˜²æ­¢containerå¯åŠ¨åé€€å‡º</span><br><span class="hljs-comment"># http://www.mayanpeng.cn/archives/121.html</span><br><span class="hljs-built_in">tail</span> -f /dev/null<br></code></pre></div></td></tr></table></figure><h4 id="5-3-mysql-create-db-sqlåˆ›å»ºæ•°æ®åº“"><a href="#5-3-mysql-create-db-sqlåˆ›å»ºæ•°æ®åº“" class="headerlink" title="5.3 mysql/create_db.sqlåˆ›å»ºæ•°æ®åº“"></a>5.3 <code>mysql/create_db.sql</code>åˆ›å»ºæ•°æ®åº“</h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> todolist;<br></code></pre></div></td></tr></table></figure><h4 id="5-4-mysql-initial-data-sqlåˆå§‹åŒ–è¡¨"><a href="#5-4-mysql-initial-data-sqlåˆå§‹åŒ–è¡¨" class="headerlink" title="5.4 mysql/initial_data.sqlåˆå§‹åŒ–è¡¨"></a>5.4 <code>mysql/initial_data.sql</code>åˆå§‹åŒ–è¡¨</h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- ä½¿ç”¨todoliståº“</span><br>USE todolist;<br><br><span class="hljs-comment">-- åˆ›å»ºtodolistè¡¨</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> todolist(id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">PRIMARY</span> KEY, create_time DATETIME <span class="hljs-keyword">UNIQUE</span>, is_finished ENUM(<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>, msg <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;--&#x27;</span>) COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;todolistè¡¨&#x27;</span> ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-comment">-- æ‰“å°æ•°æ®åº“</span><br><span class="hljs-keyword">SHOW</span> TABLES;<br><br><span class="hljs-comment">-- æ‰“å°è¡¨ç»“æ„</span><br><span class="hljs-keyword">DESC</span> todolist;<br><br><span class="hljs-comment">-- æ’å…¥1æ¡é»˜è®¤æ•°æ®</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> todolist(id, create_time, is_finished, msg) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, NOW(), <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;hello world&#x27;</span>);<br></code></pre></div></td></tr></table></figure><h4 id="5-5-mysql-privileges-sqlè®¾ç½®æƒé™å¯†ç "><a href="#5-5-mysql-privileges-sqlè®¾ç½®æƒé™å¯†ç " class="headerlink" title="5.5 mysql/privileges.sqlè®¾ç½®æƒé™å¯†ç "></a>5.5 <code>mysql/privileges.sql</code>è®¾ç½®æƒé™å¯†ç </h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">use mysql;<br><span class="hljs-keyword">SELECT</span> host, <span class="hljs-keyword">user</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;<br><br><span class="hljs-comment">-- å°†æ•°æ®åº“çš„æƒé™æˆæƒç»™rootç”¨æˆ·ï¼Œå¯†ç ä¸º123456</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br><span class="hljs-comment">-- åˆ·æ–°æƒé™è¿™ä¸€æ¡å‘½ä»¤ä¸€å®šè¦æœ‰ï¼š</span><br>flush privileges;<br></code></pre></div></td></tr></table></figure><h3 id="6-éƒ¨ç½²å‡†å¤‡"><a href="#6-éƒ¨ç½²å‡†å¤‡" class="headerlink" title="6 éƒ¨ç½²å‡†å¤‡"></a>6 éƒ¨ç½²å‡†å¤‡</h3><h4 id="6-1-æå‰å‡†å¤‡å¥½"><a href="#6-1-æå‰å‡†å¤‡å¥½" class="headerlink" title="6.1 æå‰å‡†å¤‡å¥½"></a>6.1 æå‰å‡†å¤‡å¥½</h4><ol><li><p>åœ¨<code>dockerhub</code>è´¦å·æˆ–è€…<code>é˜¿é‡Œäº‘é•œåƒå®¹å™¨æœåŠ¡</code>åˆ›å»º 3 ä¸ªä»“åº“ï¼Œåˆ†åˆ«æ”¾ mysqlã€koaã€vue åº”ç”¨ï¼Œæˆ‘è¿™é‡Œåˆ›å»ºçš„æ˜¯<code>todolist_mysql</code>ã€<code>koa</code>å’Œ<code>vite_vue3_pinia</code>ï¼Œåœ¨ä¸‹é¢çš„ docker-compose.yml é…ç½®æ–‡ä»¶ä¸­ä¸€ä¸€å¯¹åº”<br><img src="/assets/img/portainer/dockerhub.jpg" alt="dockerhub.jpg"></p></li><li><p>åœ¨ä½ çš„<code>github</code>ä»“åº“é‡Œé‡Œé…ç½®å¥½ä¸Šé¢ dockerhub çš„è´¦å·å’Œå¯†ç <code>secrets</code>ï¼Œæ–¹ä¾¿äºåé¢ä½¿ç”¨ github ä»“åº“çš„ actions æ¨é€ã€‚æˆ‘è¿™é‡Œåˆ›å»ºçš„æ˜¯<code>DOCKERHUB_TOKEN</code>æ”¾å¯†ç ï¼Œ<code>DOCKERHUB_USERNAME</code>æ”¾è´¦æˆ·<br><img src="/assets/img/portainer/github.png" alt="github.png"></p></li></ol><h4 id="6-2-docker-compose-yml"><a href="#6-2-docker-compose-yml" class="headerlink" title="6.2 docker-compose.yml"></a>6.2 <code>docker-compose.yml</code></h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mysql:</span> <span class="hljs-comment"># mysql</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./mysql</span><br>    <span class="hljs-comment"># imageåç§°ä¸ºåœ¨dockerhubé‡Œåˆ›å»ºå¥½çš„åç§°</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ä½ çš„dockerè´¦æˆ·å/todolist_mysql:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">todolist_mysql_server</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-comment"># MYSQL_ROOT_PASSWORD: &quot;123456&quot;</span><br><br>  <span class="hljs-attr">node:</span> <span class="hljs-comment"># nodejsæœåŠ¡</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;mysql&quot;</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span> <span class="hljs-comment"># Dockerfileæ‰€åœ¨ç›®å½•æ„å»º</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ä½ çš„dockerè´¦æˆ·å/koa:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">koa_server</span><br>    <span class="hljs-comment"># ports:</span><br>    <span class="hljs-comment">#   - &quot;8001:4000&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span> <span class="hljs-comment"># è‡ªåŠ¨é‡å¯</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">server</span> <span class="hljs-comment"># è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</span><br><br>  <span class="hljs-attr">vue:</span><br>    <span class="hljs-attr">depends_on:</span> <span class="hljs-comment"># vue å®¹å™¨ä¼šä¿è¯åœ¨ nodeå®¹å™¨ä¹‹åå¯åŠ¨</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;node&quot;</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./web</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ä½ çš„dockerè´¦æˆ·å/vite_vue3_pinia:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">vite_vue3_pinia</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8001:80&quot;</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-attr">external:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">vue3-koa</span><br></code></pre></div></td></tr></table></figure><h4 id="6-3-github-ci-é…ç½®æ–‡ä»¶"><a href="#6-3-github-ci-é…ç½®æ–‡ä»¶" class="headerlink" title="6.3 github ci é…ç½®æ–‡ä»¶"></a>6.3 github ci é…ç½®æ–‡ä»¶</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-comment"># .github/workflows/ci.yml</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">+</span> <span class="hljs-string">Koa2</span> <span class="hljs-string">Server</span> <span class="hljs-string">+</span> <span class="hljs-string">Vue3</span> <span class="hljs-string">todolist</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>] <span class="hljs-comment"># ç›‘å¬mainåˆ†æ”¯</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span><br><br>      <span class="hljs-comment"># åˆ¶ä½œdockeré•œåƒå¹¶æ¨é€åˆ°dockerhub</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">docker</span> <span class="hljs-string">image</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          # è¿™é‡Œç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„secretså˜é‡</span><br><span class="hljs-string">          # ç™»å½•ä½ çš„dockerè´¦å·</span><br><span class="hljs-string">          docker login -u $&#123;&#123; secrets.DOCKERHUB_USERNAME &#125;&#125; -p $&#123;&#123; secrets.DOCKERHUB_TOKEN &#125;&#125;</span><br><span class="hljs-string">          # è¿›è¡Œdockeré•œåƒåˆ¶ä½œ</span><br><span class="hljs-string">          docker-compose build</span><br><span class="hljs-string">          # æ¨é€åˆ°ä½ çš„dockerè´¦æˆ·é‡Œ</span><br><span class="hljs-string">          docker-compose push</span><br><span class="hljs-string">          # é€€å‡ºç™»å½•</span><br><span class="hljs-string">          docker logout</span><br></code></pre></div></td></tr></table></figure><h4 id="6-4-æäº¤ä»£ç "><a href="#6-4-æäº¤ä»£ç " class="headerlink" title="6.4 æäº¤ä»£ç "></a>6.4 æäº¤ä»£ç </h4><blockquote><p>ç­‰ä¸åŠäº†ï¼Œæ˜¯æ—¶å€™è¿›è¡Œæäº¤ä»£ç äº†</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">git add .<br><br>git commit -m <span class="hljs-string">&quot;feat: init&quot;</span><br><br>git push -u origin main<br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œåœ¨ä»“åº“çš„<code>Actions</code>é‡Œçœ‹åˆ°æ„å»ºæˆåŠŸã€‚</p><p><img src="/assets/img/portainer/ci.png" alt="ci.png"></p><h3 id="7-Portainerå‡ºåœº"><a href="#7-Portainerå‡ºåœº" class="headerlink" title="7. Portainerå‡ºåœº"></a>7. <code>Portainer</code>å‡ºåœº</h3><blockquote><p>è´¹äº†è¿™ä¹ˆå¤§åŠ²ï¼Œtodolist è¿˜æ²¡çœ‹åˆ°ï¼Œæ˜¯æˆ‘çš„é”™ï¼Œæœ€åä¸€æ­¥äº†ï¼Œåˆ«æ”¾å¼ƒã€‚</p></blockquote><h4 id="7-1-Portainer-çš„å¥½å¤„"><a href="#7-1-Portainer-çš„å¥½å¤„" class="headerlink" title="7.1 Portainer çš„å¥½å¤„"></a>7.1 Portainer çš„å¥½å¤„</h4><p>è¿™å°±å¦‚åŒ gitï¼Œä½¿ç”¨ git GUI å·¥å…·å’Œ git bash å‘½ä»¤è¡Œå…¶ä»–ä¸€æ ·ï¼Œæ–¹ä¾¿å®¹å™¨ç®¡ç†æ“ä½œã€‚å¦‚æœä½ å–œæ¬¢å‘½ä»¤è¡Œï¼Œå°±ç›´æ¥è·³è¿‡è¿™ä¸€èŠ‚ï¼Œç›´æ¥éƒ¨ç½²å®¹å™¨å§ã€‚</p><p>æŠŠ git ä»“åº“ä»£ç ä¸‹è½½åˆ°æœåŠ¡å™¨ï¼Œ<code>docker compose up</code>å³å¯è§£å†³æˆ˜æ–—ï¼</p><h4 id="7-2-ç™»å½•ä½ çš„æœåŠ¡å™¨å®‰è£…portainerï¼Œæˆ‘è¿™é‡Œä¹‹å‰å®‰è£…çš„-1-24-2-ç‰ˆæœ¬"><a href="#7-2-ç™»å½•ä½ çš„æœåŠ¡å™¨å®‰è£…portainerï¼Œæˆ‘è¿™é‡Œä¹‹å‰å®‰è£…çš„-1-24-2-ç‰ˆæœ¬" class="headerlink" title="7.2 ç™»å½•ä½ çš„æœåŠ¡å™¨å®‰è£…portainerï¼Œæˆ‘è¿™é‡Œä¹‹å‰å®‰è£…çš„ 1.24.2 ç‰ˆæœ¬"></a>7.2 ç™»å½•ä½ çš„æœåŠ¡å™¨å®‰è£…<a href="https://hub.docker.com/r/portainer/portainer">portainer</a>ï¼Œæˆ‘è¿™é‡Œä¹‹å‰å®‰è£…çš„ 1.24.2 ç‰ˆæœ¬</h4><blockquote><p>å‰ææ˜¯åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šå®‰è£…å¥½ docker</p></blockquote><ol><li>ä¸‹è½½</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull portainer/portainer:latest<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è¿è¡Œ</li></ol><blockquote><p>æ³¨æ„ï¼š è¿™é‡Œä½ çš„æœåŠ¡å™¨çš„å®‰å…¨ç»„è¦å¼€æ”¾ 9000 ç«¯å£</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">docker run -d -p <span class="hljs-number">9000</span>:<span class="hljs-number">9000</span> -v <span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/docker.sock:/</span>var<span class="hljs-regexp">/run/</span>docker.sock --restart=always --name prtainer portainer/portainer<br></code></pre></div></td></tr></table></figure><h4 id="7-3-portainer-å®æ“"><a href="#7-3-portainer-å®æ“" class="headerlink" title="7.3 portainer å®æ“"></a>7.3 portainer å®æ“</h4><p>æµè§ˆå™¨é‡Œæ‰“å¼€<code>http://ä½ çš„æœåŠ¡å™¨å…¬ç½‘ip:9000</code>,è®¾ç½®å¥½è´¦æˆ·å’Œå¯†ç ï¼Œè¿›è¡Œç™»å½•ï¼Œå¹¶ä¸”è®¾ç½®æœ¬åœ°èŠ‚ç‚¹</p><p><img src="/assets/img/portainer/portainer.jpg" alt="portainer.png"></p><h4 id="7-3-1-æ‹‰å–åˆšæ‰æ¨åˆ°-dockerhub-çš„é•œåƒ"><a href="#7-3-1-æ‹‰å–åˆšæ‰æ¨åˆ°-dockerhub-çš„é•œåƒ" class="headerlink" title="7.3.1 æ‹‰å–åˆšæ‰æ¨åˆ° dockerhub çš„é•œåƒ"></a>7.3.1 æ‹‰å–åˆšæ‰æ¨åˆ° dockerhub çš„é•œåƒ</h4><blockquote><p>åˆšæ‰é‚£ 3 ä¸ªé•œåƒéƒ½è¦æ‹‰å–</p></blockquote><p><img src="/assets/img/portainer/portainer2.png" alt="portainer2.png"></p><p>å¦‚æœæ˜¯æ¨åˆ°é˜¿é‡Œäº‘é•œåƒå®¹å™¨çš„ï¼Œç‚¹å‡»å·¦ä¾§èœå• Registryï¼Œç„¶åè¿›å»ç‚¹å‡» Add registry æ·»åŠ ä½ çš„é•œåƒå®¹å™¨ urlï¼ŒåŒæ—¶å¯ä»¥é…ç½®<code>Authentication</code>,ä½ çš„è´¦å·å’Œå¯†ç ï¼Œç„¶åå°±å¯ä»¥å’Œä¸Šé¢ä¸€æ · pull é•œåƒäº†</p><p><img src="/assets/img/portainer/portainer3.jpg" alt="portainer3.png"></p><h4 id="7-3-2-è®¾ç½®å®¹å™¨-NetWorkï¼Œè¿›è¡Œå®¹å™¨é€šä¿¡"><a href="#7-3-2-è®¾ç½®å®¹å™¨-NetWorkï¼Œè¿›è¡Œå®¹å™¨é€šä¿¡" class="headerlink" title="7.3.2 è®¾ç½®å®¹å™¨ NetWorkï¼Œè¿›è¡Œå®¹å™¨é€šä¿¡"></a>7.3.2 è®¾ç½®å®¹å™¨ NetWorkï¼Œè¿›è¡Œå®¹å™¨é€šä¿¡</h4><blockquote><p>æˆ‘å—ä¸äº†ï¼Œåˆ°åº•è¿˜æœ‰å¤šå°‘æ­¥ï¼Œä½ éª—æˆ‘ã€‚çœŸçš„é©¬ä¸Šç»“æŸäº†</p></blockquote><p>å®è´¨æ˜¯ä½¿ç”¨äº† <code>docker network</code>ï¼Œç„¶åå†æŠŠè‡ªå·±çš„å®¹å™¨æ·»åŠ åˆ°è¿™ä¸ª network ä¸­æ¥</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">docker network create è‡ªå®šä¹‰bridgeåç§°<br>docker network connect è‡ªå®šä¹‰bridgeåç§° å®¹å™¨åç§°<br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”¨å›¾å½¢åŒ–ç•Œé¢æ“ä½œ</p><p><img src="/assets/img/portainer/portainer5.jpg" alt="portainer5.png"></p><h4 id="7-3-3-éƒ¨ç½²å®¹å™¨"><a href="#7-3-3-éƒ¨ç½²å®¹å™¨" class="headerlink" title="7.3.3 éƒ¨ç½²å®¹å™¨"></a>7.3.3 éƒ¨ç½²å®¹å™¨</h4><blockquote><p>æˆ‘çœŸçš„å—ä¸äº†äº†ï¼Œè¿˜æ²¡ç»“æŸå•Šï¼Œè¿™æ¬¡çœŸçš„ç»“æŸäº†</p></blockquote><p>ç‚¹å‡» container æ·»åŠ å®¹å™¨ã€‚è¿™é‡Œå¿…é¡»å’Œ docker-compose ä¸­çš„é¡ºåºä¸€æ ·ï¼Œå…ˆéƒ¨ç½² MySQLï¼Œå†éƒ¨ç½² Koaï¼Œæœ€åéƒ¨ç½² vue åº”ç”¨</p><p><img src="/assets/img/portainer/portainer4.jpg" alt="portainer4.png"></p><p>è¿›è¡Œéƒ¨ç½²é…ç½®ï¼ŒæŒ‰é¡ºåºéƒ¨ç½²å®Œ 3 ä¸ªå®¹å™¨ï¼Œå®¹å™¨åç§°å’Œç«¯å£å¿…é¡»éƒ½å¾—å’Œé…ç½®æ–‡ä»¶ä¸­çš„ä¸€æ ·</p><p><img src="/assets/img/portainer/portainer6.jpg" alt="portainer6.png"></p><h4 id="7-3-4-é˜¿å¼¥é™€ä½›"><a href="#7-3-4-é˜¿å¼¥é™€ä½›" class="headerlink" title="7.3.4 é˜¿å¼¥é™€ä½›"></a>7.3.4 é˜¿å¼¥é™€ä½›</h4><blockquote><p>xdmï¼ŒçœŸçš„ç»“æŸäº†ï¼Œæ˜¯æˆ‘æŠ˜ç£¨ä½ äº†ã€‚ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œ3 ä¸ªå®¹å™¨éƒ½éƒ¨ç½²æˆåŠŸ</p></blockquote><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ä½ çš„ todolist, <code>http://ä½ çš„ip:8001</code></p><h4 id="7-3-5-å…³äºä¿å­˜-emoji-å¤±è´¥"><a href="#7-3-5-å…³äºä¿å­˜-emoji-å¤±è´¥" class="headerlink" title="7.3.5 å…³äºä¿å­˜ emoji å¤±è´¥"></a>7.3.5 å…³äºä¿å­˜ emoji å¤±è´¥</h4><blockquote><p>å› ä¸ºå‰é¢åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œmsg åˆ—æ²¡æœ‰ä½¿ç”¨<code>utf8mb4</code>å­—ç¬¦é›†ã€‚é‚£ä¸ºä»€ä¹ˆä¸åœ¨å»ºè¡¨çš„æ—¶å€™å°±è®¾ç½®å¥½ï¼Œæˆ‘é”™äº†ï¼Œxdmï¼Œææˆ‘å§</p></blockquote><blockquote><p>è§‰å¾—å¤æ‚éš¾å—çš„ï¼Œç›´æ¥è·³è¿‡</p></blockquote><p><strong>docker è¿›å…¥å®¹å™¨å®æˆ˜</strong></p><p>å‰ææ˜¯ç™»å½•ä½ çš„æœåŠ¡å™¨</p><ol><li>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker container ls<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è¿›å…¥å®¹å™¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it ä¸Šé¢mysqlå®¹å™¨çš„CONTAINER ID sh<br></code></pre></div></td></tr></table></figure><ol start="3"><li>è¿æ¥ mysql</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">mysql -h localhost -u root -p<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç„¶åè¾“å…¥è®¾ç½®çš„å¯†ç </span><br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œæˆ‘ä»¬æˆåŠŸè¿›å…¥å®¹å™¨å†…ï¼Œå¹¶è¿æ¥ä¸Šäº† mysql</p><figure class="highlight smali"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs smali">[root@iZbp19ftqv2b85av0b2d4qZ /]<span class="hljs-comment"># docker exec -it a206f021c205 sh</span><br><span class="hljs-comment"># mysql -h localhost -u root -p</span><br>Enter password:<br>Welcome to the MySQ<span class="hljs-class">L monitor.  Commands end with ;</span><span class="hljs-built_in"> or </span>\g.<br>Your MySQL connection id is 53<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2020, Oracle<span class="hljs-built_in"> and/or </span>its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation<span class="hljs-built_in"> and/or </span>its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27;<span class="hljs-built_in"> or </span>&#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>ä¿®æ”¹ todolist è¡¨çš„ msg åˆ—å±æ€§</li></ol><ul><li>ä½¿ç”¨ todolist åº“</li></ul><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">USE todolist;<br></code></pre></div></td></tr></table></figure><ul><li>è¿›è¡Œä¿®æ”¹</li></ul><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> todolist MODIFY msg <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8mb4 <span class="hljs-keyword">collate</span> utf8mb4_unicode_ci <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;--&#x27;</span>;<br>Query OK, <span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.04</span> sec)<br>Records: <span class="hljs-number">6</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure><ul><li>éªŒè¯æ˜¯å¦ä¿®æ”¹æˆåŠŸ</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œmsg åˆ—å·²ç»ä¿®æ”¹æˆåŠŸäº†</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> todolist\G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>       <span class="hljs-keyword">Table</span>: todolist<br><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Table</span>: <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `todolist` (<br>  `id` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `is_finished` enum(<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>  `msg` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;--&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `create_time` (`create_time`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;todolistè¡¨&#x27;</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></div></td></tr></table></figure><ul><li>æµè§ˆå™¨é‡Œè¾“å…¥ emoji è¡¨æƒ…ç¬¦æ·»åŠ æµ‹è¯•ï¼Œä¸å‡ºæ„å¤–ï¼Œå·²ç» okã€‚ç»“æŸäº†ï¼ï¼ï¼</li></ul><h3 id="8-å‚è€ƒèµ„æ–™"><a href="#8-å‚è€ƒèµ„æ–™" class="headerlink" title="8. å‚è€ƒèµ„æ–™"></a>8. å‚è€ƒèµ„æ–™</h3><ol><li><p><a href="https://segmentfault.com/a/1190000039803577">ä½¿ç”¨ Portainer éƒ¨ç½² Docker å®¹å™¨å®è·µ</a></p></li><li><p><a href="https://xie.infoq.cn/article/a3c8ffbd34d818de010f2b0f6">MySql çš„ Dockerfile ç¼–å†™</a></p></li><li><p><a href="https://pinia.esm.dev/introduction.html#a-more-realistic-example">Pinia æ–‡æ¡£</a></p></li><li><p><a href="https://github.com/demopark/sequelize-docs-Zh-CN">sequelize ä¸­æ–‡æ–‡æ¡£</a></p></li><li><p><a href="https://dayjs.gitee.io/zh-CN/">dayjs</a></p></li><li><p><a href="https://juejin.cn/post/7045999468843368462">ã€å®æˆ˜ã€‘Node æœåŠ¡ä¸­å¦‚ä½•å†™æ—¥å¿—ï¼Ÿ</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>github actions</tag>
      
      <tag>CI</tag>
      
      <tag>CD</tag>
      
      <tag>Portainer</tag>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ Next.js + Docker æ‰“é€ ä¸€ä¸ªå±äºä½ çš„ç§äººåšå®¢</title>
    <link href="/2022/01/08/nextjs-blog/"/>
    <url>/2022/01/08/nextjs-blog/</url>
    
    <content type="html"><![CDATA[<h3 id="1-Next-js-ç®€ä»‹"><a href="#1-Next-js-ç®€ä»‹" class="headerlink" title="1. Next.js ç®€ä»‹"></a>1. Next.js ç®€ä»‹</h3><blockquote><p>[The React Framework for Production] Next.js gives you the best developer experience with all the features you need for production: hybrid static &amp; server rendering, TypeScript support, smart bundling, route pre-fetching, and more. No config needed.</p></blockquote><p>ä¸€é¡¿ç‰›çš®ä¸‹æ¥ï¼Œå°±æ˜¯ Next.js åœ¨ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¸‹éƒ½èƒ½å¸¦ç»™ä½ æœ€ä½³ä½“éªŒï¼Œå¼€ç®±ä½“éªŒï¼Œæ— éœ€ä»»ä½•é…ç½®</p><h3 id="2-ä¸ºä»€ä¹ˆé€‰æ‹©-Next-js"><a href="#2-ä¸ºä»€ä¹ˆé€‰æ‹©-Next-js" class="headerlink" title="2. ä¸ºä»€ä¹ˆé€‰æ‹© Next.js"></a>2. ä¸ºä»€ä¹ˆé€‰æ‹© Next.js</h3><blockquote><p>è€è¡¨ï¼Œå’‹å›äº‹å“¦ï¼Œvue ä¸èƒ½æ»¡è¶³äº†å—ï¼Œæè¿™ç©æ„å¹²å˜›ï¼Œ<a href="https://www.vuepress.cn/">vuepress</a> å†™æ‰€è°“çš„é™æ€åšå®¢ç½‘ç«™ä¸é¦™ï¼Ÿé¦™ï¼Œè¿˜æ¯”è¿™ç®€å•ï¼Œä½†è¯·å®¹è®¸æˆ‘ä»‹ç»å®Œè¿™ä¸ª Next.js</p></blockquote><p><img src="/assets/img/nextjs-blog/gs.jpg"></p><h4 id="2-1-é‚£-Next-js-æœ‰å“ªäº›ä¼˜ç‚¹å‘¢ï¼Ÿ"><a href="#2-1-é‚£-Next-js-æœ‰å“ªäº›ä¼˜ç‚¹å‘¢ï¼Ÿ" class="headerlink" title="2.1 é‚£ Next.js æœ‰å“ªäº›ä¼˜ç‚¹å‘¢ï¼Ÿ"></a>2.1 é‚£ Next.js æœ‰å“ªäº›ä¼˜ç‚¹å‘¢ï¼Ÿ</h4><ul><li>å›¾ç‰‡ä¼˜åŒ–</li><li>æ”¯æŒå›½é™…åŒ–</li><li>é›¶é…ç½®</li><li>æ”¯æŒ SSG + SSR</li><li>æ–‡ä»¶ç³»ç»Ÿè·¯ç”±</li><li>ä¼˜ç‚¹å¤ªå¤šâ€¦</li></ul><p><img src="/assets/img/nextjs-blog/yd.jpg"></p><h4 id="2-2-é‚£-Next-js-æ¯”è¿™-vue-å’Œ-react-é€ å‡ºæ¥çš„å•é¡µé¢æœ‰ä½•ä¸åŒï¼Ÿ"><a href="#2-2-é‚£-Next-js-æ¯”è¿™-vue-å’Œ-react-é€ å‡ºæ¥çš„å•é¡µé¢æœ‰ä½•ä¸åŒï¼Ÿ" class="headerlink" title="2.2 é‚£ Next.js æ¯”è¿™ vue å’Œ react é€ å‡ºæ¥çš„å•é¡µé¢æœ‰ä½•ä¸åŒï¼Ÿ"></a>2.2 é‚£ Next.js æ¯”è¿™ vue å’Œ react é€ å‡ºæ¥çš„å•é¡µé¢æœ‰ä½•ä¸åŒï¼Ÿ</h4><ol><li>vue å’Œ react é€ å‡ºæ¥çš„å•é¡µé¢åº”ç”¨ SEO ä¸å‹å¥½ï¼Œæœç´¢å¼•æ“æŠ“ä¸åˆ° html çš„å†…å®¹ï¼Œå†…å®¹éƒ½åœ¨ js é‡Œ</li><li>vue å’Œ react é€ å‡ºæ¥çš„å•é¡µé¢é¦–å±ç™½å±æ—¶é—´è¿‡é•¿ï¼Œåœ¨ä¸å¯¹é¡¹ç›® webpack ä¸“é—¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œé‚£ä¸ª bundle.js å¾ˆå¤§ï¼Œä¸¥é‡å½±å“ä½“éªŒ</li></ol><p><strong>æ€»ç»“</strong>ï¼šå¦‚æœé¡¹ç›®å¯¹ SEO è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå»ºè®®ä¸Š Next æˆ–<a href="https://www.nuxtjs.cn/">Nuxt</a></p><h4 id="2-3-Next-js-å’Œä¼ ç»Ÿçš„-phpã€jsp-æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#2-3-Next-js-å’Œä¼ ç»Ÿçš„-phpã€jsp-æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="2.3 Next.js å’Œä¼ ç»Ÿçš„ phpã€jsp æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a>2.3 Next.js å’Œä¼ ç»Ÿçš„ phpã€jsp æœ‰ä½•åŒºåˆ«ï¼Ÿ</h4><blockquote><p>ç®€å•äº†è§£</p></blockquote><ol><li>å®¢æˆ·ç«¯æ¸²æŸ“</li></ol><p>å‰åç«¯åˆ†ç¦»ï¼Œé€šè¿‡ ajax è¿›è¡Œæ•°æ®äº¤äº’ï¼Œvue å’Œ react å°±æ˜¯è¿™ç§æ¨¡å¼</p><ol start="2"><li>æœåŠ¡ç«¯æ¨¡æ¿æ¸²æŸ“</li></ol><p>php å’Œ jsp æ˜¯è§£ææ¨¡æ¿æ–‡ä»¶ï¼Œå°†æ•°æ®æ¸²æŸ“åˆ°æ–‡ä»¶ä¸Šï¼Œæœ€åå°†æ¨¡æ¿æ–‡ä»¶å˜ä¸º htmlï¼Œç”Ÿæˆ html è¿”å›ç»™æµè§ˆå™¨ï¼Œå‰åç«¯ä¸ç”¨åŒä¸€å¥—ä»£ç </p><ol start="3"><li>å‰åç«¯åŒæ„æ¸²æŸ“</li></ol><p>ä¹Ÿæ˜¯æœåŠ¡ç«¯ç”Ÿæˆ html è¿”å›ç»™æµè§ˆå™¨ï¼ŒåŒºåˆ«åœ¨äºå‰åç«¯ä¼šå…±ç”¨ä¸€éƒ¨åˆ†ç»„ä»¶ä»£ç é€»è¾‘ï¼Œè¿™éƒ¨åˆ†ä»£ç æ—¢å¯ä»¥ç”¨äºæœåŠ¡ç«¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºå®¢æˆ·ç«¯ï¼Œè€Œæ¨¡æ¿æ¸²æŸ“æ˜¯ä¸¤å¥—ä»£ç </p><h3 id="3-Next-js-ä¸»è¦-api-å¿«é€Ÿä¸Šæ‰‹"><a href="#3-Next-js-ä¸»è¦-api-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="3. Next.js ä¸»è¦ api å¿«é€Ÿä¸Šæ‰‹"></a>3. Next.js ä¸»è¦ api å¿«é€Ÿä¸Šæ‰‹</h3><blockquote><p><strong>æ³¨æ„</strong>ï¼šNode.js ç‰ˆæœ¬ 12.22.0 èµ·æ­¥</p></blockquote><h4 id="3-1-ä½¿ç”¨create-next-appè„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®"><a href="#3-1-ä½¿ç”¨create-next-appè„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®" class="headerlink" title="3.1 ä½¿ç”¨create-next-appè„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®"></a>3.1 ä½¿ç”¨<code>create-next-app</code>è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®</h4><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npx create-next-app@latest<br><span class="hljs-comment"># or</span><br>yarn create next-app<br></code></pre></div></td></tr></table></figure><h4 id="3-2-é¡¹ç›®ç›®å½•ç»“æ„"><a href="#3-2-é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="3.2 é¡¹ç›®ç›®å½•ç»“æ„"></a>3.2 é¡¹ç›®ç›®å½•ç»“æ„</h4><figure class="highlight mipsasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm">â”‚  .eslintrc.<span class="hljs-keyword">json</span><br><span class="hljs-keyword"></span>â”‚  .gitignore<br>â”‚  next.config.<span class="hljs-keyword">js </span>    <span class="hljs-comment"># nexté…ç½®æ–‡ä»¶</span><br>â”‚  package.<span class="hljs-keyword">json</span><br><span class="hljs-keyword"></span>â”‚  README.md<br>â”‚  yarn.lock<br>â”‚<br>â”œâ”€pages               <span class="hljs-comment"># é¡µé¢è·¯ç”±</span><br>â”‚  â”‚  index.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>â”‚  â”‚  _app.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>â”‚  â”‚<br>â”‚  â””â”€api              <span class="hljs-comment"># apiæœåŠ¡</span><br>â”‚          hello.<span class="hljs-keyword">js</span><br><span class="hljs-keyword"></span>â”‚<br>â”œâ”€public              <span class="hljs-comment"># é™æ€èµ„æº</span><br>â”‚      favicon.ico<br>â”‚      vercel.svg<br>â”‚<br>â””â”€styles              <span class="hljs-comment"># cssæ ·å¼</span><br>        globals.css   <span class="hljs-comment"># å…¨å±€æ ·å¼</span><br>        Home.module.css<br></code></pre></div></td></tr></table></figure><h4 id="3-3-è·¯ç”±"><a href="#3-3-è·¯ç”±" class="headerlink" title="3.3 è·¯ç”±"></a>3.3 è·¯ç”±</h4><ol><li>æ–‡ä»¶ç³»ç»Ÿè·¯ç”±</li></ol><ul><li><code>/pages/index.js</code> è·¯å¾„ä¸º <code>/</code></li><li><code>/pages/posts/about.js</code> è·¯å¾„ä¸º <code>/posts/about</code></li><li><code>/pages/posts/[id].js</code> åŠ¨æ€è·¯å¾„ä¸º <code>/posts/foo</code> æˆ–è€…<code>/posts/bar</code> ç­‰ç­‰</li></ul><ol start="2"><li>Link ç»„ä»¶</li></ol><blockquote><p>Link ç»„ä»¶ä¼šè‡ªåŠ¨æ‰§è¡Œ prefetch é¢„åŠ è½½</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/link&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/posts/about&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>about page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// æˆ–è€…ä¸ç”¨aæ ‡ç­¾ï¼Œä¼ å‚ç¤ºä¾‹</span><br>&lt;<span class="hljs-title class_">Link</span><br>  href=&#123;&#123;<br>    <span class="hljs-attr">pathname</span>: <span class="hljs-string">&quot;/about&quot;</span>,<br>    <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;test&quot;</span> &#125;,<br>  &#125;&#125;<br>  passHref<br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>about page<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Link</span>&gt;;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>useRouter</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useRouter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/router&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useCallback, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">List</span>() &#123;<br>  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();<br><br>  <span class="hljs-keyword">const</span> gotoDetail = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">fileName</span>: detailid &#125; = data;<br><br>    <span class="hljs-comment">// https://www.nextjs.cn/docs/api-reference/next/router#with-url-object</span><br>    router.<span class="hljs-title function_">push</span>(&#123;<br>      <span class="hljs-attr">pathname</span>: <span class="hljs-string">&quot;/posts/[detailid]&quot;</span>,<br>      <span class="hljs-attr">query</span>: &#123;<br>        detailid,<br>      &#125;,<br>    &#125;);<br>  &#125;, []);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// Prefetch the dashboard page</span><br>    router.<span class="hljs-title function_">prefetch</span>(<span class="hljs-string">&#x27;/dashboard&#x27;</span>);<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      ...</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>åŠ¨æ€è·¯ç”±</li></ol><p>å°±æ˜¯<code>/pages/posts/[id].js</code>è¿™æ ·çš„è·¯ç”±</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; getAllPostIds, getPostData &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/lib/posts&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticPaths</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> allListData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllPostIds</span>();<br>  <span class="hljs-keyword">const</span> paths = allListData.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">id</span>: item.<span class="hljs-property">fileName</span> &#125;,<br>    &#125;;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    paths,<br>    <span class="hljs-attr">fallback</span>: <span class="hljs-literal">false</span>,<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params">&#123; params &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> postData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPostData</span>(params.<span class="hljs-property">id</span>);<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123;<br>      postData,<br>    &#125;,<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; postData &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-4-Head-ç»„ä»¶"><a href="#3-4-Head-ç»„ä»¶" class="headerlink" title="3.4 Head ç»„ä»¶"></a>3.4 Head ç»„ä»¶</h4><blockquote><p>ç”¨äºè‡ªå®šä¹‰ head æ ‡ç­¾å†…å®¹</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Head</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/head&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charSet</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keywords&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Next.js&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Next.js&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Next.js<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-5-Image-ç»„ä»¶"><a href="#3-5-Image-ç»„ä»¶" class="headerlink" title="3.5 Image ç»„ä»¶"></a>3.5 Image ç»„ä»¶</h4><blockquote><p>ä½¿ç”¨é€‚å½“çš„å±æ€§ï¼Œå¯ä»¥å¤§å¹…ä¼˜åŒ–å›¾åƒï¼Œæå‡é¡µé¢æ¸²æŸ“</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/image&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyImg</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Image</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;styles.homeBgImg&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;bgImg&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">layout</span>=<span class="hljs-string">&quot;fill&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">objectFit</span>=<span class="hljs-string">&quot;cover&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">objectPosition</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">quality</span>=<span class="hljs-string">&#123;65&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">priority</span>=<span class="hljs-string">&#123;true&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;blur&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">blurDataURL</span>=<span class="hljs-string">&#123;DEFAULT_BASE64&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;img&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-6-Script-ç»„ä»¶"><a href="#3-6-Script-ç»„ä»¶" class="headerlink" title="3.6 Script ç»„ä»¶"></a>3.6 Script ç»„ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Script</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/script&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Script</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://Jquery.js&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onLoad</span>=<span class="hljs-string">&#123;()</span> =&gt;</span><span class="language-javascript"> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          $.<span class="hljs-title function_">ajax</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// ...</span></span></span><br><span class="language-javascript"><span class="language-xml">          &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;&#125;</span></span><br><span class="language-javascript"><span class="language-xml">      /&gt;</span></span><br><span class="language-javascript"><span class="language-xml">    &lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-7-CSS"><a href="#3-7-CSS" class="headerlink" title="3.7 CSS"></a>3.7 CSS</h4><ol><li>CSS Modulesï¼ˆå·²å†…ç½®ï¼‰</li><li>Sassï¼ˆå·²å†…ç½®ï¼‰</li><li>styled-jsxï¼ˆå·²å†…ç½®ï¼‰</li><li><a href="https://github.com/vercel/next.js/tree/canary/examples/with-styled-components">styled-components</a>ï¼ˆéœ€è‡ªè¡Œé…ç½®ï¼‰</li><li><a href="https://tailwindcss.com/docs/installation/using-postcss">Tailwind CSS</a>ï¼ˆéœ€è‡ªè¡Œé…ç½®ï¼‰</li></ol><h4 id="3-8-Next-js-çš„-3-ç§åŸºæœ¬æ¸²æŸ“æ–¹å¼"><a href="#3-8-Next-js-çš„-3-ç§åŸºæœ¬æ¸²æŸ“æ–¹å¼" class="headerlink" title="3.8 Next.js çš„ 3 ç§åŸºæœ¬æ¸²æŸ“æ–¹å¼"></a>3.8 Next.js çš„ 3 ç§åŸºæœ¬æ¸²æŸ“æ–¹å¼</h4><ol><li>Client-side Rendering</li></ol><blockquote><p>å°±æ˜¯å¸¸è§çš„å‰åç«¯åˆ†ç¦»</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> useSWR <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;swr&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetcher</span> = (<span class="hljs-params">url</span>) =&gt; <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-title function_">json</span>());<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data, error &#125; = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">&quot;/api/user&quot;</span>, fetcher);<br><br>  <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>failed to load<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>hello &#123;data.name&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>Static Generation (Recommended)</li></ol><blockquote><p>ä¸€èˆ¬ä»¥å±•ç¤ºä¸€äº›é™æ€å›ºå®šæ•°æ®ä¸ºä¸»ï¼Œæ‰“åŒ…çš„æ—¶å€™å°±ç›´æ¥ç”Ÿæˆï¼Œæ¯”å¦‚åšå®¢é¡µé¢ã€å›ºå®šè¥é”€é¡µé¢ã€å¸®åŠ©æ–‡æ¡£ç­‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; getAllPostIds &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/lib/posts&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> allListData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllPostIds</span>();<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123;<br>      allListData,<br>    &#125;,<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; allListData &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>Server-side Rendering<blockquote><p>ä»¥åŠ¨æ€æ•°æ®ä¸ºä¸»ï¼Œæ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå¯¹æœåŠ¡å™¨å‹åŠ›æ¯”è¾ƒå¤§</p></blockquote></li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123;<br>      <span class="hljs-attr">list</span>: [...]<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; list &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="4-éƒ¨ç½²"><a href="#4-éƒ¨ç½²" class="headerlink" title="4. éƒ¨ç½²"></a>4. éƒ¨ç½²</h3><h4 id="4-1-ä½¿ç”¨-Vercel-å¿«é€Ÿéƒ¨ç½²"><a href="#4-1-ä½¿ç”¨-Vercel-å¿«é€Ÿéƒ¨ç½²" class="headerlink" title="4.1 ä½¿ç”¨ Vercel å¿«é€Ÿéƒ¨ç½²"></a>4.1 ä½¿ç”¨ Vercel å¿«é€Ÿéƒ¨ç½²</h4><p>ä½¿ç”¨ github è´¦æˆ·æ³¨å†Œç™»å½•<a href="https://vercel.com/">Vercel</a>å®˜ç½‘ï¼Œæˆæƒè®¿é—®è¯¥ä»“åº“ï¼Œå³å¯å¿«é€Ÿéƒ¨ç½²ï¼Œéƒ¨ç½²å®Œå³å¯è®¿é—®ã€‚è¿˜èƒ½çœ‹åˆ°éƒ¨ç½²æ—¥å¿—ã€‚</p><h4 id="4-2-éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨"><a href="#4-2-éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨" class="headerlink" title="4.2 éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨"></a>4.2 éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨</h4><h5 id="4-2-1-åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ-docker-é•œåƒåˆ¶ä½œï¼Œç„¶åéƒ¨ç½²"><a href="#4-2-1-åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ-docker-é•œåƒåˆ¶ä½œï¼Œç„¶åéƒ¨ç½²" class="headerlink" title="4.2.1 åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ docker é•œåƒåˆ¶ä½œï¼Œç„¶åéƒ¨ç½²"></a>4.2.1 åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ docker é•œåƒåˆ¶ä½œï¼Œç„¶åéƒ¨ç½²</h5><blockquote><p>è¿™é‡ŒæœåŠ¡å™¨ä»¥ centos ä¸ºä¾‹</p></blockquote><h6 id="ç¬¬-1-æ­¥ï¼šDockerfile-æ–‡ä»¶"><a href="#ç¬¬-1-æ­¥ï¼šDockerfile-æ–‡ä»¶" class="headerlink" title="ç¬¬ 1 æ­¥ï¼šDockerfile æ–‡ä»¶"></a>ç¬¬ 1 æ­¥ï¼šDockerfile æ–‡ä»¶</h6><ol><li>ä½¿ç”¨ Next.js<a href="https://www.nextjs.cn/docs/deployment#docker-image">å®˜æ–¹ Dockerfile</a></li></ol><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½¿ç”¨å®˜æ–¹ Dockerfileï¼Œæ¯”å¦‚åœ¨é˜¿é‡Œäº‘ä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œä¸‹è½½æŸäº›åŒ…ä¼šå¾ˆæ…¢ï¼Œè·Ÿä½ æœ¬åœ°è®¿é—® github å®˜ç½‘ä¸€æ ·ï¼Œæ‰€ä»¥è¦è®¾ç½®å›½å†…é•œåƒä¸‹è½½ï¼Œé€Ÿåº¦å°±ä¼šå˜å¿«</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile"><span class="hljs-comment"># Install dependencies only when needed</span><br><span class="hljs-keyword">FROM</span> node:alpine AS deps<br><span class="hljs-comment"># Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apk add --no-cache libc6-compat</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> package.json yarn.lock ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn install --frozen-lockfile</span><br><br><span class="hljs-comment"># Rebuild the source code only when needed</span><br><span class="hljs-keyword">FROM</span> node:alpine AS builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=deps /app/node_modules ./node_modules</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yarn build &amp;&amp; yarn install --production --ignore-scripts --prefer-offline</span><br><br><span class="hljs-comment"># Production image, copy all the files and run next</span><br><span class="hljs-keyword">FROM</span> node:alpine AS runner<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-keyword">ENV</span> NODE_ENV production<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> addgroup -g 1001 -S nodejs</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> adduser -S nextjs -u 1001</span><br><br><span class="hljs-comment"># You only need to copy next.config.js if you are NOT using the default configuration</span><br><span class="hljs-comment"># COPY --from=builder /app/next.config.js ./</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /app/public ./public</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder --<span class="hljs-built_in">chown</span>=nextjs:nodejs /app/.next ./.next</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /app/node_modules ./node_modules</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /app/package.json ./package.json</span><br><br><span class="hljs-keyword">USER</span> nextjs<br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3000</span><br><br><span class="hljs-keyword">ENV</span> PORT <span class="hljs-number">3000</span><br><br><span class="hljs-comment"># Next.js collects completely anonymous telemetry data about general usage.</span><br><span class="hljs-comment"># Learn more here: https://nextjs.org/telemetry</span><br><span class="hljs-comment"># Uncomment the following line in case you want to disable telemetry.</span><br><span class="hljs-comment"># ENV NEXT_TELEMETRY_DISABLED 1</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node_modules/.bin/next&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>]</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨è‡ªå·±çš„ Dockerfile</li></ol><blockquote><p>è¿™é‡Œå¯ä»¥å¯¹ Docker è¿›è¡Œå¤šé˜¶æ®µæ„å»ºï¼Œä½¿æ‰“åŒ…å‡ºæ¥çš„é•œåƒä½“ç§¯å˜å°</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 1. æ„å»ºåŸºç¡€é•œåƒ</span><br>FROM alpine:3.15 AS base<br><span class="hljs-comment">#çº¯å‡€ç‰ˆé•œåƒ</span><br><br>ENV NODE_ENV=production \<br>  APP_PATH=/app<br><br>WORKDIR <span class="hljs-variable">$APP_PATH</span><br><br><span class="hljs-comment"># ä½¿ç”¨å›½å†…é•œåƒï¼ŒåŠ é€Ÿä¸‹é¢ apk addä¸‹è½½å®‰è£…alpineä¸ç¨³å®šæƒ…å†µ</span><br>RUN sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories<br><br><span class="hljs-comment"># ä½¿ç”¨apkå‘½ä»¤å®‰è£… nodejs å’Œ yarn</span><br>RUN apk add --no-cache --update nodejs=16.13.1-r0 yarn=1.22.17-r0<br><br><span class="hljs-comment"># 2. åŸºäºåŸºç¡€é•œåƒå®‰è£…é¡¹ç›®ä¾èµ–</span><br>FROM base AS install<br><br>COPY package.json yarn.lock ./<br><br>RUN yarn install<br><br><span class="hljs-comment"># 3. åŸºäºåŸºç¡€é•œåƒè¿›è¡Œæœ€ç»ˆæ„å»º</span><br>FROM base<br><br><span class="hljs-comment"># æ‹·è´ ä¸Šé¢ç”Ÿæˆçš„ node_modules æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æœ€ç»ˆçš„å·¥ä½œç›®å½•ä¸‹</span><br>COPY --from=install <span class="hljs-variable">$APP_PATH</span>/node_modules ./node_modules<br><br><span class="hljs-comment"># æ‹·è´å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(é™¤äº†.dockerignoreé‡Œæ’é™¤çš„)ï¼Œéƒ½æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹</span><br>COPY . .<br><br>RUN yarn build<br><br>EXPOSE 3000<br><br>CMD [<span class="hljs-string">&quot;yarn&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>]<br></code></pre></div></td></tr></table></figure><h6 id="ç¬¬-2-æ­¥ï¼š-å°†æºä»£ç æåˆ°æœåŠ¡å™¨ä¸Š"><a href="#ç¬¬-2-æ­¥ï¼š-å°†æºä»£ç æåˆ°æœåŠ¡å™¨ä¸Š" class="headerlink" title="ç¬¬ 2 æ­¥ï¼š å°†æºä»£ç æåˆ°æœåŠ¡å™¨ä¸Š"></a>ç¬¬ 2 æ­¥ï¼š å°†æºä»£ç æåˆ°æœåŠ¡å™¨ä¸Š</h6><ol><li>ä½¿ç”¨<code>scp</code>å‘½ä»¤æ‰‹åŠ¨å°†æœ¬åœ°æºä»£ç ä¸Šä¼ è‡³æœåŠ¡å™¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">scp -r local_dir root@121.xxx.xxx.xxx:remote_dir<br></code></pre></div></td></tr></table></figure><ol start="2"><li>æˆ–è€…åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š<code>wget</code>ä¸‹è½½ github æºç ï¼Œç„¶åè§£å‹</li></ol><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">wget https://github.com/xxx/main.zip -O main.zip &amp;&amp; unzip main.zip -d .<br></code></pre></div></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨<code>xshell</code>å·¥å…·ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</li></ol><p>ä¸Šé¢ 3 ç§æ–¹æ³•éƒ½å¯ä»¥æŠŠæœ¬åœ°æ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨å¯¹åº”ç›®å½•</p><h6 id="ç¬¬-3-æ­¥ï¼š-docker-é•œåƒåˆ¶ä½œ"><a href="#ç¬¬-3-æ­¥ï¼š-docker-é•œåƒåˆ¶ä½œ" class="headerlink" title="ç¬¬ 3 æ­¥ï¼š docker é•œåƒåˆ¶ä½œ"></a>ç¬¬ 3 æ­¥ï¼š docker é•œåƒåˆ¶ä½œ</h6><blockquote><p>å‰ææ˜¯å®‰è£…å¥½äº† docker å¹¶å¯åŠ¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ‡æ¢éƒ½æºç ç›®å½•æ‰§è¡Œ</span><br>docker image build -t blog-demo .<br></code></pre></div></td></tr></table></figure><p>æ¥ç€ä¼šçœ‹åˆ°å‘½ä»¤è¡Œä¸Šæ­£åœ¨æ‰§è¡Œé•œåƒåˆ¶ä½œè¿‡ç¨‹ï¼Œé¡ºåˆ©çš„è¯ï¼Œå°±æˆåŠŸäº†</p><p><img src="/assets/img/nextjs-blog/build.jpg" alt="build"></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># ä¸å‡ºæ„å¤–ï¼Œå¯ä»¥çœ‹åˆ°åˆšæ‰åˆ¶ä½œçš„é•œåƒ</span><br>docker image <span class="hljs-built_in">ls</span><br></code></pre></div></td></tr></table></figure><h6 id="ç¬¬-4-æ­¥ï¼š-å¯åŠ¨å®¹å™¨"><a href="#ç¬¬-4-æ­¥ï¼š-å¯åŠ¨å®¹å™¨" class="headerlink" title="ç¬¬ 4 æ­¥ï¼š å¯åŠ¨å®¹å™¨"></a>ç¬¬ 4 æ­¥ï¼š å¯åŠ¨å®¹å™¨</h6><blockquote><p>å‰æè¦åœ¨æœåŠ¡å™¨ä¸Šå¼€å¥½å®‰å…¨ç»„</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> container run -d -p <span class="hljs-number">80</span>:<span class="hljs-number">3000</span> -it blog-demo<br><span class="hljs-comment"># -dï¼š åå°è¿è¡Œå®¹å™¨</span><br><span class="hljs-comment"># -p: å‰é¢80æ˜¯æœ¬æœºæœåŠ¡å™¨å¼€æ”¾ç«¯å£ï¼Œåé¢3000æ˜¯å®¹å™¨æš´éœ²å‡ºæ¥çš„ç«¯å£</span><br><span class="hljs-comment"># --nameï¼šç»™å®¹å™¨å‘½å</span><br></code></pre></div></td></tr></table></figure><p>ä¸å‡ºæ„å¤–ï¼Œå®¹å™¨æˆåŠŸè¿è¡Œã€‚å¯ä»¥åœ¨æµè§ˆå™¨é‡Œè¿›è¡Œè®¿é—®äº†ã€‚</p><h5 id="4-2-2-ä½¿ç”¨github-actionsè‡ªåŠ¨éƒ¨ç½²"><a href="#4-2-2-ä½¿ç”¨github-actionsè‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="4.2.2 ä½¿ç”¨github actionsè‡ªåŠ¨éƒ¨ç½²"></a>4.2.2 ä½¿ç”¨<code>github actions</code>è‡ªåŠ¨éƒ¨ç½²</h5><blockquote><p>ä¸Šé¢æ‰‹åŠ¨æ­¥éª¤å¤ªéº»çƒ¦äº†ï¼Œéœ€è¦è§£æ”¾åŒæ‰‹</p></blockquote><p>è¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹© dockerhubï¼Œæ³¨å†Œå¥½åï¼Œåˆ›å»ºä»“åº“ï¼Œå³å¯æ¨é€ã€‚é˜¿é‡Œäº‘çš„é•œåƒå®¹å™¨æœåŠ¡ï¼Œä¹Ÿéœ€è¦æå‰å¼€é€šå‡†å¤‡å¥½ï¼ˆå‘½åç©ºé—´+ç§äººä»“åº“ï¼‰ã€‚</p><h6 id="ç¬¬-1-æ­¥ï¼šæå‰å‡†å¤‡å¥½"><a href="#ç¬¬-1-æ­¥ï¼šæå‰å‡†å¤‡å¥½" class="headerlink" title="ç¬¬ 1 æ­¥ï¼šæå‰å‡†å¤‡å¥½"></a>ç¬¬ 1 æ­¥ï¼šæå‰å‡†å¤‡å¥½</h6><ul><li>å®¹å™¨ç™»å½•è´¦å·+å¯†ç </li><li>æœåŠ¡å™¨çš„ HOST + ç™»å½•è´¦æˆ· + å¯†ç </li><li>é˜¿é‡Œäº‘æˆ–è€… dockerhub çš„é•œåƒå®¹å™¨ä»“åº“</li></ul><h6 id="ç¬¬-2-æ­¥ï¼šgithub-è¯¥ä»“åº“-Settings-gt-Secrets-æ·»åŠ ç§˜é’¥ï¼Œå³ä¸Šé¢å‡†å¤‡å¥½çš„è¿™-5-ä¸ª"><a href="#ç¬¬-2-æ­¥ï¼šgithub-è¯¥ä»“åº“-Settings-gt-Secrets-æ·»åŠ ç§˜é’¥ï¼Œå³ä¸Šé¢å‡†å¤‡å¥½çš„è¿™-5-ä¸ª" class="headerlink" title="ç¬¬ 2 æ­¥ï¼šgithub è¯¥ä»“åº“ Settings-&gt;Secrets æ·»åŠ ç§˜é’¥ï¼Œå³ä¸Šé¢å‡†å¤‡å¥½çš„è¿™ 5 ä¸ª"></a>ç¬¬ 2 æ­¥ï¼šgithub è¯¥ä»“åº“ Settings-&gt;Secrets æ·»åŠ ç§˜é’¥ï¼Œå³ä¸Šé¢å‡†å¤‡å¥½çš„è¿™ 5 ä¸ª</h6><blockquote><p>æˆ‘è¿™é‡Œä¹°çš„æ˜¯é˜¿é‡Œäº‘çš„å±Œä¸ 1 æ ¸ 2G æœºå™¨ï¼Œç”Ÿäº§ç¯å¢ƒåˆ«è¿™ä¹ˆç©ï¼Œè´¦å·å¯†ç å¯èƒ½æ³„éœ²</p></blockquote><p><img src="/assets/img/nextjs-blog/secrets.jpg" alt="secrets"></p><h6 id="ç¬¬-3-æ­¥ï¼šé¡¹ç›®æ ¹ç›®å½•æ·»åŠ github-ymlé…ç½®æ–‡ä»¶"><a href="#ç¬¬-3-æ­¥ï¼šé¡¹ç›®æ ¹ç›®å½•æ·»åŠ github-ymlé…ç½®æ–‡ä»¶" class="headerlink" title="ç¬¬ 3 æ­¥ï¼šé¡¹ç›®æ ¹ç›®å½•æ·»åŠ github ymlé…ç½®æ–‡ä»¶"></a>ç¬¬ 3 æ­¥ï¼šé¡¹ç›®æ ¹ç›®å½•æ·»åŠ <code>github yml</code>é…ç½®æ–‡ä»¶</h6><blockquote><p>.github&#x2F;workflows&#x2F;deploy.yml</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">name: Docker Image CI<br><br>on:<br>  push: <span class="hljs-comment"># push æ—¶è§¦å‘ci</span><br>    branches: [main] <span class="hljs-comment"># ä½œç”¨äºmainåˆ†æ”¯</span><br>  <span class="hljs-comment"># pull_request:</span><br>  <span class="hljs-comment">#   branches: [main]</span><br><br><span class="hljs-built_in">jobs</span>:<br>  build:<br>    runs-on: ubuntu-latest<br><br>    steps:<br>      <span class="hljs-comment"># æ‹‰å–mainåˆ†æ”¯ä»£ç </span><br>      - name: Checkout<br>        uses: actions/checkout@v2<br><br>      <span class="hljs-comment"># åˆ¶ä½œdockeré•œåƒå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡</span><br>      - name: build and push docker image<br>        run: |<br>          <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;&#123; secrets.ALIYUN_DOCKER_PASSWORD &#125;</span>&#125; | docker login registry.cn-hangzhou.aliyuncs.com --username <span class="hljs-variable">$&#123;&#123; secrets.ALIYUN_DOCKER_USERNAME &#125;</span>&#125; --password-stdin<br><br>          docker image build -t myblog:latest .<br>          docker tag myblog registry.cn-hangzhou.aliyuncs.com/test-blog/myblog:latest<br>          docker push registry.cn-hangzhou.aliyuncs.com/test-blog/myblog:latest<br>          docker <span class="hljs-built_in">logout</span><br>      <span class="hljs-comment"># ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‹‰å–é•œåƒï¼Œåˆ¶ä½œå¹¶é‡å¯å®¹å™¨</span><br>      <span class="hljs-comment"># https://github.com/marketplace/actions/remote-ssh-commands</span><br>      - name: ssh remote deploy<br>        uses: fifsky/ssh-action@master<br>        with:<br>          <span class="hljs-built_in">command</span>: |<br>            <span class="hljs-built_in">cd</span> /<br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;1.docker login start==&gt;&quot;</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;&#123; secrets.ALIYUN_DOCKER_PASSWORD &#125;</span>&#125; | docker login registry.cn-hangzhou.aliyuncs.com --username <span class="hljs-variable">$&#123;&#123; secrets.ALIYUN_DOCKER_USERNAME &#125;</span>&#125; --password-stdin<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;2.docker stop myblog container==&gt;&quot;</span><br>            docker container stop myblog<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;3.docker conatainer rm==&gt;&quot;</span><br>            docker container <span class="hljs-built_in">rm</span> myblog<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;4.docker image rm==&gt;&quot;</span><br>            docker image <span class="hljs-built_in">rm</span> registry.cn-hangzhou.aliyuncs.com/test-blog/myblog:latest<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;5.docker pull==&gt;&quot;</span><br>            docker pull registry.cn-hangzhou.aliyuncs.com/test-blog/myblog:latest<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;6.docker container create and start==&gt;&quot;</span><br>            docker container run -d -p 80:3000 --name myblog registry.cn-hangzhou.aliyuncs.com/test-blog/myblog:latest<br><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;7.docker logout==&gt;&quot;</span><br>            docker <span class="hljs-built_in">logout</span><br>          host: <span class="hljs-variable">$&#123;&#123; secrets.HOST &#125;</span>&#125;<br>          user: <span class="hljs-variable">$&#123;&#123; secrets.USER &#125;</span>&#125;<br>          pass: <span class="hljs-variable">$&#123;&#123; secrets.PASSWORD &#125;</span>&#125;<br><br></code></pre></div></td></tr></table></figure><h6 id="ç¬¬-4-æ­¥ï¼šæäº¤ä»£ç ï¼Œè‡ªåŠ¨éƒ¨ç½²"><a href="#ç¬¬-4-æ­¥ï¼šæäº¤ä»£ç ï¼Œè‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="ç¬¬ 4 æ­¥ï¼šæäº¤ä»£ç ï¼Œè‡ªåŠ¨éƒ¨ç½²"></a>ç¬¬ 4 æ­¥ï¼šæäº¤ä»£ç ï¼Œè‡ªåŠ¨éƒ¨ç½²</h6><blockquote><p>ä¸å‡ºæ„å¤–ï¼Œåœ¨ä»“åº“çš„ Actions é‡Œçœ‹åˆ°ä¸€åˆ‡ ok</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">git</span> <span class="hljs-keyword">add</span> .<br><span class="hljs-symbol">git</span> commit -m <span class="hljs-string">&quot;chore: add github actions yml&quot;</span><br><span class="hljs-symbol">git</span> <span class="hljs-keyword">push</span> -u origin main<br></code></pre></div></td></tr></table></figure><p><img src="/assets/img/nextjs-blog/deploy.jpg" alt="deploy"></p><p><a href="https://nextjs-blog-nine-delta-65.vercel.app/">å½“å‰åšå®¢ç‚¹å‡»é¢„è§ˆ</a></p><p><img src="/assets/img/nextjs-blog/666.png" alt="666"></p><h3 id="5-å‚è€ƒèµ„æ–™"><a href="#5-å‚è€ƒèµ„æ–™" class="headerlink" title="5. å‚è€ƒèµ„æ–™"></a>5. å‚è€ƒèµ„æ–™</h3><ol><li><p><a href="https://nextjs.org/docs/getting-started">Next.js å®˜æ–¹æ–‡æ¡£</a></p></li><li><p><a href="https://juejin.cn/post/6991689670027542564">å¦‚ä½•ä¼˜åŒ– node é¡¹ç›®çš„ docker é•œåƒ</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">Docker å…¥é—¨æ•™ç¨‹</a></p></li><li><p><a href="https://www.zhihu.com/question/379598562">å‰åç«¯åŒæ„å’Œæ¨¡æ¿æ¸²æŸ“çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</a></p></li><li><p><a href="https://juejin.cn/post/6950799922178310152">æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨ Github Actions éƒ¨ç½²å‰ç«¯é¡¹ç›®</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>nextjs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>next.js</tag>
      
      <tag>github actions</tag>
      
      <tag>CI</tag>
      
      <tag>CD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®å‰ç«¯qiankunä¸Šæ‰‹ä½“éªŒ</title>
    <link href="/2021/02/25/qiankun/"/>
    <url>/2021/02/25/qiankun/</url>
    
    <content type="html"><![CDATA[<blockquote><ol><li><a href="https://qiankun.umijs.org/zh">qiankun å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://zh-hans.single-spa.js.org/docs/getting-started-overview/">single-spa</a></li><li><a href="https://juejin.cn/post/6844904162509979662#heading-0">å¾®å‰ç«¯-æœ€å®¹æ˜“çœ‹æ‡‚çš„å¾®å‰ç«¯çŸ¥è¯†</a></li></ol></blockquote><p>å¾®å‰ç«¯çš„ç±»å‹ï¼š</p><ol><li>å—è·¯ç”±æ§åˆ¶æ¸²æŸ“çš„å­åº”ç”¨</li><li>ä¸å—è·¯ç”±æ§åˆ¶çš„ç»„ä»¶</li><li>éæ¸²æŸ“ç»„ä»¶ï¼Œåº”ç”¨é—´é€šä¿¡é€»è¾‘</li></ol><h3 id="1-å­åº”ç”¨-vue"><a href="#1-å­åº”ç”¨-vue" class="headerlink" title="1.å­åº”ç”¨-vue"></a>1.å­åº”ç”¨-vue</h3><h4 id="1-vue-cli-åˆ›å»ºå­åº”ç”¨"><a href="#1-vue-cli-åˆ›å»ºå­åº”ç”¨" class="headerlink" title="1. vue-cli åˆ›å»ºå­åº”ç”¨"></a>1. vue-cli åˆ›å»ºå­åº”ç”¨</h4><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vue create qiankun_vue<br></code></pre></div></td></tr></table></figure><h4 id="2-ä¿®æ”¹å…¥å£main-jsæ–‡ä»¶"><a href="#2-ä¿®æ”¹å…¥å£main-jsæ–‡ä»¶" class="headerlink" title="2. ä¿®æ”¹å…¥å£main.jsæ–‡ä»¶"></a>2. ä¿®æ”¹å…¥å£<code>main.js</code>æ–‡ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// https://qiankun.umijs.org/zh/guide/tutorial#vue-å¾®åº”ç”¨</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./router&quot;</span>;<br><br><span class="hljs-comment">// Vue.config.productionTip = false</span><br><br><span class="hljs-keyword">let</span> vueInstance = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props = &#123;&#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; container &#125; = props;<br><br>  vueInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>    router,<br>    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>    <span class="hljs-comment">// è¿™é‡Œæ˜¯æŒ‚è½½åˆ°è‡ªå·±çš„htmlä¸Šï¼ŒåŸºåº§ä¼šæ‹¿åˆ°è¿™ä¸ªæŒ‚è½½åçš„htmlï¼Œå°†å…¶æ’å…¥åˆ°ç›¸åº”çš„å®¹å™¨é‡Œ</span><br><br>    <span class="hljs-comment">// Application died in status NOT_MOUNTED: Target container with #container not existed after xxx mounted!</span><br>    <span class="hljs-comment">// å¾®åº”ç”¨çš„æ ¹ id ä¸å…¶ä»– DOM å†²çªã€‚è§£å†³åŠæ³•æ˜¯ï¼šä¿®æ”¹æ ¹ id çš„æŸ¥æ‰¾èŒƒå›´ã€‚</span><br>  &#125;).$mount(container ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#app&quot;</span>) : <span class="hljs-string">&quot;#app&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨ webpack è¿è¡Œæ—¶ publicPath é…ç½®</span><br><span class="hljs-comment">// åŠ¨æ€è®¾ç½®publicPath</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) &#123;<br>  __webpack_public_path__ = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span>;<br>&#125;<br><br><span class="hljs-comment">// https://qiankun.umijs.org/zh/faq#å¦‚ä½•ç‹¬ç«‹è¿è¡Œå¾®åº”ç”¨ï¼Ÿ</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) &#123;<br>  <span class="hljs-title function_">render</span>();<br>&#125;<br><br><span class="hljs-comment">// æš´éœ²3ä¸ªå¼‚æ­¥æ–¹æ³• bootstrap mount unmount</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params">props</span>) &#123;&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;props=====&gt;&quot;</span>, props);<br>  <span class="hljs-title function_">render</span>(props);<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params">props</span>) &#123;<br>  vueInstance &amp;&amp; vueInstance.$destroy();<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-ä¿®æ”¹è·¯ç”±router-index-jsæ–‡ä»¶"><a href="#3-ä¿®æ”¹è·¯ç”±router-index-jsæ–‡ä»¶" class="headerlink" title="3. ä¿®æ”¹è·¯ç”±router/index.jsæ–‡ä»¶"></a>3. ä¿®æ”¹è·¯ç”±<code>router/index.js</code>æ–‡ä»¶</h4><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff">  const router = new VueRouter(&#123;<br>    mode: &#x27;history&#x27;,<br><span class="hljs-deletion">-    base: process.env.BASE_URL,</span><br><span class="hljs-addition">+    base: window.__POWERED_BY_QIANKUN__ ? &#x27;/vue&#x27; : process.env.BASE_URL,</span><br>    routes<br>  &#125;)<br><br></code></pre></div></td></tr></table></figure><h4 id="4-æ ¹ç›®å½•æ–°å»ºvue-config-jsï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®"><a href="#4-æ ¹ç›®å½•æ–°å»ºvue-config-jsï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®" class="headerlink" title="4. æ ¹ç›®å½•æ–°å»ºvue.config.jsï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®"></a>4. æ ¹ç›®å½•æ–°å»º<code>vue.config.js</code>ï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8000</span>,<br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-comment">// https://webpack.docschina.org/configuration/output/#outputlibrary</span><br>  <span class="hljs-attr">configureWebpack</span>: &#123;<br>    <span class="hljs-attr">output</span>: &#123;<br>      <span class="hljs-attr">library</span>: <span class="hljs-string">&quot;vueApp&quot;</span>, <span class="hljs-comment">// æ‰“åŒ…æˆä¸€ä¸ªç±»åº“</span><br>      <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&quot;umd&quot;</span>, <span class="hljs-comment">// umdæœ€ç»ˆä¼šæŠŠbootstrap/mount/unmountæŒ‚è½½åˆ°windowä¸Š</span><br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></div></td></tr></table></figure><h3 id="2-å­åº”ç”¨-react"><a href="#2-å­åº”ç”¨-react" class="headerlink" title="2.å­åº”ç”¨-react"></a>2.å­åº”ç”¨-react</h3><h4 id="1-create-react-app-åˆ›å»ºå­åº”ç”¨"><a href="#1-create-react-app-åˆ›å»ºå­åº”ç”¨" class="headerlink" title="1. create-react-app åˆ›å»ºå­åº”ç”¨"></a>1. create-react-app åˆ›å»ºå­åº”ç”¨</h4><figure class="highlight dsconfig"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dsconfig"><span class="hljs-built_in">create-react-app</span> <span class="hljs-string">qiankun_react</span><br></code></pre></div></td></tr></table></figure><h4 id="2-ä¿®æ”¹å…¥å£index-jsæ–‡ä»¶"><a href="#2-ä¿®æ”¹å…¥å£index-jsæ–‡ä»¶" class="headerlink" title="2. ä¿®æ”¹å…¥å£index.jsæ–‡ä»¶"></a>2. ä¿®æ”¹å…¥å£<code>index.js</code>æ–‡ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Link</span>, <span class="hljs-title class_">Route</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./index.css&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App&quot;</span>;<br><span class="hljs-comment">// import reportWebVitals from &#x27;./reportWebVitals&#x27;;</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; container &#125; = props;<br>  <span class="hljs-comment">// https://reactrouter.com/web/api/BrowserRouter</span><br>  <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span> <span class="hljs-attr">basename</span>=<span class="hljs-string">&quot;/react&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>react-home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span> |<span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>react-about<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><span class="language-xml">        &#123;/* exact ä¸¥æ ¼æ¨¡å¼ */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">render</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>&#125;&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">exact</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">render</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>react about page<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>&#125;</span><br><span class="language-xml">        &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,<br>    container<br>      ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#root&quot;</span>)<br>      : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#root&quot;</span>)<br>  );<br>&#125;<br><br><span class="hljs-comment">// ç‹¬ç«‹è¿è¡Œ</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) &#123;<br>  <span class="hljs-title function_">render</span>();<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params">props</span>) &#123;&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-title function_">render</span>(props);<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; container &#125; = props;<br>  <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">unmountComponentAtNode</span>(<br>    container<br>      ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#root&quot;</span>)<br>      : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#root&quot;</span>)<br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3-ä¿®æ”¹æ‰“åŒ…é…ç½®æ–‡ä»¶"><a href="#3-ä¿®æ”¹æ‰“åŒ…é…ç½®æ–‡ä»¶" class="headerlink" title="3. ä¿®æ”¹æ‰“åŒ…é…ç½®æ–‡ä»¶"></a>3. ä¿®æ”¹æ‰“åŒ…é…ç½®æ–‡ä»¶</h4><h5 id="1-å®‰è£…react-app-rewired"><a href="#1-å®‰è£…react-app-rewired" class="headerlink" title="1. å®‰è£…react-app-rewired"></a>1. å®‰è£…<code>react-app-rewired</code></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">yarn add react-app-rewired -D<br></code></pre></div></td></tr></table></figure><h5 id="2-å­åº”ç”¨æ ¹ç›®å½•æ–°å»ºconfig-overrides-jsæ–‡ä»¶"><a href="#2-å­åº”ç”¨æ ¹ç›®å½•æ–°å»ºconfig-overrides-jsæ–‡ä»¶" class="headerlink" title="2. å­åº”ç”¨æ ¹ç›®å½•æ–°å»ºconfig-overrides.jsæ–‡ä»¶"></a>2. å­åº”ç”¨æ ¹ç›®å½•æ–°å»º<code>config-overrides.js</code>æ–‡ä»¶</h5><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// https://github.com/timarney/react-app-rewired/blob/HEAD/README_zh.md#æ‰©å±•é…ç½®é€‰é¡¹</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">webpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>    config.<span class="hljs-property">output</span>.<span class="hljs-property">library</span> = <span class="hljs-string">&quot;reactApp&quot;</span>;<br>    config.<span class="hljs-property">output</span>.<span class="hljs-property">libraryTarget</span> = <span class="hljs-string">&quot;umd&quot;</span>;<br>    config.<span class="hljs-property">output</span>.<span class="hljs-property">publicPath</span> = <span class="hljs-string">&quot;http://localhost:9000/&quot;</span>;<br>    <span class="hljs-keyword">return</span> config;<br>  &#125;,<br>  <span class="hljs-attr">devServer</span>: <span class="hljs-function">(<span class="hljs-params">configFunc</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">proxy, allowedHost</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">configFunc</span>(proxy, allowedHost);<br>      <span class="hljs-comment">// è®¾ç½®å¼€å‘æœåŠ¡å…è®¸è·¨åŸŸ</span><br>      config.<span class="hljs-property">headers</span> = &#123;<br>        <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>      &#125;;<br><br>      <span class="hljs-keyword">return</span> config;<br>    &#125;;<br>  &#125;,<br>&#125;;<br></code></pre></div></td></tr></table></figure><h5 id="3-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#3-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3. è®¾ç½®ç¯å¢ƒå˜é‡"></a>3. è®¾ç½®ç¯å¢ƒå˜é‡</h5><ol><li>å­åº”ç”¨æ ¹ç›®å½•æ–°å»º<code>.env</code>æ–‡ä»¶</li></ol><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">PORT</span>=<span class="hljs-number">4000</span><br><span class="hljs-attr">WDS_SOCKET_PORT</span>=<span class="hljs-number">4000</span><br></code></pre></div></td></tr></table></figure><p>æˆ–è€…åœ¨<code>package.json</code>å¯åŠ¨è„šæœ¬ä¸­ä¿®æ”¹ç«¯å£</p><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff"> &quot;scripts&quot;: &#123;<br><span class="hljs-deletion">-     &quot;start&quot;: &quot;react-app-rewired start&quot;,</span><br><span class="hljs-addition">+     &quot;start&quot;: &quot;set PORT=4000 &amp;&amp; react-app-rewired start&quot;,</span><br>   &#125;,<br></code></pre></div></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹<code>package.json</code>æ–‡ä»¶</li></ol><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff"> &quot;scripts&quot;: &#123;<br><span class="hljs-deletion">-     &quot;start&quot;: &quot;react-scripts start&quot;,</span><br><span class="hljs-deletion">-     &quot;build&quot;: &quot;react-scripts build&quot;,</span><br><span class="hljs-deletion">-     &quot;test&quot;: &quot;react-scripts test&quot;,</span><br><span class="hljs-deletion">-     &quot;eject&quot;: &quot;react-scripts eject&quot;</span><br><span class="hljs-addition">+     &quot;start&quot;: &quot;react-app-rewired start&quot;,</span><br><span class="hljs-addition">+     &quot;build&quot;: &quot;react-app-rewired build&quot;,</span><br><span class="hljs-addition">+     &quot;test&quot;: &quot;react-app-rewired test&quot;,</span><br><span class="hljs-addition">+     &quot;eject&quot;: &quot;react-app-rewired eject&quot;</span><br>   &#125;,<br></code></pre></div></td></tr></table></figure><h3 id="3-å­åº”ç”¨-é-webpack-æ„å»º-jquery-bootstrap"><a href="#3-å­åº”ç”¨-é-webpack-æ„å»º-jquery-bootstrap" class="headerlink" title="3.å­åº”ç”¨(é webpack æ„å»º)-jquery+bootstrap"></a>3.å­åº”ç”¨(é webpack æ„å»º)-jquery+bootstrap</h3><h4 id="1-æ–°å»ºindex-htmlæ–‡ä»¶"><a href="#1-æ–°å»ºindex-htmlæ–‡ä»¶" class="headerlink" title="1. æ–°å»ºindex.htmlæ–‡ä»¶"></a>1. æ–°å»º<code>index.html</code>æ–‡ä»¶</h4><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Bootstrap 101 Template<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//localhost:5000/lib/bootstrap.min.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ä½ å¥½ï¼Œä¸–ç•Œï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-group&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-group-addon&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;basic-addon1&quot;</span>&gt;</span>@<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Username&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">&quot;basic-addon1&quot;</span></span><br><span class="hljs-tag">          /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//localhost:5000/lib/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//localhost:5000/lib/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  entry jsä¸ºå…¥å£æ–‡ä»¶ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//localhost:5000/entry.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="2-æ–°å»ºentry-jså…¥å£æ–‡ä»¶"><a href="#2-æ–°å»ºentry-jså…¥å£æ–‡ä»¶" class="headerlink" title="2. æ–°å»ºentry.jså…¥å£æ–‡ä»¶"></a>2. æ–°å»º<code>entry.js</code>å…¥å£æ–‡ä»¶</h4><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params">$</span>) =&gt; &#123;<br>  $(<span class="hljs-string">&quot;#purehtml-container&quot;</span>).<span class="hljs-title function_">html</span>(<span class="hljs-string">&quot;Hello, render with jQuery&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();<br>&#125;;<br>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">global</span></span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">global</span>[<span class="hljs-string">&quot;purehtml&quot;</span>] = &#123;<br>    <span class="hljs-attr">bootstrap</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;purehtml bootstrap&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();<br>    &#125;,<br>    <span class="hljs-attr">mount</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;purehtml mount&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">render</span>($);<br>    &#125;,<br>    <span class="hljs-attr">unmount</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;purehtml unmount&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();<br>    &#125;,<br>  &#125;;<br>&#125;)(<span class="hljs-variable language_">window</span>);<br></code></pre></div></td></tr></table></figure><h3 id="4-åŸºåº§åº”ç”¨-vue"><a href="#4-åŸºåº§åº”ç”¨-vue" class="headerlink" title="4.åŸºåº§åº”ç”¨-vue"></a>4.åŸºåº§åº”ç”¨-vue</h3><h4 id="1-ä¿®æ”¹å…¥å£main-jsæ–‡ä»¶"><a href="#1-ä¿®æ”¹å…¥å£main-jsæ–‡ä»¶" class="headerlink" title="1.ä¿®æ”¹å…¥å£main.jsæ–‡ä»¶"></a>1.ä¿®æ”¹å…¥å£<code>main.js</code>æ–‡ä»¶</h4><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff">import Vue from &#x27;vue&#x27;<br>import App from &#x27;./App.vue&#x27;<br>import router from &#x27;./router&#x27;<br><span class="hljs-addition">+ import &#123; registerMicroApps, start &#125; from &#x27;qiankun&#x27;;</span><br><span class="hljs-addition">+ import ElementUI from &#x27;element-ui&#x27;;</span><br><span class="hljs-addition">+ import &#x27;element-ui/lib/theme-chalk/index.css&#x27;;</span><br><br>Vue.config.productionTip = false<br><br><span class="hljs-addition">+ Vue.use(ElementUI);</span><br><br><span class="hljs-addition">+ const apps = [</span><br><span class="hljs-addition">+   &#123;</span><br><span class="hljs-addition">+     name: &quot;vueApp&quot;,</span><br><span class="hljs-addition">+     // é»˜è®¤é€šè¿‡fetchåŠ è½½è¿™ä¸ªhtmlï¼Œè§£æé‡Œé¢çš„jsï¼ŒåŠ¨æ€çš„æ‰§è¡Œ</span><br><span class="hljs-addition">+     // æ³¨æ„ï¼šå­åº”ç”¨å¿…é¡»æ”¯æŒè·¨åŸŸ</span><br><span class="hljs-addition">+     entry: &quot;http://localhost:8000&quot;,</span><br><span class="hljs-addition">+     container: &quot;#vueDOM&quot;, // å®¹å™¨å</span><br><span class="hljs-addition">+     activeRule: &quot;/vue&quot;, // æ¿€æ´»è·¯å¾„</span><br><span class="hljs-addition">+     props: &#123; a: 1, b: 2 &#125;, // ä¼ ç»™å­åº”ç”¨çš„å‚æ•°</span><br><span class="hljs-addition">+   &#125;,</span><br><span class="hljs-addition">+   &#123;</span><br><span class="hljs-addition">+     name: &quot;reactApp&quot;,</span><br><span class="hljs-addition">+     entry: &quot;//localhost:9000&quot;,</span><br><span class="hljs-addition">+     container: &quot;#react&quot;,</span><br><span class="hljs-addition">+     activeRule: &quot;/react&quot;,</span><br><span class="hljs-addition">+   &#125;,</span><br><span class="hljs-addition">+   &#123;</span><br><span class="hljs-addition">+     name: &quot;jqueryApp&quot;,</span><br><span class="hljs-addition">+     entry: &quot;//localhost:5000&quot;,</span><br><span class="hljs-addition">+     container: &quot;#jquery&quot;,</span><br><span class="hljs-addition">+     activeRule: &quot;/jquery&quot;,</span><br><span class="hljs-addition">+     props: &#123; a: 100, b: 200 &#125;,</span><br><span class="hljs-addition">+   &#125;,</span><br><span class="hljs-addition">+ ];</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+ registerMicroApps(apps); // æ³¨å†Œåº”ç”¨</span><br><span class="hljs-addition">+ // å¯åŠ¨åº”ç”¨</span><br><span class="hljs-addition">+ start(&#123;</span><br><span class="hljs-addition">+   // https://qiankun.umijs.org/zh/api#startopts</span><br><span class="hljs-addition">+   prefetch: false, // å–æ¶ˆé¢„åŠ è½½</span><br><span class="hljs-addition">+ &#125;);</span><br><br>new Vue(&#123;<br>  router,<br>  render: h =&gt; h(App)<br>&#125;).$mount(&#x27;#app&#x27;)<br></code></pre></div></td></tr></table></figure><h4 id="2-ä¿®æ”¹App-vueç»„ä»¶"><a href="#2-ä¿®æ”¹App-vueç»„ä»¶" class="headerlink" title="2. ä¿®æ”¹App.vueç»„ä»¶"></a>2. ä¿®æ”¹<code>App.vue</code>ç»„ä»¶</h4><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span> <span class="hljs-attr">:router</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;horizontal&quot;</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- åŸºåº§è‡ªå·±çš„è·¯ç”± --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>base-home<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>base-about<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- å¼•ç”¨å…¶ä»–å­åº”ç”¨ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;/vue&quot;</span>&gt;</span>vue åº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;/react&quot;</span>&gt;</span>react åº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;/jquery&quot;</span>&gt;</span>jquery + bootstrap åº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;vueDOM&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;react&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;jquery&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>qiankun</tag>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redux toolkit çš„ä½¿ç”¨</title>
    <link href="/2020/10/09/redux-toolkit/"/>
    <url>/2020/10/09/redux-toolkit/</url>
    
    <content type="html"><![CDATA[<blockquote><ol><li><a href="https://redux-toolkit.js.org/">Redux Toolkit å®˜ç½‘</a></li><li><a href="https://www.51hint.com/posts/redux_toolkit/">Redux_toolkit ä½¿ç”¨</a></li></ol></blockquote><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-redux-toolkit"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-redux-toolkit" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux toolkit"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux toolkit</h3><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-comment">// ä¼˜åŒ–å‰</span><br>index<span class="hljs-selector-class">.js</span><br>state<span class="hljs-selector-class">.js</span><br>actionTypes<span class="hljs-selector-class">.js</span><br>actions<span class="hljs-selector-class">.js</span><br>reducer<span class="hljs-selector-class">.js</span><br><br><span class="hljs-comment">// ä¼˜åŒ–å</span><br>index<span class="hljs-selector-class">.js</span><br>slice.js<br></code></pre></div></td></tr></table></figure><p>ä¹‹å‰ä½¿ç”¨<em>redux</em>,éœ€è¦å®‰è£…<em>redux-thunk,immer</em>ç­‰å…¶å®ƒä¾èµ–åº“ï¼Œä½¿ç”¨ store çš„åŒäº‹éœ€è¦é‡å¤å†™è®¸å¤šæ ·æ¿ä»£ç ï¼Œç°åœ¨æŠŠ action å’Œ reducer éƒ½å†™åœ¨äº†ä¸€èµ·ï¼Œç®€åŒ–äº†è®¸å¤šæ ·æ¿ä»£ç ï¼Œä»£ç å˜å¾—æ›´åŠ ç²¾ç®€ã€‚</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><figure class="highlight gherkin"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gherkin">â”œâ”€â”€ LICENSE<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ public<br>|<span class="hljs-string">  â”œâ”€â”€ favicon.ico</span><br><span class="hljs-string"></span>|<span class="hljs-string">  â”œâ”€â”€ index.html</span><br><span class="hljs-string">â”œâ”€â”€ README.md</span><br><span class="hljs-string">â”œâ”€â”€ src</span><br><span class="hljs-string"></span>|<span class="hljs-string">  â”œâ”€â”€ App.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  â”œâ”€â”€ components</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â”œâ”€â”€ ComA</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â”œâ”€â”€ index.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â””â”€â”€ store</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">     â”œâ”€â”€ comASlice.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">     â””â”€â”€ state.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â”œâ”€â”€ ComB</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â”œâ”€â”€ index.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â””â”€â”€ store</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">     â”œâ”€â”€ comBSlice.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">     â””â”€â”€ state.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â””â”€â”€ Header</span><br><span class="hljs-string"></span>|<span class="hljs-string">  </span>|<span class="hljs-string">     â””â”€â”€ index.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  â”œâ”€â”€ index.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">  â””â”€â”€ store</span><br><span class="hljs-string"></span>|<span class="hljs-string">     â”œâ”€â”€ index.js</span><br><span class="hljs-string"></span>|<span class="hljs-string">     â””â”€â”€ reducer.js</span><br><span class="hljs-string">â””â”€â”€ yarn.lock</span><br></code></pre></div></td></tr></table></figure><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">yarn add react-redux @reduxjs/toolkit<br></code></pre></div></td></tr></table></figure><h3 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h3><ol><li>index.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Provider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-redux&quot;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App&quot;</span>;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">&#123;store&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;root&quot;</span>)<br>);<br></code></pre></div></td></tr></table></figure><ol start="2"><li>src&#x2F;store&#x2F;reducer.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; combineReducers &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;<br><span class="hljs-keyword">import</span> comASlice <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../components/ComA/store/comASlice&quot;</span>;<br><span class="hljs-keyword">import</span> comBSlice <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../components/ComB/store/comBSlice&quot;</span>;<br><br><span class="hljs-keyword">const</span> rootReducer = <span class="hljs-title function_">combineReducers</span>(&#123;<br>  <span class="hljs-attr">comAReducer</span>: comASlice.<span class="hljs-property">reducer</span>,<br>  <span class="hljs-attr">comBReducer</span>: comBSlice.<span class="hljs-property">reducer</span>,<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> rootReducer;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>src&#x2F;store&#x2F;index.js</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; configureStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;<br><span class="hljs-keyword">import</span> rootReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./reducer&quot;</span>;<br><br><span class="hljs-comment">// è¿™é‡Œä½¿ç”¨configureStoreä»£æ›¿ä¹‹å‰çš„createStore</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">configureStore</span>(&#123;<br>  <span class="hljs-attr">reducer</span>: rootReducer,<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>src&#x2F;components&#x2F;ComB&#x2F;index.js</li></ol><p><strong>hooks ä¸‹ä½¿ç”¨ useSelector å’Œ useDispatch ä»£æ›¿ä¹‹å‰ connect çš„ mapStateToProps å’Œ mapDispatchToPrpops</strong>ï¼Œä¹‹å‰é€šè¿‡ props è·å– state å’Œ dispatchï¼Œç°åœ¨ç›´æ¥é€šè¿‡ hooks çš„æ–¹å¼è·å–ï¼Œä»£ç å˜å¾—æ›´åŠ çš„ç®€æ´</p><blockquote><p><a href="https://blog.csdn.net/vitaviva/article/details/104508139">redux ä¸­ä½¿ç”¨ useSelectorã€useDispatch æ›¿ä»£ connect</a></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; memo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-comment">// import &#123; connect &#125; from &#x27;react-redux&#x27;;</span><br><span class="hljs-keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-redux&quot;</span>;<br><span class="hljs-keyword">import</span> comBSlice <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store/comBSlice&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123;<br>  <span class="hljs-attr">actions</span>: &#123; increment, decrement &#125;,<br>&#125; = comBSlice;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">ComA</span> = (<span class="hljs-params">props</span>) =&gt; &#123;<br>  <span class="hljs-comment">// const &#123; num &#125; = props;</span><br>  <span class="hljs-comment">// const &#123; handleIncrement, handleDecrement &#125; = props;</span><br><br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <span class="hljs-keyword">const</span> num = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">comBReducer</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleIncrement</span> = (<span class="hljs-params">num</span>) =&gt; <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">increment</span>(num));<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDecrement</span> = (<span class="hljs-params">num</span>) =&gt; <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">decrement</span>(num));<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ComA<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        num: <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>&#123;num&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> handleIncrement(1)&#125;&gt;increase +1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> handleDecrement(1)&#125;&gt;decrease -1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-comment">// const mapStateToProps = state =&gt; (&#123;</span><br><span class="hljs-comment">//   num: state.comBReducer</span><br><span class="hljs-comment">// &#125;);</span><br><br><span class="hljs-comment">// const mapDispatchToProps = dispatch =&gt; (&#123;</span><br><span class="hljs-comment">//   handleIncrement(num) &#123;</span><br><span class="hljs-comment">//     dispatch(increment(num));</span><br><span class="hljs-comment">//   &#125;,</span><br><span class="hljs-comment">//   handleDecrement(num) &#123;</span><br><span class="hljs-comment">//     dispatch(decrement(num));</span><br><span class="hljs-comment">//   &#125;</span><br><span class="hljs-comment">// &#125;)</span><br><br><span class="hljs-comment">// export default connect(mapStateToProps, mapDispatchToProps)(memo(ComA));</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">ComA</span>);<br></code></pre></div></td></tr></table></figure><ol start="5"><li>src&#x2F;components&#x2F;ComB&#x2F;store&#x2F;comBSlice.js</li></ol><blockquote><p>é€šè¿‡ createSlice å°† action å’Œ reducer å»ºç«‹åœ¨ä¸€èµ·ï¼Œä»£ç æ›´åŠ ç®€æ´</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createSlice &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; num &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./state&quot;</span>;<br><br><span class="hljs-keyword">const</span> comBSlice = <span class="hljs-title function_">createSlice</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;comB&quot;</span>,<br>  <span class="hljs-attr">initialState</span>: num,<br>  <span class="hljs-attr">reducers</span>: &#123;<br>    <span class="hljs-attr">increment</span>: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> state + action.<span class="hljs-property">payload</span>,<br>    <span class="hljs-attr">decrement</span>: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> state - action.<span class="hljs-property">payload</span>,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> comBSlice;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>develop</category>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>redux</tag>
      
      <tag>redux-toolkit</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
